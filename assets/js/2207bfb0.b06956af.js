"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7854],{41493:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>h});var n=t(74848),i=t(28453);const o={authors:["frank"],tags:["cheatsheet","traefik","docker"],description:"Cheatsheet Traefik",keywords:["Cheatsheet Traefik"],image:"https://i.imgur.com/mErPwqL.png",date:new Date("2024-01-17T00:00:00.000Z"),draft:!1,enableComments:!0},s="Traefik Cheat Sheet",a={id:"cheatsheet-traefik",title:"Traefik Cheat Sheet",description:"Cheatsheet Traefik",source:"@site/../../docs/cheatsheet-traefik.mdx",sourceDirName:".",slug:"/cheatsheet-traefik",permalink:"/docs/cheatsheet-traefik",draft:!1,unlisted:!1,editUrl:"https://github.com/liviaerxin/liviaerxin.github.io/edit/master/_ssg/docusaurus/../../docs/cheatsheet-traefik.mdx",tags:[{inline:!0,label:"cheatsheet",permalink:"/docs/tags/cheatsheet"},{inline:!0,label:"traefik",permalink:"/docs/tags/traefik"},{inline:!0,label:"docker",permalink:"/docs/tags/docker"}],version:"current",lastUpdatedBy:"liviaerxin",lastUpdatedAt:1744922238e3,frontMatter:{authors:["frank"],tags:["cheatsheet","traefik","docker"],description:"Cheatsheet Traefik",keywords:["Cheatsheet Traefik"],image:"https://i.imgur.com/mErPwqL.png",date:"2024-01-17T00:00:00.000Z",draft:!1,enableComments:!0},sidebar:"docs",previous:{title:"Python pip cheat sheet",permalink:"/docs/cheatsheet-python-pip"},next:{title:"Git Hooks + Docker CI/CD",permalink:"/docs/zero-cost-ci-cd"}},c={},h=[{value:"Redirect root path <code>/</code> to a subpath",id:"redirect-root-path--to-a-subpath",level:2},{value:"Route a prefix to a service",id:"route-a-prefix-to-a-service",level:2},{value:"Specify a custom port for the container",id:"specify-a-custom-port-for-the-container",level:2},{value:"Specify more than one router and service per container",id:"specify-more-than-one-router-and-service-per-container",level:2},{value:"Resources",id:"resources",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{id:"traefik-cheat-sheet",children:"Traefik Cheat Sheet"}),"\n",(0,n.jsxs)(r.p,{children:["Here are quick references for using ",(0,n.jsx)(r.code,{children:"Traefik"})," on ",(0,n.jsx)(r.code,{children:"Docker"})," containers environment."]}),"\n",(0,n.jsxs)(r.p,{children:["I use ",(0,n.jsx)(r.code,{children:"Traefik"})," in my docker compose project more frequently than using ",(0,n.jsx)(r.code,{children:"Nginx"}),", as it has such advantages:"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Simply to use and fast to spin up","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Configuration relies on platform syntax(like ",(0,n.jsx)(r.code,{children:"Docker labels"})," or ",(0,n.jsx)(r.code,{children:"Kubernetes annotations"}),"), while ",(0,n.jsx)(r.code,{children:"Nginx"})," uses its own syntax and directives."]}),"\n",(0,n.jsxs)(r.li,{children:["Configuration can just sit in ",(0,n.jsx)(r.code,{children:"docker-compose.yml"}),", but ",(0,n.jsx)(r.code,{children:"Nginx"})," always uses a dedicate configuration file(",(0,n.jsx)(r.code,{children:"/etc/nginx/nginx.conf"}),")."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["Dynamic configuration:","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Changes to the configuration require a restart of the ",(0,n.jsx)(r.code,{children:"Nginx"})," process"]}),"\n",(0,n.jsxs)(r.li,{children:["Changes to the configuration require a restart of its corresponding service, not the ",(0,n.jsx)(r.code,{children:"Traefik"})," process"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://doc.traefik.io/traefik/assets/img/middleware/overview.png",alt:"How a Request is processed in Traefik"})}),"\n",(0,n.jsx)(r.p,{children:"Entrypoint -> Router -> Middleware 1 -> Middleware 2 -> ... -> Service"}),"\n",(0,n.jsxs)(r.h2,{id:"redirect-root-path--to-a-subpath",children:["Redirect root path ",(0,n.jsx)(r.code,{children:"/"})," to a subpath"]}),"\n",(0,n.jsxs)(r.p,{children:["The goal is to redirect root path ",(0,n.jsx)(r.code,{children:"/"})," to sub path ",(0,n.jsx)(r.code,{children:"/mtr"})," that's an ingress for a web service:"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"http://127.0.0.1"})," -> ",(0,n.jsx)(r.code,{children:"http://127.0.0.1/mtr"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"http://127.0.0.1"})," -> ",(0,n.jsx)(r.code,{children:"http://127.0.0.1/mtr"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"https://127.0.0.1/something"})," -> no redirect"]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["It works for ",(0,n.jsx)(r.strong,{children:"Traefik 2.0"})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yml",children:"services:\n  traefik:\n    image: traefik:v2.10\n    command:\n      - --api.insecure=true\n      - --providers.docker=true\n      - --providers.docker.exposedbydefault=false\n      - --entrypoints.web.address=:80\n    ports:\n      - 80:80\n      - 8080:8080 # Web UI Port\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n    labels:\n      - traefik.enable=true\n      # Redirection from `http://xxx.com` to `http://xxx.com/foo`\n      - traefik.http.routers.domain.entrypoints=web\n      - traefik.http.routers.domain.rule=Path(`/`)\n      - traefik.http.routers.domain.service=noop@internal\n      - traefik.http.routers.domain.middlewares=to-foo@docker\n      - traefik.http.middlewares.to-foo.redirectregex.permanent=true\n      - traefik.http.middlewares.to-foo.redirectregex.regex=^http://([^/]+)/?$\n      - traefik.http.middlewares.to-foo.redirectregex.replacement=http://$${1}/foo\n\n  foo:\n    image:  traefik/whoami:v1.10\n    hostname: foo.com\n    labels:\n      - traefik.enable=true\n      # just to ingress `http://xxx.com/foo`\n      - traefik.http.routers.foo.entrypoints=web\n      - traefik.http.routers.foo.rule=PathPrefix(`/foo`)\n"})}),"\n",(0,n.jsx)(r.h2,{id:"route-a-prefix-to-a-service",children:"Route a prefix to a service"}),"\n",(0,n.jsxs)(r.p,{children:["Match a request with a prefix ",(0,n.jsx)(r.code,{children:"/bar"}),", strip the prefix and route it to the ",(0,n.jsx)(r.strong,{children:"bar"})," service,"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yml",children:"bar:\n  image:  traefik/whoami:v1.10\n  hostname: bar.com\n  labels:\n    - traefik.enable=true\n    # ingress `http://xxx.com/bar/xyz` and send `http://xxx.com/xyz` to `bar` service\n    - traefik.http.routers.bar.entrypoints=web\n    - traefik.http.routers.bar.rule=PathPrefix(`/bar`)\n    - traefik.http.routers.bar.middlewares=bar-strip-prefix@docker\n    - traefik.http.middlewares.bar-strip-prefix.stripprefix.prefixes=/bar\n"})}),"\n",(0,n.jsx)(r.h2,{id:"specify-a-custom-port-for-the-container",children:"Specify a custom port for the container"}),"\n",(0,n.jsxs)(r.p,{children:["By default, Traefik used the first exposed port of a container, if a container exposes multiple ports, set ",(0,n.jsx)(r.code,{children:"traefik.http.services.xxx.loadbalancer.server.port"})," to override that port."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yml",children:"bar12345:\n  image:  traefik/whoami:v1.10\n  hostname: bar12345.com\n  environment:\n    WHOAMI_PORT_NUMBER: 12345\n  labels:\n    - traefik.enable=true\n    - traefik.http.routers.bar12345.entrypoints=web\n    - traefik.http.routers.bar12345.rule=PathPrefix(`/bar12345`)\n    - traefik.http.routers.bar12345.service=bar12345\n    # Tell Traefik to use the port 12345 to connect to `bar12345` service\n    - traefik.http.services.bar12345.loadbalancer.server.port=12345\n"})}),"\n",(0,n.jsx)(r.h2,{id:"specify-more-than-one-router-and-service-per-container",children:"Specify more than one router and service per container"}),"\n",(0,n.jsxs)(r.p,{children:["In this example, requests are forwarded for ",(0,n.jsx)(r.code,{children:"http://127.0.0.1/web2ports-a"})," to ",(0,n.jsx)(r.code,{children:"http://<private IP of container>:8001"})," in addition to ",(0,n.jsx)(r.code,{children:"http://127.0.0.1/web2ports-b"})," forwarding to ",(0,n.jsx)(r.code,{children:"http://<private IP of container>:8002"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yml",children:'web2ports:\n  image: python:3.10\n  ports:\n    - 8001:8001\n    - 8002:8002\n  working_dir: /app\n  volumes:\n    - ./server_whoami.py:/app/server_whoami.py\n  command: >\n    sh -c "python3 server_whoami.py --port 8001 \n    & python3 server_whoami.py --port 8002"\n  labels:\n    - traefik.enable=true\n    # Specify more than one router and service per container\n    - traefik.http.routers.a-router.entrypoints=web\n    - traefik.http.routers.a-router.rule=PathPrefix(`/web2ports-a`)\n    - traefik.http.routers.a-router.service=a-service\n    - traefik.http.services.a-service.loadbalancer.server.port=8001\n    - traefik.http.routers.b-router.entrypoints=web\n    - traefik.http.routers.b-router.rule=PathPrefix(`/web2ports-b`)\n    - traefik.http.routers.b-router.service=b-service\n    - traefik.http.services.b-service.loadbalancer.server.port=8002\n'})}),"\n",(0,n.jsx)(r.h2,{id:"resources",children:"Resources"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://community.traefik.io/t/url-redirect-abc-com-to-xyz-com/8084",children:"URL Redirect abc.com to xyz.com - Traefik v2 (latest) - Traefik Labs Community Forum"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://gist.github.com/kekru/d088be6a3fa844089ae62d80c077bb38",children:"Traefik redirect / (root) to sub path with Docker labels \xb7 GitHub"})})]})}function l(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>s,x:()=>a});var n=t(96540);const i={},o=n.createContext(i);function s(e){const r=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(o.Provider,{value:r},e.children)}}}]);