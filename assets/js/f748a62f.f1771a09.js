"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8175],{28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>i});var s=r(96540);const o={},a=s.createContext(o);function t(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),s.createElement(a.Provider,{value:n},e.children)}},43996:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"docker/docker-setup-samba-server","title":"Set Up Samba Server in Docker","description":"Set Up Samba Server in Docker","source":"@site/../../docs/docker/docker-setup-samba-server.mdx","sourceDirName":"docker","slug":"/docker/docker-setup-samba-server","permalink":"/docs/docker/docker-setup-samba-server","draft":false,"unlisted":false,"editUrl":"https://github.com/liviaerxin/liviaerxin.github.io/edit/master/_ssg/docusaurus/../../docs/docker/docker-setup-samba-server.mdx","tags":[{"inline":true,"label":"docker","permalink":"/docs/tags/docker"},{"inline":true,"label":"samba","permalink":"/docs/tags/samba"}],"version":"current","lastUpdatedBy":"liviaerxin","lastUpdatedAt":1745256514000,"frontMatter":{"authors":["frank"],"tags":["docker","samba"],"description":"Set Up Samba Server in Docker","keywords":["Set Up Samba Server in Docker"],"image":"https://i.imgur.com/mErPwqL.png","date":"2025-01-12T00:00:00.000Z","draft":false,"enableComments":true},"sidebar":"docs","previous":{"title":"Set Up NFS Sever in Docker","permalink":"/docs/docker/docker-setup-nfs-sever"},"next":{"title":"Cheat Sheet","permalink":"/docs/category/cheat-sheet"}}');var o=r(74848),a=r(28453);const t={authors:["frank"],tags:["docker","samba"],description:"Set Up Samba Server in Docker",keywords:["Set Up Samba Server in Docker"],image:"https://i.imgur.com/mErPwqL.png",date:new Date("2025-01-12T00:00:00.000Z"),draft:!1,enableComments:!0},i="Set Up Samba Server in Docker",c={},d=[{value:"Start Samba Server in Docker",id:"start-samba-server-in-docker",level:2},{value:"Start Samba Client in Docker",id:"start-samba-client-in-docker",level:2},{value:"Start Samba Client which Create Volume in Docker",id:"start-samba-client-which-create-volume-in-docker",level:2},{value:"Use Case in Docker Compose",id:"use-case-in-docker-compose",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"set-up-samba-server-in-docker",children:"Set Up Samba Server in Docker"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"!IMPORTANT"}),": Permission setting is very annoying but critical, sometimes you need take long time to fine tune it and debug.\n",(0,o.jsx)(n.strong,{children:"!IMPORTANT"}),": When setting up a Samba server in Docker in OSX, you will encounter problems such as ",(0,o.jsx)(n.code,{children:"Operation not suppored"})," when using ",(0,o.jsx)(n.code,{children:"bind mount"}),". Roughly saying, the reason is Docker run in a light VM in Mac and your Mac host uses a different file system(HFS+) compared to Linux(ext4 or similar). So switching to ",(0,o.jsx)(n.code,{children:"volume mount"})," will solve this potential problem."]}),"\n",(0,o.jsx)(n.p,{children:"Some takeaways about Permission:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Creating and deleting files is controlled by permissions on the directory."}),"\n",(0,o.jsx)(n.li,{children:"Modifying the file is controlled by permissions on the file. You may have a mask which is removing the write privilege from the file."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"When I turned to set up Samba server locally, the main purpose is that I would like to integrate the Samba server into my Docker Compose project to mock a real remote Samba server, which will facilitate your local development in Docker environment."}),"\n",(0,o.jsx)(n.p,{children:"So this blog will illustrate to set up a Samba server and a client, and test interaction between them."}),"\n",(0,o.jsx)(n.h2,{id:"start-samba-server-in-docker",children:"Start Samba Server in Docker"}),"\n",(0,o.jsxs)(n.p,{children:["Here, we use Samba server image from ",(0,o.jsx)(n.a,{href:"https://hub.docker.com/r/dperson/samba",children:"dperson/samba"}),". Although there is an alternative from ",(0,o.jsx)(n.a,{href:"https://hub.docker.com/r/servercontainers/samba",children:"ghcr.io/servercontainers/samba"})," or ",(0,o.jsx)(n.a,{href:"https://github.com/crazy-max/docker-samba",children:"crazymax/samba"})]}),"\n",(0,o.jsxs)(n.p,{children:["In OSX, it's critical to use ",(0,o.jsx)(n.code,{children:"volume mount"})," and avoid using ",(0,o.jsx)(n.code,{children:"bind mount"})," as we mentioned above."]}),"\n",(0,o.jsxs)(n.admonition,{type:"note",children:[(0,o.jsxs)(n.p,{children:["In OSX, due to the docker desktop itself is running in VM, it will cause some error like ",(0,o.jsx)(n.code,{children:"Operation not supported"})," when binding a local file folder via ",(0,o.jsx)(n.code,{children:"bind mount"})," even you set ",(0,o.jsx)(n.code,{children:"777"})," mask on the folder. So it's recommended to use ",(0,o.jsx)(n.code,{children:"volume mount"})," to bind to ",(0,o.jsx)(n.code,{children:"/mnt"})," in Samba server in OSX."]}),(0,o.jsxs)(n.p,{children:["Furthermore, the Samba server will log such message: ",(0,o.jsx)(n.code,{children:"error reading meta xattr: Not supported"}),"."]})]}),"\n",(0,o.jsxs)(n.p,{children:["In Linux, it's okay to use either ",(0,o.jsx)(n.code,{children:"volume mount"})," or ",(0,o.jsx)(n.code,{children:"bind mount"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:'docker run -it --rm \\\n    --name samba \\\n    -p 139:139 -p 445:445 \\\n    -v mnt:/mnt:z \\\n    dperson/samba \\\n    -p -s "Mount;/mnt;yes;no;yes" -u "bob;bobspasswd" -g "log level = 5"\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:'-s "<Mount;/mnt>;yes;no;yes"'})," means [browsable",":yes",";readonly",":no",";guest",":yes",']", which will allow the guest to ',(0,o.jsx)(n.code,{children:"read"})," and the user to ",(0,o.jsx)(n.code,{children:"read/write"}),"!"]})}),"\n",(0,o.jsx)(n.p,{children:"Get the samba server IP address:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"$ docker inspect \\\n    -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' \\\n    samba\n172.17.0.2\n"})}),"\n",(0,o.jsx)(n.h2,{id:"start-samba-client-in-docker",children:"Start Samba Client in Docker"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"dperson/samba"})," or ",(0,o.jsx)(n.code,{children:"busybox"})," image,"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"docker run -it --rm --privileged dperson/samba bash\n"})}),"\n",(0,o.jsx)(n.p,{children:"or"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"docker run -it --rm --privileged busybox sh\n"})}),"\n",(0,o.jsx)(n.p,{children:"Inside the container:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:'mkdir /smb_share\n\n# mount -t cifs //[server-ip]/[share-path] /[mount-point]\nmount -t cifs //172.17.0.2/Mount /smb_share -o rw,username=bob,password=bobspasswd\n\n# write file\necho "xxxx" > /smb_share/f.txt\n'})}),"\n",(0,o.jsx)(n.h2,{id:"start-samba-client-which-create-volume-in-docker",children:"Start Samba Client which Create Volume in Docker"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create a CIFS/Samba Volume"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"docker volume create \\\n    --driver local \\\n    --opt type=cifs \\\n    --opt device=//172.17.0.2/Mount \\\n    --opt o=username=bob,password=bobspasswd \\\n    --name samba-volume\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:'$ docker inspect samba-volume\n[\n    {\n        "CreatedAt": "2023-08-13T16:24:03Z",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/samba-volume/_data",\n        "Name": "samba-volume",\n        "Options": {\n            "device": "//172.17.0.2/Mount",\n            "o": "addr=username=bob,password=bobspasswd",\n            "type": "cifs"\n        },\n        "Scope": "local"\n    }\n]\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:["Start a container using the created volume ",(0,o.jsx)(n.code,{children:"samba-volume"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"docker run -it --rm \\\n    -v samba-volume:/mnt \\\n    busybox \\\n    sh\n"})}),"\n",(0,o.jsx)(n.h2,{id:"use-case-in-docker-compose",children:"Use Case in Docker Compose"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:"reference",children:"https://github.com/liviaerxin/hello-docker-compose/blob/main/samba/docker-compose.yml\n"})}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsxs)(n.p,{children:["When you mount an Samba Share in Linux, you may encounter error like ",(0,o.jsx)(n.code,{children:"failed: Invalid argument"}),","]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"bash-5.1# mount -t cifs //172.17.0.2/Mount /mnt/smb_share -o iocharset=utf8,rw,vers=1.0\nmount: mounting //172.17.0.2/Mount on /mnt/smb_share failed: Invalid argument\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You can use ",(0,o.jsx)(n.code,{children:"dmesg"})," to debug,"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"bash-5.1# dmesg\n[317258.750535] CIFS: Attempting to mount \\\\172.17.0.2\\Mount\n[317258.752956] CIFS: VFS: No username specified\n[317336.240984] cifs: Unknown parameter 'passwd'\n[317344.451345] CIFS: Attempting to mount \\\\172.17.0.2\\Mount\n"})})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);