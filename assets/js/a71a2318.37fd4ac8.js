"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4355],{69451:(n,i,e)=>{e.r(i),e.d(i,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>t});var s=e(74848),l=e(28453);const r={foam_template:{name:"Blog Docusaurus Template",description:"Creates Docusaurus blog/slip",filepath:"blog/wiki-cross-compilation.mdx"},authors:["frank"],tags:["wiki","cross-compilation"],description:"Wiki Cross Compilation",keywords:["Wiki Cross Compilation"],image:"https://i.imgur.com/mErPwqL.png",date:new Date("2024-09-18T00:00:00.000Z"),draft:!1,enableComments:!0},o="Wiki Cross Compilation",c={id:"wiki-cross-compilation",title:"Wiki Cross Compilation",description:"Wiki Cross Compilation",source:"@site/../../docs/wiki-cross-compilation.mdx",sourceDirName:".",slug:"/wiki-cross-compilation",permalink:"/docs/wiki-cross-compilation",draft:!1,unlisted:!1,editUrl:"https://github.com/liviaerxin/liviaerxin.github.io/edit/master/_ssg/docusaurus/../../docs/wiki-cross-compilation.mdx",tags:[{inline:!0,label:"wiki",permalink:"/docs/tags/wiki"},{inline:!0,label:"cross-compilation",permalink:"/docs/tags/cross-compilation"}],version:"current",lastUpdatedBy:"liviaerxin",lastUpdatedAt:1744660906e3,frontMatter:{foam_template:{name:"Blog Docusaurus Template",description:"Creates Docusaurus blog/slip",filepath:"blog/wiki-cross-compilation.mdx"},authors:["frank"],tags:["wiki","cross-compilation"],description:"Wiki Cross Compilation",keywords:["Wiki Cross Compilation"],image:"https://i.imgur.com/mErPwqL.png",date:"2024-09-18T00:00:00.000Z",draft:!1,enableComments:!0},sidebar:"docs",previous:{title:"Wiki Coral",permalink:"/docs/wiki-coral"},next:{title:"Wiki Cryptography",permalink:"/docs/wiki-cryptography"}},a={},t=[{value:"Cross Compilation Anatomy",id:"cross-compilation-anatomy",level:2},{value:"GCC",id:"gcc",level:2},{value:"Obtaining a cross-compilation toolchain for <code>aarch64</code>",id:"obtaining-a-cross-compilation-toolchain-for-aarch64",level:3},{value:"Where is <code>cross compiler</code>",id:"where-is-cross-compiler",level:3},{value:"Where is <code>sysroot</code>",id:"where-is-sysroot",level:3},{value:"Compile <code>hello.c</code>",id:"compile-helloc",level:3},{value:"Clang/LLVM",id:"clangllvm",level:2},{value:"Resources",id:"resources",level:2}];function d(n){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.h1,{id:"wiki-cross-compilation",children:"Wiki Cross Compilation"}),"\n",(0,s.jsx)(i.h2,{id:"cross-compilation-anatomy",children:"Cross Compilation Anatomy"}),"\n",(0,s.jsx)(i.p,{children:"Cross-Compilation ecosystem involves the following components:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["host system","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["cross-Compilation toolchain","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"cross compiler"}),"\n",(0,s.jsx)(i.li,{children:"cross linker"}),"\n",(0,s.jsx)(i.li,{children:"cross debugger"}),"\n",(0,s.jsxs)(i.li,{children:["sysroot","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"target system library files"}),"\n",(0,s.jsx)(i.li,{children:"target system header files"}),"\n",(0,s.jsx)(i.li,{children:"target system other files"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.li,{children:"target system"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Cross-Compilation toolchain:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"GCC"}),"\n",(0,s.jsx)(i.li,{children:"Buildroot"}),"\n",(0,s.jsx)(i.li,{children:"Yocto Project"}),"\n",(0,s.jsx)(i.li,{children:"Crosstool-NG"}),"\n",(0,s.jsx)(i.li,{children:"Linaro"}),"\n",(0,s.jsx)(i.li,{children:"Clang/LLVM"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"gcc",children:"GCC"}),"\n",(0,s.jsxs)(i.p,{children:["Let's explore what a toolchain is like and what are needed to build something for a ",(0,s.jsx)(i.code,{children:"aarch64"})," platform on ",(0,s.jsx)(i.code,{children:"x86_64"})," debian-like host."]}),"\n",(0,s.jsxs)(i.h3,{id:"obtaining-a-cross-compilation-toolchain-for-aarch64",children:["Obtaining a cross-compilation toolchain for ",(0,s.jsx)(i.code,{children:"aarch64"})]}),"\n",(0,s.jsxs)(i.p,{children:["For simplicity and in a super fast way, we will use a prebuilt and ready-on toolchain in ",(0,s.jsx)(i.code,{children:"x86_64"})," Ubuntu."]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"apt install gcc make gcc-aarch64-linux-gnu binutils-aarch64-linux-gnu\n"})}),"\n",(0,s.jsxs)(i.h3,{id:"where-is-cross-compiler",children:["Where is ",(0,s.jsx)(i.code,{children:"cross compiler"})]}),"\n",(0,s.jsxs)(i.p,{children:["We see ",(0,s.jsx)(i.code,{children:"cross compiler"})," binary type in host is ",(0,s.jsx)(i.code,{children:"x86-64"}),","]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"$ file /usr/bin/aarch64-linux-gnu-gcc-11\n/usr/bin/aarch64-linux-gnu-gcc-11: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=b1112487d0dcb759db32e15b8f40f28a05484272, for GNU/Linux 3.2.0, stripped\n"})}),"\n",(0,s.jsxs)(i.h3,{id:"where-is-sysroot",children:["Where is ",(0,s.jsx)(i.code,{children:"sysroot"})]}),"\n",(0,s.jsxs)(i.p,{children:["The ",(0,s.jsx)(i.code,{children:"sysroot"})," locates in ",(0,s.jsx)(i.code,{children:"/usr/aarch64-linux-gnu"}),","]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"$ tree --filelimit=100 /usr/aarch64-linux-gnu\n/usr/aarch64-linux-gnu\n\u251c\u2500\u2500 bin\n\u2502\xa0\xa0 \u251c\u2500\u2500 ar -> ../../bin/aarch64-linux-gnu-ar\n\u2502\xa0\xa0 \u251c\u2500\u2500 as -> ../../bin/aarch64-linux-gnu-as\n\u2502\xa0\xa0 \u251c\u2500\u2500 ld -> ../../bin/aarch64-linux-gnu-ld\n\u2502\xa0\xa0 \u251c\u2500\u2500 ld.bfd -> ../../bin/aarch64-linux-gnu-ld.bfd\n\u2502\xa0\xa0 \u251c\u2500\u2500 ld.gold -> ../../bin/aarch64-linux-gnu-ld.gold\n\u2502\xa0\xa0 \u251c\u2500\u2500 nm -> ../../bin/aarch64-linux-gnu-nm\n\u2502\xa0\xa0 \u251c\u2500\u2500 objcopy -> ../../bin/aarch64-linux-gnu-objcopy\n\u2502\xa0\xa0 \u251c\u2500\u2500 objdump -> ../../bin/aarch64-linux-gnu-objdump\n\u2502\xa0\xa0 \u251c\u2500\u2500 ranlib -> ../../bin/aarch64-linux-gnu-ranlib\n\u2502\xa0\xa0 \u251c\u2500\u2500 readelf -> ../../bin/aarch64-linux-gnu-readelf\n\u2502\xa0\xa0 \u2514\u2500\u2500 strip -> ../../bin/aarch64-linux-gnu-strip\n\u251c\u2500\u2500 include  [139 entries exceeds filelimit, not opening dir]\n\u2514\u2500\u2500 lib\n    \u251c\u2500\u2500 Mcrt1.o\n    \u251c\u2500\u2500 Scrt1.o\n    \u251c\u2500\u2500 crt1.o\n    \u251c\u2500\u2500 crti.o\n    \u251c\u2500\u2500 crtn.o\n    \u251c\u2500\u2500 gcrt1.o\n    \u251c\u2500\u2500 grcrt1.o\n    \u251c\u2500\u2500 ld-linux-aarch64.so.1\n"})}),"\n",(0,s.jsxs)(i.p,{children:["As you see, the ",(0,s.jsx)(i.code,{children:"binutils-aarch64-linux-gnu"})," will install ",(0,s.jsx)(i.code,{children:"binutils"})," tools in ",(0,s.jsx)(i.code,{children:"/usr/aarch64-linux-gnu/bin"}),","]}),"\n",(0,s.jsxs)(i.p,{children:["These ",(0,s.jsx)(i.code,{children:"binutils"})," are also ",(0,s.jsx)(i.code,{children:"x86_64"})," binaries,"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:" file $(readlink -f /usr/aarch64-linux-gnu/bin/ar)\n/usr/bin/aarch64-linux-gnu-ar: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=4f75b6dc6fe5ae92c78a51e6479ca2c65bbf5335, for GNU/Linux 3.2.0, stripped\n"})}),"\n",(0,s.jsxs)(i.p,{children:["While target libraries are ",(0,s.jsx)(i.code,{children:"aarch64"})," type,"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"file /usr/aarch64-linux-gnu/lib/crt1.o\n/usr/aarch64-linux-gnu/lib/crt1.o: ELF 64-bit LSB relocatable, ARM aarch64, version 1 (SYSV), for GNU/Linux 3.7.0, not stripped\n"})}),"\n",(0,s.jsxs)(i.h3,{id:"compile-helloc",children:["Compile ",(0,s.jsx)(i.code,{children:"hello.c"})]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"$ aarch64-linux-gnu-gcc-11 hello.c -o a.out\n$ file a.out\na.out: ELF 64-bit LSB pie executable, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, BuildID[sha1]=367c436db0697f16039d9249e4a4e809ef9e68b3, for GNU/Linux 3.7.0, not stripped\n"})}),"\n",(0,s.jsx)(i.h2,{id:"clangllvm",children:"Clang/LLVM"}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.a,{href:"https://static.linaro.org/connect/bkk19/presentations/bkk19-210.pdf",children:"Cross compilation with Clang and LLVM tools"})}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.a,{href:"https://mcilloni.ovh/2021/02/09/cxx-cross-clang/",children:"Cross compiling made easy, using Clang and LLVM \xb7 mcilloni's blog"})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"apt install lld clang llvm\n"})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"$ wget https://releases.linaro.org/components/toolchain/binaries/7.5-2019.12/aarch64-linux-gnu/sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu.tar.xz\n\n$ tar -xvf sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu.tar.xz\n\n$ mv sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu aarch64-linux-gnu\n"})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"$ ll aarch64-linux-gnu\ntotal 20K\ndrwxr-xr-x 2 11827 9000 4.0K Dec  4  2019 etc\ndrwxr-xr-x 3 11827 9000 4.0K Dec  4  2019 lib\ndrwxr-xr-x 2 11827 9000 4.0K Dec  4  2019 sbin\ndrwxr-xr-x 8 11827 9000 4.0K Dec  4  2019 usr\ndrwxr-xr-x 3 11827 9000 4.0K Dec  4  2019 var\n"})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:'$ cat > hello.c << EOL\n#include <stdio.h>\nint main(int argc, char *argv[])\n{\n  printf("Hello cross-compilation world!\\n");\n  return 0;\n}\nEOL\n'})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"sysroot=~/Documents/sysroot/aarch64-linux-gnu/usr\n"})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"clang --target=aarch64-linux-gnu hello.c -o hello_aarch64 -v\n"})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"clang --target=aarch64-linux-gnu hello.c -o hello_aarch64 --sysroot=$sysroot -v\n"})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"clang --target=aarch64-linux-gnu  -fsanitize=undefined \\\n    -fuse-ld=lld \\\n    --rtlib=compiler-rt -stdlib=libc++ \\\n    -nostdinc++ -nostdlib \\\n    -I${sysroot}/usr/include/ \\\n    -Wl,-L${sysroot}/usr/lib \\\n    --sysroot=$sysroot \\\n    --verbose \\\n    hello.c -o hello\n"})}),"\n",(0,s.jsx)(i.h2,{id:"resources",children:"Resources"}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.a,{href:"https://wiki.osdev.org/GCC_Cross-Compiler",children:"https://wiki.osdev.org/GCC_Cross-Compiler"})}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.a,{href:"https://github.com/generia/buildroot-osx",children:"https://github.com/generia/buildroot-osx"})}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.a,{href:"https://crosstool-ng.github.io/docs/",children:"https://crosstool-ng.github.io/docs/"})}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.a,{href:"https://github.com/messense/homebrew-macos-cross-toolchains/blob/main/.github/workflows/aarch64.yml",children:"https://github.com/messense/homebrew-macos-cross-toolchains/blob/main/.github/workflows/aarch64.yml"})})]})}function h(n={}){const{wrapper:i}={...(0,l.R)(),...n.components};return i?(0,s.jsx)(i,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},28453:(n,i,e)=>{e.d(i,{R:()=>o,x:()=>c});var s=e(96540);const l={},r=s.createContext(l);function o(n){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(i):{...i,...n}}),[i,n])}function c(n){let i;return i=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:o(n.components),s.createElement(r.Provider,{value:i},n.children)}}}]);