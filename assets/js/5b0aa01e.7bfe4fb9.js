"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6910],{20572:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>a,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var r=s(97107),i=s(74848),t=s(28453);const o={description:"A lightweight CI/CD method using Git push and Docker, no third-party tools needed.",keywords:["ci/cd","docker","git"],image:"https://i.imgur.com/mErPwqL.png",tags:["ci/cd","docker","git"],last_update:{date:new Date("2025-04-14T00:00:00.000Z")},date:new Date("2025-04-13T00:00:00.000Z"),authors:["frank"]},l="Lightweight CI/CD with Git Hooks and Docker Compose",c={authorsImageUrls:[void 0]},d=[{value:"Overview",id:"overview",level:2},{value:"Step-by-Step Setup",id:"step-by-step-setup",level:2},{value:"1. Prepare the Production Server",id:"1-prepare-the-production-server",level:3},{value:"Install Git and Docker:",id:"install-git-and-docker",level:4},{value:"Create a bare Git repository:",id:"create-a-bare-git-repository",level:4},{value:"Set up SSH access:",id:"set-up-ssh-access",level:4},{value:"2. Add the Production Server as a Remote on Your Dev Machine",id:"2-add-the-production-server-as-a-remote-on-your-dev-machine",level:3},{value:"3. Create a Post-Receive Hook on the Server",id:"3-create-a-post-receive-hook-on-the-server",level:3},{value:"What Exactly Happens During <code>git push</code>",id:"what-exactly-happens-during-git-push",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"FAQ",id:"faq",level:2},{value:"Final Thoughts",id:"final-thoughts",level:2}];function h(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["For small projects or self-hosted apps, using a full-fledged CI/CD tool like GitHub Actions or Jenkins can be overkill. What if you could have automated deployments ",(0,i.jsx)(n.strong,{children:"without any third-party service"}),", and all you need is ",(0,i.jsx)(n.strong,{children:"Git and SSH"}),"?"]}),"\n",(0,i.jsxs)(n.p,{children:["In this post, we\u2019ll walk through setting up a lightweight, no-cost CI/CD pipeline using ",(0,i.jsx)(n.strong,{children:"Git hooks"})," and ",(0,i.jsx)(n.strong,{children:"Docker Compose"}),", with deployments triggered by a simple ",(0,i.jsx)(n.code,{children:"git push"})," to your production server."]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Here\u2019s the basic idea:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["You push your code from your dev machine to both:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A central Git host (like GitHub/GitLab)"}),"\n",(0,i.jsx)(n.li,{children:"Your production server (a bare Git repo)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The production server runs a ",(0,i.jsx)(n.code,{children:"post-receive"})," hook to:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Checkout the latest code"}),"\n",(0,i.jsx)(n.li,{children:"Rebuild and restart Docker containers"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This method is great for solo developers or small teams who want simple, fast deployments without external dependencies."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-by-step-setup",children:"Step-by-Step Setup"}),"\n",(0,i.jsx)(n.h3,{id:"1-prepare-the-production-server",children:"1. Prepare the Production Server"}),"\n",(0,i.jsx)(n.h4,{id:"install-git-and-docker",children:"Install Git and Docker:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt update && sudo apt install git docker docker-compose -y\n"})}),"\n",(0,i.jsx)(n.h4,{id:"create-a-bare-git-repository",children:"Create a bare Git repository:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/repos/myapp.git\ncd ~/repos/myapp.git\ngit init --bare\n"})}),"\n",(0,i.jsx)(n.h4,{id:"set-up-ssh-access",children:"Set up SSH access:"}),"\n",(0,i.jsx)(n.p,{children:"From your dev machine, copy your SSH key to the production server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh-copy-id user@yourserver\n"})}),"\n",(0,i.jsx)(n.p,{children:"Test it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh user@yourserver\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"2-add-the-production-server-as-a-remote-on-your-dev-machine",children:"2. Add the Production Server as a Remote on Your Dev Machine"}),"\n",(0,i.jsx)(n.p,{children:"In your project repo:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git remote add production ssh://user@yourserver/home/user/repos/myapp.git\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now you can push to the production server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git push production main\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"3-create-a-post-receive-hook-on-the-server",children:"3. Create a Post-Receive Hook on the Server"}),"\n",(0,i.jsx)(n.p,{children:"On the production server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nano ~/repos/myapp.git/hooks/post-receive\n"})}),"\n",(0,i.jsx)(n.p,{children:"Paste the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\nAPP_DIR=/var/www/myapp\n\n# Checkout code\ngit --work-tree=$APP_DIR --git-dir=$(pwd) checkout -f\n\n# Deploy with Docker\ncd $APP_DIR || exit\ndocker compose down\ndocker compose build\ndocker compose up -d\n"})}),"\n",(0,i.jsx)(n.p,{children:"Make it executable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"chmod +x ~/repos/myapp.git/hooks/post-receive\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"what-exactly-happens-during-git-push",children:["What Exactly Happens During ",(0,i.jsx)(n.code,{children:"git push"})]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"You run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git push production main\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Your local Git client:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Connects to the production server over SSH."}),"\n",(0,i.jsxs)(n.li,{children:["Invokes ",(0,i.jsx)(n.code,{children:"git-receive-pack"})," on the server\u2019s bare Git repo."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Git negotiates what data is needed:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"It sends new commits, trees, and blobs over SSH."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The server\u2019s Git receives the data and updates the bare repo."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"post-receive"})," hook is automatically triggered:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"It checks out the new code to the app directory."}),"\n",(0,i.jsxs)(n.li,{children:["It runs ",(0,i.jsx)(n.code,{children:"docker compose"})," to deploy the latest version."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Only once the hook script finishes does the ",(0,i.jsx)(n.code,{children:"git push"})," complete on your dev machine."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This means your ",(0,i.jsx)(n.code,{children:"git push"})," blocks and provides real-time feedback on deployment success or failure."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When you run ",(0,i.jsx)(n.code,{children:"git push production main"}),", Git connects to the server over ",(0,i.jsx)(n.strong,{children:"SSH"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Your dev Git sends commit data to the ",(0,i.jsx)(n.strong,{children:"bare repo"})," on the server."]}),"\n",(0,i.jsxs)(n.li,{children:["Git automatically runs the ",(0,i.jsx)(n.code,{children:"post-receive"})," hook."]}),"\n",(0,i.jsx)(n.li,{children:"The hook checks out the new code and runs Docker commands."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"No daemon, no polling, no fancy tools. Just Git + SSH + Docker."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Q: Does the push block until the deployment finishes?"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Yes. The ",(0,i.jsx)(n.code,{children:"git push"})," command will block until the ",(0,i.jsx)(n.code,{children:"post-receive"})," hook finishes. That way, you get immediate feedback if the deployment fails."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Q: Does Git use SSH to send data?"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Absolutely. All Git data (commits, trees, blobs) is transferred securely over SSH when using ",(0,i.jsx)(n.code,{children:"ssh://"})," remotes."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Q: Can I still use GitHub/GitLab?"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Yes! You can push to both:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git push origin main      # Push to GitHub\ngit push production main  # Deploy to server\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"final-thoughts",children:"Final Thoughts"}),"\n",(0,i.jsx)(n.p,{children:"This setup gives you a super simple and secure way to deploy code with nothing more than Git and Docker. For many indie devs and internal tools, it\u2019s all you really need."}),"\n",(0,i.jsxs)(n.p,{children:["Want logging? Add ",(0,i.jsx)(n.code,{children:">> /var/log/deploy.log 2>&1"})," to the hook.\nWant async? Run the hook script in the background with ",(0,i.jsx)(n.code,{children:"&"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Happy hacking! \ud83d\ude80"})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(96540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},97107:e=>{e.exports=JSON.parse('{"permalink":"/blog/ci-cd-githook-docker","editUrl":"https://github.com/liviaerxin/liviaerxin.github.io/edit/main/_ssg/docusaurus/../../blog/ci-cd-githook-docker.mdx","source":"@site/../../blog/ci-cd-githook-docker.mdx","title":"Lightweight CI/CD with Git Hooks and Docker Compose","description":"A lightweight CI/CD method using Git push and Docker, no third-party tools needed.","date":"2025-04-13T00:00:00.000Z","tags":[{"inline":true,"label":"ci/cd","permalink":"/blog/tags/ci-cd"},{"inline":true,"label":"docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"git","permalink":"/blog/tags/git"}],"readingTime":3.27,"hasTruncateMarker":true,"authors":[{"name":"Frank Chen","title":"Backend & Applied ML Engineer","url":"https://github.com/liviaerxin","imageURL":"https://github.com/liviaerxin.png","key":"frank","page":null}],"frontMatter":{"description":"A lightweight CI/CD method using Git push and Docker, no third-party tools needed.","keywords":["ci/cd","docker","git"],"image":"https://i.imgur.com/mErPwqL.png","tags":["ci/cd","docker","git"],"last_update":{"date":"2025-04-14T00:00:00.000Z"},"date":"2025-04-13T00:00:00.000Z","authors":["frank"]},"unlisted":false,"prevItem":{"title":"Orchestrating DAG-based task workflow in Celery","permalink":"/blog/celery-workflow"},"nextItem":{"title":"Intercepting HTTPs traffic from Android emulator","permalink":"/blog/how-to-intercept-https-traffic-from-android-emulator"}}')}}]);