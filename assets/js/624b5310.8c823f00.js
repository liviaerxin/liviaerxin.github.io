"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6842],{28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(96540);const t={},o=r.createContext(t);function i(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(o.Provider,{value:n},e.children)}},61278:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"docker/docker-setup-nfs-sever","title":"Set Up NFS Sever in Docker","description":"Setup NFS Sever","source":"@site/../../docs/docker/docker-setup-nfs-sever.mdx","sourceDirName":"docker","slug":"/docker/docker-setup-nfs-sever","permalink":"/docs/docker/docker-setup-nfs-sever","draft":false,"unlisted":false,"editUrl":"https://github.com/liviaerxin/liviaerxin.github.io/edit/main/docs/../../docs/docker/docker-setup-nfs-sever.mdx","tags":[{"inline":true,"label":"docker","permalink":"/docs/tags/docker"},{"inline":true,"label":"nfs","permalink":"/docs/tags/nfs"}],"version":"current","lastUpdatedBy":"liviaerxin","lastUpdatedAt":1746850681000,"frontMatter":{"foam_template":{"name":"Blog Docusaurus Template","description":"Creates Docusaurus blog/slip","filepath":"blog/setup-nfs-sever.md"},"authors":["frank"],"tags":["docker","nfs"],"description":"Setup NFS Sever","keywords":["Setup NFS Sever"],"image":"https://i.imgur.com/mErPwqL.png","date":"2025-02-11T00:00:00.000Z","draft":false,"enableComments":true},"sidebar":"docs","previous":{"title":"Share Data between Docker Containers","permalink":"/docs/docker/docker-containers-data-sharing"},"next":{"title":"Set Up Samba Server in Docker","permalink":"/docs/docker/docker-setup-samba-server"}}');var t=s(74848),o=s(28453);const i={foam_template:{name:"Blog Docusaurus Template",description:"Creates Docusaurus blog/slip",filepath:"blog/setup-nfs-sever.md"},authors:["frank"],tags:["docker","nfs"],description:"Setup NFS Sever",keywords:["Setup NFS Sever"],image:"https://i.imgur.com/mErPwqL.png",date:new Date("2025-02-11T00:00:00.000Z"),draft:!1,enableComments:!0},c="Set Up NFS Sever in Docker",d={},a=[{value:"Start Up NFS Server",id:"start-up-nfs-server",level:2},{value:"Use NFS Client in Docker",id:"use-nfs-client-in-docker",level:2},{value:"Use NFS Client With Volume Mount in Docker",id:"use-nfs-client-with-volume-mount-in-docker",level:2},{value:"Setup a NFS Server and Mount NFS Volume int Docker Compose",id:"setup-a-nfs-server-and-mount-nfs-volume-int-docker-compose",level:2},{value:"About NFS Options",id:"about-nfs-options",level:2}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"set-up-nfs-sever-in-docker",children:"Set Up NFS Sever in Docker"})}),"\n",(0,t.jsx)(n.p,{children:"This document will introduce to set up a NFS server in Docker container and use another Docker container to act as a Client to test this NFS server."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["To set up a ",(0,t.jsx)(n.strong,{children:"NFS server"})," in your Host, you can check ",(0,t.jsx)(n.a,{href:"https://phoenixnap.com/kb/ubuntu-nfs-server",children:"NFS server installed and configured"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"start-up-nfs-server",children:"Start Up NFS Server"}),"\n",(0,t.jsxs)(n.p,{children:["Use docker image ",(0,t.jsx)(n.a,{href:"https://hub.docker.com/r/gists/nfs-server",children:"gists/nfs-server"})," to start up a ",(0,t.jsx)(n.strong,{children:"NFS server"})," container."]}),"\n",(0,t.jsxs)(n.p,{children:["In OSX, it's critical to use ",(0,t.jsx)(n.code,{children:"volume mount"})," and avoid using ",(0,t.jsx)(n.code,{children:"bind mount"})," as we mentioned above."]}),"\n",(0,t.jsxs)(n.p,{children:["In Linux, it's okay to use either ",(0,t.jsx)(n.code,{children:"volume mount"})," or ",(0,t.jsx)(n.code,{children:"bind mount"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'docker run --rm -d \\\n    --name nfs \\\n    --privileged \\\n    -p 2049:2049 \\\n    -v /tmp/volume:/nfs-share \\\n    -e NFS_DIR=/nfs-share \\\n    -e NFS_OPTION="rw,fsid=0,async,no_subtree_check,no_auth_nlm,insecure,no_root_squash" \\\n    gists/nfs-server\n'})}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.p,{children:["Before we use an old nfs server image ",(0,t.jsx)(n.a,{href:"https://hub.docker.com/r/itsthenetwork/nfs-server-alpine/",children:"itsthenetwork/nfs-server-alpine"})," which was not maintained more than 4 years and not supported natively in platform ",(0,t.jsx)(n.code,{children:"linux/arm/v6"}),"."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker run -it --rm \\\n    --name nfs \\\n    --privileged \\\n    -v /tmp/volume:/nfs-share \\\n    -e SHARED_DIRECTORY=/nfs-share \\\n    -p 2049:2049 \\\n    itsthenetwork/nfs-server-alpine:latest\n"})})]}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.p,{children:["In OSX, due to the docker desktop itself is running in VM, it will cause some error like ",(0,t.jsx)(n.code,{children:"Operation not supported"})," when binding a local file folder via ",(0,t.jsx)(n.code,{children:"bind mount"})," even you set ",(0,t.jsx)(n.code,{children:"777"})," mask on the folder. So it's recommended to use ",(0,t.jsx)(n.code,{children:"volume"})," to bind to ",(0,t.jsx)(n.code,{children:"/mnt"})," in Samba server in OSX."]}),(0,t.jsxs)(n.p,{children:["Furthermore, the Samba server will log such message: ",(0,t.jsx)(n.code,{children:"error reading meta xattr: Not supported"}),"."]})]}),"\n",(0,t.jsxs)(n.p,{children:["Get the ip address of the ",(0,t.jsx)(n.strong,{children:"NFS"})," server, which will be used later to connect the ",(0,t.jsx)(n.strong,{children:"NFS"})," server when mounting in a Docker container client. If you only want to mount the ",(0,t.jsx)(n.strong,{children:"NFS"})," server from the host, you can just know the ip address of your host."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker inspect \\\n    -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' \\\n    nfs\n"})}),"\n",(0,t.jsx)(n.p,{children:"Here the output is"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"172.17.0.2\n"})}),"\n",(0,t.jsx)(n.h2,{id:"use-nfs-client-in-docker",children:"Use NFS Client in Docker"}),"\n",(0,t.jsx)(n.p,{children:"Let's make use of a Docker container to act in a NFS client to access shared data in the running-up NFS server."}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["run container as root by option ",(0,t.jsx)(n.code,{children:"--privileged"})," or ",(0,t.jsx)(n.code,{children:"--cap-add SYS_ADMIN"})," when permissions denied inside the container:"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker run -it --rm --privileged busybox sh\n"})}),"\n",(0,t.jsx)(n.p,{children:"Inside the container:"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Due to the fsid=0 parameter set in the /etc/exports file, there's no need to specify the folder name when mounting from a client. For example, this works fine even though the folder being mounted and shared is /nfs-share:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'# In the container\n\nmkdir /mnt\n# nfs v4\nmount -v -o vers=4,loud 172.17.0.2:/ /mnt\n\n# create a file to test\necho "some text here" > /mnt/file1.txt\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Then go to the Host to list directory ",(0,t.jsx)(n.code,{children:"/data/volume/test"}),", where you will find the ",(0,t.jsx)(n.code,{children:"file1.txt"})," is sitting."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"# In the host\ncat /data/volume/test/file1.txt\n"})}),"\n",(0,t.jsx)(n.h2,{id:"use-nfs-client-with-volume-mount-in-docker",children:"Use NFS Client With Volume Mount in Docker"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Create a NFS volume in Docker"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker volume create --driver local \\\n    --opt type=nfs \\\n    --opt o=addr=172.17.0.2,nfsvers=4 \\\n    --opt device=:/ \\\n    nfs-volume\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker inspect nfs-volume\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["Run the container with the created volume ",(0,t.jsx)(n.code,{children:"nfs-volume"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker run -it --rm \\\n    --privileged \\\n    --name nfs-test \\\n    -v nfs-volume:/mnt \\\n    busybox \\\n    sh\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Alternative, you can use the combined one command which will create a volume ",(0,t.jsx)(n.code,{children:"nfsvolume"}),","]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker run -it --rm \\\n    --privileged \\\n    --name nfs-test \\\n    --mount 'type=volume,source=nfsvolume,volume-driver=local,volume-opt=type=nfs,volume-opt=device=:/,\"volume-opt=o=addr=172.17.0.2,rw,nfsvers=4,async\",target=/mnt' \\\n    busybox \\\n    sh\n"})}),"\n",(0,t.jsx)(n.h2,{id:"setup-a-nfs-server-and-mount-nfs-volume-int-docker-compose",children:"Setup a NFS Server and Mount NFS Volume int Docker Compose"}),"\n",(0,t.jsx)(n.h2,{id:"about-nfs-options",children:"About NFS Options"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://www.thegeekdiary.com/understanding-the-etc-exports-file/",children:"Understanding the /etc/exports File \u2013 The Geek Diary"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);