"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7423],{5062:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>r,contentTitle:()=>o,default:()=>d,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"practice/fastapi-best-practices","title":"FastAPI Best Practices","description":"Lock Endpoint Request At A Time","source":"@site/../../docs/practice/fastapi-best-practices.mdx","sourceDirName":"practice","slug":"/practice/fastapi-best-practices","permalink":"/docs/practice/fastapi-best-practices","draft":false,"unlisted":false,"editUrl":"https://github.com/liviaerxin/liviaerxin.github.io/edit/master/_ssg/docusaurus/../../docs/practice/fastapi-best-practices.mdx","tags":[{"inline":true,"label":"fastapi","permalink":"/docs/tags/fastapi"},{"inline":true,"label":"python","permalink":"/docs/tags/python"},{"inline":true,"label":"http","permalink":"/docs/tags/http"}],"version":"current","lastUpdatedBy":"liviaerxin","lastUpdatedAt":1744927023000,"frontMatter":{"foam_template":{"name":"Docs Docusaurus Template","description":"Creates Docusaurus docs/slip","filepath":"docs/lock-http-request.md"},"sidebar_label":"Lock Http Request","description":"Lock Endpoint Request At A Time","keywords":["limit only one access to endpoint at a time","lock access to endpoint at a time"],"image":"https://i.imgur.com/mErPwqL.png","tags":["fastapi","python","http"],"date":"2024-06-21T00:00:00.000Z","author":"frank"},"sidebar":"docs","previous":{"title":"Dotfiles Guide","permalink":"/docs/practice/dotfiles-guide"},"next":{"title":"Git Best Practices","permalink":"/docs/practice/git-best-practices"}}');var s=i(74848),a=i(28453);const c={foam_template:{name:"Docs Docusaurus Template",description:"Creates Docusaurus docs/slip",filepath:"docs/lock-http-request.md"},sidebar_label:"Lock Http Request",description:"Lock Endpoint Request At A Time",keywords:["limit only one access to endpoint at a time","lock access to endpoint at a time"],image:"https://i.imgur.com/mErPwqL.png",tags:["fastapi","python","http"],date:new Date("2024-06-21T00:00:00.000Z"),author:"frank"},o="FastAPI Best Practices",r={},l=[{value:"Limit Only One Access to Endpoint at a Time",id:"limit-only-one-access-to-endpoint-at-a-time",level:2},{value:"Attach A Background Service Into the Application",id:"attach-a-background-service-into-the-application",level:2}];function p(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"fastapi-best-practices",children:"FastAPI Best Practices"})}),"\n",(0,s.jsx)(t.h2,{id:"limit-only-one-access-to-endpoint-at-a-time",children:"Limit Only One Access to Endpoint at a Time"}),"\n",(0,s.jsxs)(t.p,{children:["Limit only one access to an endpoint at a time with ",(0,s.jsx)(t.code,{children:"asyncio.Lock"})," in ",(0,s.jsx)(t.code,{children:"asyncio"})," in ",(0,s.jsx)(t.strong,{children:"FastAPI"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:"reference",children:"https://github.com/liviaerxin/hello-python/blob/main/fastapi_request_lock.py\n"})}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["NOTE: The ",(0,s.jsx)(t.code,{children:"asyncio.Lock"})," only take effect in the ",(0,s.jsx)(t.code,{children:"asyncio"})," loop level, if using ",(0,s.jsx)(t.code,{children:"unicorn"})," to run server in multiple processes, it can not lock the request!"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"No limitation."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:"reference",children:"https://github.com/liviaerxin/hello-python/blob/main/fastapi_request_nolock.py\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Limit only one access to an endpoint at a time with ",(0,s.jsx)(t.code,{children:"thread.Lock"})]}),"\n",(0,s.jsxs)(t.p,{children:["Limit only one access to an endpoint at a time with ",(0,s.jsx)(t.code,{children:"process.Lock"})]}),"\n",(0,s.jsx)(t.h2,{id:"attach-a-background-service-into-the-application",children:"Attach A Background Service Into the Application"}),"\n",(0,s.jsx)(t.p,{children:"Run a background service behind the FastAPI server:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["share the same ",(0,s.jsx)(t.code,{children:"asyncio"})," main loop with the server"]}),"\n",(0,s.jsx)(t.li,{children:"the service start when the server starts and stop when the server stops"}),"\n",(0,s.jsx)(t.li,{children:"it should be light-weight and non-CPU heavy workload"}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://docs.python.org/3/library/asyncio-task.html#asyncio.Task.cancel",children:"Coroutines and Tasks \u2014 Python 3.11.4 documentation"}),"\n",(0,s.jsx)(t.a,{href:"https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.create_task",children:"Event Loop \u2014 Python 3.11.4 documentation"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:"reference",children:"https://github.com/liviaerxin/hello-python/blob/main/fastapi_background_service.py\n"})})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,t,i)=>{i.d(t,{R:()=>c,x:()=>o});var n=i(96540);const s={},a=n.createContext(s);function c(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);