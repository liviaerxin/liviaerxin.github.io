"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7246],{28453:(i,e,n)=>{n.d(e,{R:()=>d,x:()=>a});var r=n(96540);const s={},l=r.createContext(s);function d(i){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof i?i(e):{...e,...i}}),[e,i])}function a(i){let e;return e=i.disableParentContext?"function"==typeof i.components?i.components(s):i.components||s:d(i.components),r.createElement(l.Provider,{value:e},i.children)}},28930:(i,e,n)=>{n.r(e),n.d(e,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"wiki/wiki-cuda","title":"Wiki NVIDIA Driver and CUDA Library","description":"Learn CUDA","source":"@site/../../docs/wiki/wiki-cuda.mdx","sourceDirName":"wiki","slug":"/wiki/wiki-cuda","permalink":"/docs/wiki/wiki-cuda","draft":false,"unlisted":false,"editUrl":"https://github.com/liviaerxin/liviaerxin.github.io/edit/master/_ssg/docusaurus/../../docs/wiki/wiki-cuda.mdx","tags":[{"inline":true,"label":"nvidia","permalink":"/docs/tags/nvidia"},{"inline":true,"label":"gpu","permalink":"/docs/tags/gpu"},{"inline":true,"label":"cuda","permalink":"/docs/tags/cuda"},{"inline":true,"label":"wsl","permalink":"/docs/tags/wsl"},{"inline":true,"label":"ubuntu","permalink":"/docs/tags/ubuntu"}],"version":"current","lastUpdatedBy":"liviaerxin","lastUpdatedAt":1745256514000,"frontMatter":{"foam_template":{"name":"Docs Docusaurus Template","description":"Creates Docusaurus docs/slip","filepath":"docs/wiki-cuda.md"},"sidebar_label":"Learn CUDA","description":"Learn CUDA","keywords":["wiki","cuda"],"image":"https://i.imgur.com/mErPwqL.png","tags":["nvidia","gpu","cuda","wsl","ubuntu"],"date":"2023-06-29T00:00:00.000Z","author":"frank"},"sidebar":"docs","previous":{"title":"Wiki Cryptography","permalink":"/docs/wiki/wiki-cryptography"},"next":{"title":"Cyber Security Wiki","permalink":"/docs/wiki/wiki-cybersecurity"}}');var s=n(74848),l=n(28453);const d={foam_template:{name:"Docs Docusaurus Template",description:"Creates Docusaurus docs/slip",filepath:"docs/wiki-cuda.md"},sidebar_label:"Learn CUDA",description:"Learn CUDA",keywords:["wiki","cuda"],image:"https://i.imgur.com/mErPwqL.png",tags:["nvidia","gpu","cuda","wsl","ubuntu"],date:new Date("2023-06-29T00:00:00.000Z"),author:"frank"},a="Wiki NVIDIA Driver and CUDA Library",o={},c=[{value:"NVIDIA Driver on Ubuntu",id:"nvidia-driver-on-ubuntu",level:2},{value:"Find out whether the host machine have NVIDIA GPU hardware",id:"find-out-whether-the-host-machine-have-nvidia-gpu-hardware",level:3},{value:"Check which NVIDIA driver being used",id:"check-which-nvidia-driver-being-used",level:3},{value:"Install the NVIDIA driver",id:"install-the-nvidia-driver",level:3},{value:"Verify the NVIDIA driver",id:"verify-the-nvidia-driver",level:3},{value:"Reload NVIDIA driver",id:"reload-nvidia-driver",level:3},{value:"NVIDIA CUDA Toolkit on WSL",id:"nvidia-cuda-toolkit-on-wsl",level:2},{value:"NVIDIA CUDA Toolkit on Ubuntu",id:"nvidia-cuda-toolkit-on-ubuntu",level:2},{value:"NVIDIA Container Toolkit",id:"nvidia-container-toolkit",level:2},{value:"FFmpeg in NVIDIA CUDA container",id:"ffmpeg-in-nvidia-cuda-container",level:2},{value:"Known issues",id:"known-issues",level:2},{value:"References",id:"references",level:2}];function t(i){const e={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...i.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"wiki-nvidia-driver-and-cuda-library",children:"Wiki NVIDIA Driver and CUDA Library"})}),"\n",(0,s.jsx)(e.p,{children:"Ecosystem:"}),"\n",(0,s.jsx)(e.p,{children:"Hardware:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"NVIDIA GPU(Hardware)"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Software:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["NVIDIA Driver(GPU, Graphics Card)","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"libnvidia-encode.so"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["CUDA Toolkit","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"libnvcuvid.so"}),"\n",(0,s.jsx)(e.li,{children:"libcuda.so"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"cuDNN library"}),"\n",(0,s.jsxs)(e.li,{children:["NVIDIA Container Toolkit","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"libnvidia-container.so"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://docs.nvidia.com/deploy/cuda-compatibility/graphics/CUDA-components.png",alt:"CUDA Components"})}),"\n",(0,s.jsx)(e.h2,{id:"nvidia-driver-on-ubuntu",children:"NVIDIA Driver on Ubuntu"}),"\n",(0,s.jsx)(e.h3,{id:"find-out-whether-the-host-machine-have-nvidia-gpu-hardware",children:"Find out whether the host machine have NVIDIA GPU hardware"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"$ lspci | grep VGA\n0000:ac:00.0 VGA compatible controller: NVIDIA Corporation Device 2233 (rev a1)\n"})}),"\n",(0,s.jsx)(e.p,{children:"or,"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"$ sudo lshw -C display\n  *-display\n       description: VGA compatible controller\n       product: NVIDIA Corporation\n       vendor: NVIDIA Corporation\n       physical id: 0\n       bus info: pci@0000:ac:00.0\n       logical name: /dev/fb0\n       version: a1\n       width: 64 bits\n       clock: 33MHz\n       capabilities: pm msi pciexpress vga_controller bus_master cap_list rom fb\n       configuration: depth=32 driver=nouveau latency=0 resolution=1920,1080\n       resources: iomemory:204f0-204ef iomemory:204f0-204ef irq:68 memory:99000000-99ffffff memory:204fe0000000-204fefffffff memory:204ff0000000-204ff1ffffff ioport:3000(size=128) memory:9a080000-9a0fffff\n"})}),"\n",(0,s.jsx)(e.p,{children:"or,"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"$ hwinfo --gfxcard --short\ngraphics card:\n                       nVidia VGA compatible controller\n\nPrimary display adapter: #94\n"})}),"\n",(0,s.jsx)(e.h3,{id:"check-which-nvidia-driver-being-used",children:"Check which NVIDIA driver being used"}),"\n",(0,s.jsxs)(e.p,{children:["Ubuntu is using ",(0,s.jsx)(e.strong,{children:"open-source Nouveau drivers"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"$ lsmod | grep nouveau\nnouveau              2306048  1\nmxm_wmi                16384  1 nouveau\ni2c_algo_bit           16384  1 nouveau\ndrm_ttm_helper         16384  1 nouveau\nttm                    86016  2 drm_ttm_helper,nouveau\ndrm_kms_helper        311296  1 nouveau\ndrm                   622592  5 drm_kms_helper,drm_ttm_helper,ttm,nouveau\nvideo                  65536  2 dell_wmi,nouveau\nwmi                    32768  7 dell_wmi_sysman,dell_wmi,wmi_bmof,dell_smbios,dell_wmi_descriptor,mxm_wmi,nouveau\n"})}),"\n",(0,s.jsxs)(e.p,{children:["Ubuntu is not using the ",(0,s.jsx)(e.strong,{children:"proprietary NVIDIA drivers"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"$ lsmod | grep nvidia\n"})}),"\n",(0,s.jsx)(e.h3,{id:"install-the-nvidia-driver",children:"Install the NVIDIA driver"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://www.cyberciti.biz/faq/ubuntu-linux-install-nvidia-driver-latest-proprietary-driver",children:"Ubuntu Linux Install Nvidia Driver (Latest Proprietary Driver)"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://phoenixnap.com/kb/install-nvidia-drivers-ubuntu#ftoc-heading-11",children:"Install Nvidia Beta Drivers via PPA Repository"})}),"\n",(0,s.jsx)(e.h3,{id:"verify-the-nvidia-driver",children:"Verify the NVIDIA driver"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"nvidia-smi\n\nnvidia-smi --query-gpu=driver_version --format=csv\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"dconfig -p | grep nvidia\n"})}),"\n",(0,s.jsx)(e.h3,{id:"reload-nvidia-driver",children:"Reload NVIDIA driver"}),"\n",(0,s.jsx)(e.p,{children:"Get related drivers,"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"lsmod | grep nvidia\n"})}),"\n",(0,s.jsx)(e.p,{children:"Unload drivers,"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo rmmod nvidia_drm\nsudo rmmod nvidia_modeset\nsudo rmmod nvidia_uvm\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo rmmod nvidia\n"})}),"\n",(0,s.jsx)(e.p,{children:"Load NVIDIA driver again,"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"nvidia-smi\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://stackoverflow.com/questions/43022843/nvidia-nvml-driver-library-version-mismatch#comment73133147_43022843",children:"cuda - Nvidia NVML Driver/library version mismatch - Stack Overflow"})}),"\n",(0,s.jsx)(e.p,{children:"Prevent updating NVIDIA driver,"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo apt-mark hold nvidia-driver-535\nsudo apt-mark hold nvidia-dkms-535\nsudo apt-mark hold nvidia-utils-535\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://askubuntu.com/questions/18654/how-to-prevent-updating-of-a-specific-package",children:"updates - How to prevent updating of a specific package? - Ask Ubuntu"})}),"\n",(0,s.jsx)(e.h2,{id:"nvidia-cuda-toolkit-on-wsl",children:"NVIDIA CUDA Toolkit on WSL"}),"\n",(0,s.jsx)(e.p,{children:"NVIDIA CUDA software stack on WSL 2:"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://docs.nvidia.com/cuda/wsl-user-guide/_images/wsl-launch-upt-0625-rz.png",alt:"NVIDIA CUDA software stack on WSL 2"})}),"\n",(0,s.jsx)(e.h2,{id:"nvidia-cuda-toolkit-on-ubuntu",children:"NVIDIA CUDA Toolkit on Ubuntu"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://docs.nvidia.com/cuda/",children:"Official documentation: CUDA installation"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://linuxhint.com/install-cuda-on-ubuntu-22-04-lts",children:"How to Install CUDA on Ubuntu 22.04 LTS"})}),"\n",(0,s.jsx)(e.h2,{id:"nvidia-container-toolkit",children:"NVIDIA Container Toolkit"}),"\n",(0,s.jsxs)(e.p,{children:["Build and run containers leveraging NVIDIA GPUs, already including ",(0,s.jsx)(e.strong,{children:"CUDA Toolkit"}),"."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://cloud.githubusercontent.com/assets/3028125/12213714/5b208976-b632-11e5-8406-38d379ec46aa.png",alt:"NVIDIA Container Toolkit"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/user-guide.html"})}),"\n",(0,s.jsx)(e.p,{children:"Prerequisites on Host Machine:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#nvidia-gpu-driver-on-ubuntu",children:"Nvidia GPU driver"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#nvidia-cuda-container-toolkit",children:"Nvidia CUDA Container Toolkit"})}),"\n",(0,s.jsx)(e.li,{children:"Docker"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["Running a docker container ",(0,s.jsx)(e.code,{children:"ubuntu"}),","]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/docker-specialized.html#",children:"Specialized Configurations with Docker \u2014 container-toolkit 1.14.1 documentation"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"$ docker run --rm --gpus all ubuntu nvidia-smi\n\n$ docker run --rm --gpus all ubuntu ldconfig -p | grep nvidia\n        libnvidia-ptxjitcompiler.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-ptxjitcompiler.so.1\n        libnvidia-pkcs11-openssl3.so.535.86.05 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-pkcs11-openssl3.so.535.86.05\n        libnvidia-opencl.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-opencl.so.1\n        libnvidia-nvvm.so.4 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-nvvm.so.4\n        libnvidia-ml.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-ml.so.1\n        libnvidia-cfg.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-cfg.so.1\n        libnvidia-allocator.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-allocator.so.1\n\n$ docker run --rm -e NVIDIA_DRIVER_CAPABILITIES=video --gpus all ubuntu ldconfig -p | grep nvidia\n        libnvidia-ptxjitcompiler.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-ptxjitcompiler.so.1\n        libnvidia-pkcs11-openssl3.so.535.86.05 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-pkcs11-openssl3.so.535.86.05\n        libnvidia-opticalflow.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-opticalflow.so.1\n        libnvidia-opencl.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-opencl.so.1\n        libnvidia-nvvm.so.4 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-nvvm.so.4\n        libnvidia-encode.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-encode.so.1\n        libnvidia-allocator.so.1 (libc6,x86-64) => /usr/lib/x86_64-linux-gnu/libnvidia-allocator.so.1\n"})}),"\n",(0,s.jsxs)(e.p,{children:["Running a docker container ",(0,s.jsx)(e.code,{children:"nvidia/cuda"}),","]}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:["Make sure the version of ",(0,s.jsx)(e.strong,{children:"CUDA container"})," ",(0,s.jsx)(e.code,{children:"nvidia/cuda:xx.x.x-base-ubuntu22.04"})," such as ",(0,s.jsx)(e.code,{children:"12.2.0"})," in following must be compatible with the version of the ",(0,s.jsx)(e.strong,{children:"Nvidia GPU driver"})," on the host platform such as ",(0,s.jsx)(e.code,{children:">525.60.13"}),"."]})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"docker run --rm --gpus all nvidia/cuda:12.2.0-base-ubuntu22.04 nvidia-smi\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"docker run --rm \\\n    --gpus all \\\n    -e NVIDIA_VISIBLE_DEVICES=all \\\n    -e NVIDIA_DRIVER_CAPABILITIES=compute,video,utility,graphics \\\n    nvidia/cuda:12.2.0-base-ubuntu22.04 nvidia-smi\n"})}),"\n",(0,s.jsxs)(e.p,{children:["More ",(0,s.jsx)(e.code,{children:"Dockerfile"})," examples:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",metastring:"reference",children:"https://github.com/liviaerxin/hello-dockerfile/blob/main/nvidia-cuda-ffmpeg/Dockerfile\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",metastring:"reference",children:"https://github.com/liviaerxin/hello-docker-compose/blob/main/nvidia-cuda/docker-compose.yml\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"../../code-snippets/dockerfile/nvidia-cuda-ffmpeg/Dockerfile",children:"Dockerfile"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(49480).A+"",children:"docker compose"})}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"ffmpeg-in-nvidia-cuda-container",children:"FFmpeg in NVIDIA CUDA container"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://developer.nvidia.com/ffmpeg",children:"https://developer.nvidia.com/ffmpeg"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://docs.nvidia.com/video-technologies/video-codec-sdk/12.0/ffmpeg-with-nvidia-gpu/index.html#compiling-for-linux",children:"https://docs.nvidia.com/video-technologies/video-codec-sdk/12.0/ffmpeg-with-nvidia-gpu/index.html#compiling-for-linux"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://developer.nvidia.com/blog/nvidia-ffmpeg-transcoding-guide/",children:"https://developer.nvidia.com/blog/nvidia-ffmpeg-transcoding-guide/"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"/docs/how-to/ffmpeg-on-cuda-container",children:"Install FFmpeg on Nvidia CUDA Container"})}),"\n",(0,s.jsx)(e.h2,{id:"known-issues",children:"Known issues"}),"\n",(0,s.jsxs)(e.p,{children:["After random long running time, in Nvidia docker the FFmpeg encoding stops and error comes out: ",(0,s.jsx)(e.code,{children:"CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected"}),".",(0,s.jsx)(e.br,{}),"\n",(0,s.jsx)(e.a,{href:"https://github.com/jellyfin/jellyfin/issues/9287",children:"[Issue]: NVidia Docker transcoding randomly stops working after 5 minutes to 4 hours later. \xb7 Issue #9287 \xb7 jellyfin/jellyfin \xb7 GitHub"})]}),"\n",(0,s.jsx)(e.h2,{id:"references",children:"References"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://docs.nvidia.com/deploy/cuda-compatibility/index.html",children:"CUDA And Nvidia Graphics Driver"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://docs.nvidia.com/cuda/wsl-user-guide/index.html",children:"CUDA on WSL User Guide"})})]})}function u(i={}){const{wrapper:e}={...(0,l.R)(),...i.components};return e?(0,s.jsx)(e,{...i,children:(0,s.jsx)(t,{...i})}):t(i)}},49480:(i,e,n)=>{n.d(e,{A:()=>r});const r=n.p+"assets/files/docker-compose-82c74b0de8fc41ced08aa64543a22057.yml"}}]);