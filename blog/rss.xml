<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Frank' Wiki Blog</title>
        <link>https://liviaerxin.github.io/blog</link>
        <description>Frank' Wiki Blog</description>
        <lastBuildDate>Fri, 09 May 2025 18:39:32 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Building an End-to-End ML Deployment Pipeline with MLflow, FastAPI, and Docker]]></title>
            <link>https://liviaerxin.github.io/blog/end-to-end-ml-deployment</link>
            <guid>https://liviaerxin.github.io/blog/end-to-end-ml-deployment</guid>
            <pubDate>Fri, 09 May 2025 18:39:32 GMT</pubDate>
            <description><![CDATA[Building an End-to-End ML Deployment Pipeline with MLflow, FastAPI, and Docker]]></description>
            <content:encoded><![CDATA[<p>Deploying machine learning models is more than just training — it’s about tracking, versioning, serving, and monitoring. In this post, I’ll walk you through how I built a production-ready ML pipeline using:</p>
<ul>
<li><strong>MLflow</strong> for experiment tracking and model registry</li>
<li><strong>FastAPI</strong> for serving models via REST API</li>
<li><strong>MinIO</strong> for artifact storage (S3-compatible)</li>
<li><strong>Docker Compose</strong> for orchestration</li>
</ul>
<p>👉 <strong>Full source code:</strong><br>
<a href="https://github.com/liviaerxin/mlops-fastapi-mlflow-minio" target="_blank" rel="noopener noreferrer">🔗 github.com/liviaerxin/mlops-fastapi-mlflow-minio</a></p>
<hr>
<p>⸻</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="project-overview">Project Overview<a href="https://liviaerxin.github.io/blog/end-to-end-ml-deployment#project-overview" class="hash-link" aria-label="Direct link to Project Overview" title="Direct link to Project Overview">​</a></h2>
<p>This project provides:</p>
<ul>
<li>A structured pipeline to <strong>log, register, and serve ML models</strong></li>
<li>Docker-based setup with <strong>MLflow, FastAPI, and MinIO</strong></li>
<li>Simple <strong>training</strong> and <strong>inference</strong> workflows</li>
</ul>
<p>📁 Project structure:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── docker-compose.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── inference-server/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── mlflow-local-train-remote-register/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── mlflow-server/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── train.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── README.md</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>🗂️ For full instructions, check the <a href="https://github.com/liviaerxin/mlops-fastapi-mlflow-minio/README.md" target="_blank" rel="noopener noreferrer">README</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="key-components">Key Components<a href="https://liviaerxin.github.io/blog/end-to-end-ml-deployment#key-components" class="hash-link" aria-label="Direct link to Key Components" title="Direct link to Key Components">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mlflow">MLflow<a href="https://liviaerxin.github.io/blog/end-to-end-ml-deployment#mlflow" class="hash-link" aria-label="Direct link to MLflow" title="Direct link to MLflow">​</a></h3>
<p>MLflow is a platform to manage the ML lifecycle, including experimentation, reproducibility, and deployment.</p>
<ul>
<li>Experiment tracking (<code>mlflow.log_param</code>, <code>mlflow.log_metric</code>)</li>
<li>Model registration and versioning</li>
<li>Stage promotion (<code>Staging</code>, <code>Production</code>)</li>
</ul>
<blockquote>
<p>NOTE: <strong>MLflow</strong> is used <code>remotely</code> in docker container environment here.</p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="minio">MinIO<a href="https://liviaerxin.github.io/blog/end-to-end-ml-deployment#minio" class="hash-link" aria-label="Direct link to MinIO" title="Direct link to MinIO">​</a></h3>
<p>S3-compatible artifact store used by <code>MLflow</code> to save models. For production, you might migrate to use AWS S3 or GCS.</p>
<blockquote>
<p>NOTE: <strong>MinIO</strong> is used <code>remotely</code> in docker container environment here.</p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fastapi">FastAPI<a href="https://liviaerxin.github.io/blog/end-to-end-ml-deployment#fastapi" class="hash-link" aria-label="Direct link to FastAPI" title="Direct link to FastAPI">​</a></h3>
<p>Simple REST API to serve ML models loaded from the MLflow registry.</p>
<p>Loads the remote model via:</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_tracking_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"MLFLOW_SERVER"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://127.0.0.1:5000"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyfunc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"models:/</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">MODEL_NAME</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">MODEL_STAGE</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>NOTE: <strong>FastAPI</strong> is used <code>remotely</code> in docker container environment here.</p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="training-and-registering-a-model">Training and Registering a Model<a href="https://liviaerxin.github.io/blog/end-to-end-ml-deployment#training-and-registering-a-model" class="hash-link" aria-label="Direct link to Training and Registering a Model" title="Direct link to Training and Registering a Model">​</a></h3>
<blockquote>
<p>NOTE: <strong>mlflow-local-train-remote-register</strong> is used <code>locally</code> outside the docker container environment here.</p>
</blockquote>
<p>Run the training script:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python train.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then log and register it to a remote MLflow server:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python register-remote.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Key code snippet:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">os.environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"MLFLOW_S3_ENDPOINT_URL"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://127.0.0.1:9000"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Expose the minio via host 9000 port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mlflow.set_tracking_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"http://127.0.0.1:5001"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Expose the mlflow server via host 5001 port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mlflow.pytorch.log_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model, </span><span class="token assign-left variable" style="color:#36acaa">artifact_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"model"</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">registered_model_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MODEL_NAME</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bonus-updating-models-and-rolling-deployment">Bonus: Updating Models and Rolling Deployment<a href="https://liviaerxin.github.io/blog/end-to-end-ml-deployment#bonus-updating-models-and-rolling-deployment" class="hash-link" aria-label="Direct link to Bonus: Updating Models and Rolling Deployment" title="Direct link to Bonus: Updating Models and Rolling Deployment">​</a></h4>
<p>You can update models by:</p>
<ul>
<li>Logging a new version to MLflow</li>
<li>Promoting it to <code>Production</code> stage</li>
<li>Using <strong>FastAPI</strong> logic to reload the latest version without downtime</li>
</ul>
<p>You may also support blue-green deployments using Docker or Kubernetes.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="conclusion">Conclusion<a href="https://liviaerxin.github.io/blog/end-to-end-ml-deployment#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>This setup gives you a scalable and reproducible ML deployment pipeline with clear separation of concerns:</p>
<ul>
<li>MLflow handles tracking and registry</li>
<li>MinIO manages artifact storage</li>
<li>FastAPI exposes inference endpoints</li>
<li>Docker Compose glues it all together</li>
</ul>
<p>⸻</p>
<p>🔗 GitHub Repo</p>
<p>All code and instructions:
<a href="https://github.com/liviaerxin/mlops-fastapi-mlflow-minio" target="_blank" rel="noopener noreferrer">🔗 github.com/liviaerxin/mlops-fastapi-mlflow-minio</a></p>]]></content:encoded>
            <category>ml</category>
            <category>backend</category>
        </item>
        <item>
            <title><![CDATA[Orchestrating DAG-based task workflow in Celery]]></title>
            <link>https://liviaerxin.github.io/blog/celery-workflow</link>
            <guid>https://liviaerxin.github.io/blog/celery-workflow</guid>
            <pubDate>Sun, 20 Apr 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Python Celery]]></description>
            <content:encoded><![CDATA[<p>What's <strong>workflow</strong> in Celery?</p>
<p>In <strong>Celery</strong>, <strong>workflow</strong> is composed of multiple <strong>tasks</strong>, and a <strong>task</strong> is deemed to be a universal unit of the <strong>workflow</strong>, as a function in the program. In <strong>Celery</strong>, it's recommended to divide a long-running task into multiple short-running tasks. <strong>workflow</strong> comes out to help ease the orchestrations of the work, such as <code>chain()</code> three tasks.</p>
<p><a href="https://github.com/liviaerxin/fastapi-celery-ml/blob/main/app/examples/celery_workflow.py" target="_blank" rel="noopener noreferrer">A demo workflow</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="construct-a-workflow">Construct a workflow<a href="https://liviaerxin.github.io/blog/celery-workflow#construct-a-workflow" class="hash-link" aria-label="Direct link to Construct a workflow" title="Direct link to Construct a workflow">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="avoid-running-synchronous-subtasks-within-a-task">Avoid running synchronous subtasks within a task<a href="https://liviaerxin.github.io/blog/celery-workflow#avoid-running-synchronous-subtasks-within-a-task" class="hash-link" aria-label="Direct link to Avoid running synchronous subtasks within a task" title="Direct link to Avoid running synchronous subtasks within a task">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="asynchronous-tasks-with-a-task">Asynchronous tasks with a task<a href="https://liviaerxin.github.io/blog/celery-workflow#asynchronous-tasks-with-a-task" class="hash-link" aria-label="Direct link to Asynchronous tasks with a task" title="Direct link to Asynchronous tasks with a task">​</a></h2>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bind</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">update_page_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># fetch_page -&gt; parse_page -&gt; store_page</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chain </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fetch_page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> parse_page</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> store_page_info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># chain()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chain</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch_page</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> myhttplib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_page</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> myparser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parse_document</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ignore_result</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">store_page_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PageInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> info</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="monitor-the-workflow">Monitor the workflow<a href="https://liviaerxin.github.io/blog/celery-workflow#monitor-the-workflow" class="hash-link" aria-label="Direct link to Monitor the workflow" title="Direct link to Monitor the workflow">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="resources">Resources<a href="https://liviaerxin.github.io/blog/celery-workflow#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<p><a href="https://blog.det.life/replacing-celery-tasks-inside-a-chain-b1328923fb02" target="_blank" rel="noopener noreferrer">Designing Dynamic Workflows with Celery and Python | by Marin Aglić | Data Engineer Things</a></p>
<p><a href="https://dev.to/akarshan/the-curious-case-of-celery-work-flows-39f7" target="_blank" rel="noopener noreferrer">The Curious Case of Celery Work-flows</a></p>
<p><a href="https://engineering.instawork.com/celery-eta-tasks-demystified-424b836e4e94" target="_blank" rel="noopener noreferrer">Celery ETA Tasks Demystified. At Instawork, we use Celery to queue… | by Oleg Pesok | Instawork Engineering</a></p>
<p><a href="https://docs.celeryq.dev/en/stable/userguide/canvas.html" target="_blank" rel="noopener noreferrer">Canvas: Designing Work-flows — Celery 5.3.6 documentation</a></p>]]></content:encoded>
            <category>Python Celery</category>
        </item>
        <item>
            <title><![CDATA[Lightweight CI/CD with Git Hooks and Docker Compose]]></title>
            <link>https://liviaerxin.github.io/blog/ci-cd-githook-docker</link>
            <guid>https://liviaerxin.github.io/blog/ci-cd-githook-docker</guid>
            <pubDate>Sun, 13 Apr 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[A lightweight CI/CD method using Git push and Docker, no third-party tools needed.]]></description>
            <content:encoded><![CDATA[<p>For small projects or self-hosted apps, using a full-fledged CI/CD tool like GitHub Actions or Jenkins can be overkill. What if you could have automated deployments <strong>without any third-party service</strong>, and all you need is <strong>Git and SSH</strong>?</p>
<p>In this post, we’ll walk through setting up a lightweight, no-cost CI/CD pipeline using <strong>Git hooks</strong> and <strong>Docker Compose</strong>, with deployments triggered by a simple <code>git push</code> to your production server.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="overview">Overview<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>Here’s the basic idea:</p>
<ol>
<li>You push your code from your dev machine to both:<!-- -->
<ul>
<li>A central Git host (like GitHub/GitLab)</li>
<li>Your production server (a bare Git repo)</li>
</ul>
</li>
<li>The production server runs a <code>post-receive</code> hook to:<!-- -->
<ul>
<li>Checkout the latest code</li>
<li>Rebuild and restart Docker containers</li>
</ul>
</li>
</ol>
<p>This method is great for solo developers or small teams who want simple, fast deployments without external dependencies.</p>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-by-step-setup">Step-by-Step Setup<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#step-by-step-setup" class="hash-link" aria-label="Direct link to Step-by-Step Setup" title="Direct link to Step-by-Step Setup">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-prepare-the-production-server">1. Prepare the Production Server<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#1-prepare-the-production-server" class="hash-link" aria-label="Direct link to 1. Prepare the Production Server" title="Direct link to 1. Prepare the Production Server">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="install-git-and-docker">Install Git and Docker:<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#install-git-and-docker" class="hash-link" aria-label="Direct link to Install Git and Docker:" title="Direct link to Install Git and Docker:">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-a-bare-git-repository">Create a bare Git repository:<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#create-a-bare-git-repository" class="hash-link" aria-label="Direct link to Create a bare Git repository:" title="Direct link to Create a bare Git repository:">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> ~/repos/myapp.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> ~/repos/myapp.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> init </span><span class="token parameter variable" style="color:#36acaa">--bare</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="set-up-ssh-access">Set up SSH access:<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#set-up-ssh-access" class="hash-link" aria-label="Direct link to Set up SSH access:" title="Direct link to Set up SSH access:">​</a></h4>
<p>From your dev machine, copy your SSH key to the production server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id user@yourserver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Test it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> user@yourserver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-add-the-production-server-as-a-remote-on-your-dev-machine">2. Add the Production Server as a Remote on Your Dev Machine<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#2-add-the-production-server-as-a-remote-on-your-dev-machine" class="hash-link" aria-label="Direct link to 2. Add the Production Server as a Remote on Your Dev Machine" title="Direct link to 2. Add the Production Server as a Remote on Your Dev Machine">​</a></h3>
<p>In your project repo:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> remote </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> production ssh://user@yourserver/home/user/repos/myapp.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now you can push to the production server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push production main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-create-a-post-receive-hook-on-the-server">3. Create a Post-Receive Hook on the Server<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#3-create-a-post-receive-hook-on-the-server" class="hash-link" aria-label="Direct link to 3. Create a Post-Receive Hook on the Server" title="Direct link to 3. Create a Post-Receive Hook on the Server">​</a></h3>
<p>On the production server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> ~/repos/myapp.git/hooks/post-receive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Paste the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">APP_DIR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/www/myapp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Checkout code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> --work-tree</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$APP_DIR</span><span class="token plain"> --git-dir</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> checkout </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Deploy with Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$APP_DIR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose up </span><span class="token parameter variable" style="color:#36acaa">-d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Make it executable:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x ~/repos/myapp.git/hooks/post-receive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-exactly-happens-during-git-push">What Exactly Happens During <code>git push</code><a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#what-exactly-happens-during-git-push" class="hash-link" aria-label="Direct link to what-exactly-happens-during-git-push" title="Direct link to what-exactly-happens-during-git-push">​</a></h2>
<ol>
<li>
<p>You run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push production main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Your local Git client:</p>
<ul>
<li>Connects to the production server over SSH.</li>
<li>Invokes <code>git-receive-pack</code> on the server’s bare Git repo.</li>
</ul>
</li>
<li>
<p>Git negotiates what data is needed:</p>
<ul>
<li>It sends new commits, trees, and blobs over SSH.</li>
</ul>
</li>
<li>
<p>The server’s Git receives the data and updates the bare repo.</p>
</li>
<li>
<p>The <code>post-receive</code> hook is automatically triggered:</p>
<ul>
<li>It checks out the new code to the app directory.</li>
<li>It runs <code>docker compose</code> to deploy the latest version.</li>
</ul>
</li>
<li>
<p>Only once the hook script finishes does the <code>git push</code> complete on your dev machine.</p>
</li>
</ol>
<p>This means your <code>git push</code> blocks and provides real-time feedback on deployment success or failure.</p>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-it-works">How It Works<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#how-it-works" class="hash-link" aria-label="Direct link to How It Works" title="Direct link to How It Works">​</a></h2>
<ul>
<li>When you run <code>git push production main</code>, Git connects to the server over <strong>SSH</strong>.</li>
<li>Your dev Git sends commit data to the <strong>bare repo</strong> on the server.</li>
<li>Git automatically runs the <code>post-receive</code> hook.</li>
<li>The hook checks out the new code and runs Docker commands.</li>
</ul>
<p>No daemon, no polling, no fancy tools. Just Git + SSH + Docker.</p>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="faq">FAQ<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ">​</a></h2>
<p><strong>Q: Does the push block until the deployment finishes?</strong></p>
<blockquote>
<p>Yes. The <code>git push</code> command will block until the <code>post-receive</code> hook finishes. That way, you get immediate feedback if the deployment fails.</p>
</blockquote>
<p><strong>Q: Does Git use SSH to send data?</strong></p>
<blockquote>
<p>Absolutely. All Git data (commits, trees, blobs) is transferred securely over SSH when using <code>ssh://</code> remotes.</p>
</blockquote>
<p><strong>Q: Can I still use GitHub/GitLab?</strong></p>
<blockquote>
<p>Yes! You can push to both:</p>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push origin main      </span><span class="token comment" style="color:#999988;font-style:italic"># Push to GitHub</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push production main  </span><span class="token comment" style="color:#999988;font-style:italic"># Deploy to server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="final-thoughts">Final Thoughts<a href="https://liviaerxin.github.io/blog/ci-cd-githook-docker#final-thoughts" class="hash-link" aria-label="Direct link to Final Thoughts" title="Direct link to Final Thoughts">​</a></h2>
<p>This setup gives you a super simple and secure way to deploy code with nothing more than Git and Docker. For many indie devs and internal tools, it’s all you really need.</p>
<p>Want logging? Add <code>&gt;&gt; /var/log/deploy.log 2&gt;&amp;1</code> to the hook.
Want async? Run the hook script in the background with <code>&amp;</code>.</p>
<p>Happy hacking! 🚀</p>]]></content:encoded>
            <category>ci/cd</category>
            <category>docker</category>
            <category>git</category>
        </item>
        <item>
            <title><![CDATA[Intercepting HTTPs traffic from Android emulator]]></title>
            <link>https://liviaerxin.github.io/blog/how-to-intercept-https-traffic-from-android-emulator</link>
            <guid>https://liviaerxin.github.io/blog/how-to-intercept-https-traffic-from-android-emulator</guid>
            <pubDate>Tue, 25 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[How to intercept HTTPs traffic from Android Emulator]]></description>
            <content:encoded><![CDATA[<p>Capturing HTTPS traffic from an Android device can be a crucial aspect of testing and debugging applications. Additionally, gaining insight into decrypted HTTPS messages can offer valuable information for troubleshooting or security analysis, albeit with ethical considerations in mind. Here, we explore two methods to achieve this: via an HTTPs proxy or a VPN.</p>
<p>Methods:</p>
<ul>
<li>
<p>HTTPs Proxy:</p>
<ul>
<li>Using an HTTPS proxy is a common approach to intercepting traffic from an Android device. This method involves setting up a proxy server that acts as an intermediary between the device and the internet, allowing for the capture and analysis of HTTPS requests and responses.</li>
<li>However, you have to install the Proxy SSL certificate on the Android device to facilitate decryption.</li>
</ul>
</li>
<li>
<p>VPN Server:</p>
<ul>
<li>Alternatively, leveraging a Virtual Private Network (VPN) can intercept HTTPS traffic from an Android device. By directing traffic through a VPN server, it becomes feasible to capture and analyze HTTPS requests and responses in transit.</li>
</ul>
</li>
</ul>
<p>Tools:</p>
<ul>
<li>MITM (Man In The Middle) Proxy: A versatile tool for intercepting and modifying HTTP and HTTPS traffic.</li>
<li>Proxyman: A user-friendly proxy tool with advanced features tailored for macOS and iOS devices, but also compatible with Android via manual proxy setup.</li>
<li>Fiddler Proxy: A robust proxy tool with powerful debugging capabilities, including support for decrypting HTTPS traffic.</li>
<li>Charles Proxy: A popular proxy tool known for its comprehensive debugging features, including SSL proxying for inspecting encrypted traffic.</li>
<li>HTTP Toolkit: A modern, cross-platform tool designed for intercepting, debugging, and mocking HTTP and HTTPS traffic.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="resources">Resources<a href="https://liviaerxin.github.io/blog/how-to-intercept-https-traffic-from-android-emulator#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<p><a href="https://medium.com/hackernoon/intercept-https-traffic-on-a-android-emulator-46023f17f6b3" target="_blank" rel="noopener noreferrer">https://medium.com/hackernoon/intercept-https-traffic-on-a-android-emulator-46023f17f6b3</a></p>
<p><a href="https://httptoolkit.com/docs/guides/android/" target="_blank" rel="noopener noreferrer">https://httptoolkit.com/docs/guides/android/</a></p>
<p><a href="https://proxyman.io/posts/2020-09-19-Intercept-https-traffic-on-android-emulator" target="_blank" rel="noopener noreferrer">https://proxyman.io/posts/2020-09-19-Intercept-https-traffic-on-android-emulator</a></p>
<p><a href="https://kpj.github.io/misc/InterceptingHTTPTraffic.html" target="_blank" rel="noopener noreferrer">https://kpj.github.io/misc/InterceptingHTTPTraffic.html</a></p>
<p><a href="https://www.reddit.com/r/androiddev/comments/17nfwyn/easiest_way_to_inspect_network_traffic_coming/" target="_blank" rel="noopener noreferrer">https://www.reddit.com/r/androiddev/comments/17nfwyn/easiest_way_to_inspect_network_traffic_coming/</a></p>
<p><a href="https://docs.telerik.com/fiddler-everywhere/capture-traffic/capture-from-android" target="_blank" rel="noopener noreferrer">https://docs.telerik.com/fiddler-everywhere/capture-traffic/capture-from-android</a></p>
<p><a href="https://www.linkedin.com/pulse/intercept-sslhttps-traffic-perform-penetration-testing-mayank-grover/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/pulse/intercept-sslhttps-traffic-perform-penetration-testing-mayank-grover/</a></p>
<p><a href="https://www.reddit.com/r/androiddev/comments/14x8eed/way_or_viewing_network_requests/" target="_blank" rel="noopener noreferrer">https://www.reddit.com/r/androiddev/comments/14x8eed/way_or_viewing_network_requests/</a></p>
<p><a href="https://beguier.eu/nicolas/articles/android-mitm-intercept-trafic.html" target="_blank" rel="noopener noreferrer">https://beguier.eu/nicolas/articles/android-mitm-intercept-trafic.html</a></p>]]></content:encoded>
            <category>how-to intercept</category>
            <category>HTTPs</category>
            <category>Android</category>
        </item>
        <item>
            <title><![CDATA[Generating self-signed SSL/TLS certificate for local IP address or local domain]]></title>
            <link>https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate</link>
            <guid>https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate</guid>
            <pubDate>Tue, 04 Feb 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Self Signed Certificate]]></description>
            <content:encoded><![CDATA[<p>In real life, when we build our website and make it public, some paid or free <strong>Certificate Authority</strong> (<strong>CA</strong>) will help us sign a certificate for our website <strong>domain</strong> (IP address is not acceptable!) and enable <strong>SSL/TLS</strong> connections from user browser to our server.</p>
<p>Given the secure reasons, the browser will only admit those servers's certificates signed from the authorized <strong>CA</strong>, and the <strong>CA</strong> certificate is kept in our host <strong>system trust store</strong>. In Linux, you can view the <strong>CA</strong> certificate file like <code>/etc/ssl/certs/ca-certificates.crt</code>.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>One of the most popular Certificate Authorities is <a href="https://letsencrypt.org/" target="_blank" rel="noopener noreferrer">Let's Encrypt</a>, which is a free and non-profit CA.</p></div></div>
<p>However, in many internal networks and development environments, we often need <strong>self-signed certificate</strong> more frequently.</p>
<p>Here is an example, we will generate a <strong>local server certificate</strong> that is signed by a <strong>local CA</strong>. Finally, let Chrome can visit our local website without security warning.</p>
<p>In brief, these steps we need to sign local sever certificate actually simulate how those CA sign certificates for public servers, as following:</p>
<ol>
<li>Create a local <strong>Root CA</strong>.</li>
<li>Create a <strong>CSR</strong>(Certificate Signing Request) file for local server <code>127.0.0.1</code>.</li>
<li>The local <strong>Root CA</strong> use the local server <code>127.0.0.1</code> <strong>CSR</strong> to generate a <strong>certificate</strong>.</li>
<li>Install the local <strong>Root CA</strong> into our system(Windows, Ubuntu or macOS) trust store.</li>
<li>Run a simple <strong>https</strong> server to test local server <strong>certificate</strong>.</li>
</ol>
<p>For those official CA, they have to validate the domain is owned by the server before the <code>step 3</code>, and we can ignore <code>step 4</code> as they are already installed into the system or the browser trust store.</p>
<p>And there is nice picture from <a href="https://www.linkedin.com/pulse/how-create-your-own-self-signed-root-certificate-shankar-gomare/" target="_blank" rel="noopener noreferrer">How to create your own self-signed root Certificate Authority(CA)</a> to show the relationship between <code>CA</code>, <code>server</code> and <code>browser</code>.</p>
<p><img decoding="async" loading="lazy" src="https://media.licdn.com/dms/image/C4E12AQGJ5hl3wTAyFg/article-inline_image-shrink_400_744/0/1589170084171?e=1701907200&amp;v=beta&amp;t=FaVSM-fIy4dc-SIftGYEuUc7GONcMLphssfteUKoWuA" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-create-a-local-ca">1. Create a local CA<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#1-create-a-local-ca" class="hash-link" aria-label="Direct link to 1. Create a local CA" title="Direct link to 1. Create a local CA">​</a></h2>
<p>Generate a file <code>RootCA.key</code> and a file <code>RootCA.crt</code> of our local root <strong>CA</strong>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-x509</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-new</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-sha256</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-days</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-newkey</span><span class="token plain"> rsa:2048 </span><span class="token parameter variable" style="color:#36acaa">-keyout</span><span class="token plain"> RootCA.key </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> RootCA.crt </span><span class="token parameter variable" style="color:#36acaa">-subj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/C=US/CN=Example-Root-CA"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can change <code>Example-Root-CA</code> to others or add more fields to CA.</p>
<p>[Optional] Create a CA with a configuration file,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-x509</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-new</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-keyout</span><span class="token plain"> RootCA.key </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> RootCA.crt </span><span class="token parameter variable" style="color:#36acaa">-config</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[ req ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">default_bits       = 2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">default_md         = sha256</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">default_days       = 3650</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">prompt             = no</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">distinguished_name = req_distinguished_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[ req_distinguished_name ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">C  = US</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ST = California</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">L  = San Francisco</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">O  = Example Corp</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">OU = IT Department</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">CN = www.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">emailAddress = admin@example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><strong>process substitution</strong> does not work in bash scripts!</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-create-a-signed-certificate-for-the-local-server">2. Create a signed certificate for the local server<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#2-create-a-signed-certificate-for-the-local-server" class="hash-link" aria-label="Direct link to 2. Create a signed certificate for the local server" title="Direct link to 2. Create a signed certificate for the local server">​</a></h2>
<p>Next, we should apply the local <strong>CA</strong> to sign a <strong>certificate</strong> for our local server using the server's <strong>Certificate Signing Request</strong> (<strong>CSR</strong>)
, which will be accessed through the <code>localhost</code> or <code>127.0.0.1</code> from our local machine.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-generate-the-servers-csr">2.1. Generate the server's CSR<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#21-generate-the-servers-csr" class="hash-link" aria-label="Direct link to 2.1. Generate the server's CSR" title="Direct link to 2.1. Generate the server's CSR">​</a></h3>
<p>When generating the <strong>CSR</strong> file with OpenSSL, we can either specify certain details directly in the command line or use a configuration file. While you can provide some information via command-line arguments, complex configurations like specifying <code>[v3_req]</code> and <code>[alt_names]</code> in belowing are typically done through a configuration file.</p>
<p><code>subjectAltName</code> in <code>[v3_req]</code> will let you specify more than domain/IP addresses as <strong>Subject Alternative Names</strong> (<strong>SANs</strong>). And now modern browser require the server certificate to include <strong>SANs</strong>. Usage of the <strong>Common Name</strong> (<strong>CN</strong>) alone is not considered secure enough, and omitting <strong>SANs</strong> may result a certificate validation error!</p>
<p>Here is an example for using pure arguments to specify <code>-subj</code>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-new</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-newkey</span><span class="token plain"> rsa:2048 </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-keyout</span><span class="token plain"> privkey.pem </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> csr.pem </span><span class="token parameter variable" style="color:#36acaa">-subj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/C=US/ST=California/L=San Francisco/O=Example Corp/OU=IT Department/CN=www.example.com/emailAddress=admin@example.com"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here is an example to use the configuration file as <code>-config</code>.</p>
<ol>
<li>[Optional] Customize DNS by editing <code>/etc/hosts</code> (Other machines also have to do this if they would like to visit the server),</li>
</ol>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/hosts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1   localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1   fake1.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1   fake2.local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Create a configure file for <strong>CSR</strong> including typical sections as:</li>
</ol>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">localhost.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[req]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_bits  = 2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distinguished_name = req_distinguished_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">req_extensions = v3_req</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prompt = no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[req_distinguished_name]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">countryName = XX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stateOrProvinceName = N/A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">localityName = N/A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">organizationName = Self-signed certificate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commonName = 127.0.0.1: Self-signed certificate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[v3_req]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjectAltName = @alt_names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[alt_names]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP.1 = 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DNS.1 = localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DNS.2 = fake1.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DNS.3 = fake2.local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Generates the <strong>CSR</strong></li>
</ol>
<p>To generate a <strong>CSR</strong> using the configuration file with OpenSSL, you can use the following command:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-new</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-keyout</span><span class="token plain"> localhost.key </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> localhost.csr </span><span class="token parameter variable" style="color:#36acaa">-config</span><span class="token plain"> localhost.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>[Optional] mix <code>-subj</code> and <code>-config</code>, to be short like:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">SAN_LIST</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"[SAN]</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">subjectAltName=DNS:localhost, DNS:*.localhost, IP:127.0.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-new</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-newkey</span><span class="token plain"> rsa:2048 </span><span class="token parameter variable" style="color:#36acaa">-keyout</span><span class="token plain"> localhost.key </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> localhost.csr </span><span class="token parameter variable" style="color:#36acaa">-subj</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/C=US/ST=YourState/L=YourCity/O=Example CORP/CN=localhost.local"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-reqexts</span><span class="token plain"> SAN </span><span class="token parameter variable" style="color:#36acaa">-config</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$SAN_LIST</span><span class="token string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here, <code>localhost.conf</code> is the configuration file and the two outputs are:</p>
<ul>
<li><code>localhost.key</code> is the private key file for the local server to communicate with the clients securely.</li>
<li><code>localhost.csr</code> is the <strong>CSR</strong> file that the local server will use in the next step to sign its certificate from the local CA.</li>
</ul>
<ol start="4">
<li>Verify the <strong>CSR</strong> file <code>localhost.csr</code>:</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-text</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-noout</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-verify</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> localhost.csr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-sign-the-csr-with-the-local-ca">2.2. Sign the CSR with the local CA<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#22-sign-the-csr-with-the-local-ca" class="hash-link" aria-label="Direct link to 2.2. Sign the CSR with the local CA" title="Direct link to 2.2. Sign the CSR with the local CA">​</a></h3>
<p>Now, it's time for <strong>local CA</strong> to sign a certificate for our local server by using the server's <strong>CSR</strong> <code>localhost.csr</code> file, thereby issuing a signed certificate.</p>
<ul>
<li>Generates <code>localhost.crt</code> by using CSR <code>localhost.csr</code>,</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 </span><span class="token parameter variable" style="color:#36acaa">-req</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-sha256</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-days</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> localhost.csr </span><span class="token parameter variable" style="color:#36acaa">-CA</span><span class="token plain"> RootCA.crt </span><span class="token parameter variable" style="color:#36acaa">-CAkey</span><span class="token plain"> RootCA.key </span><span class="token parameter variable" style="color:#36acaa">-CAcreateserial</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-extensions</span><span class="token plain"> v3_req </span><span class="token parameter variable" style="color:#36acaa">-extfile</span><span class="token plain"> localhost.conf </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> localhost.crt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><code>-extensions v3_req -extfile localhost.conf</code>: <code>openssl x509</code> will contain <code>subjectAltName</code> extension in the certificate.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>If <code>X509</code> extensions(<code>subjectAltName</code>) are missing from the certificate, the browser will still report security issues, such as <strong>its security certificate does not specify Subject Alternative Names.</strong></p></div></div>
<p>Or after <strong>OpenSSL v3</strong>, you can copy the extensions specified in the <strong>CSR</strong> to the certificate by <code>openssl x509</code> as this:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 </span><span class="token parameter variable" style="color:#36acaa">-req</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-sha256</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-days</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> localhost.csr </span><span class="token parameter variable" style="color:#36acaa">-CA</span><span class="token plain"> RootCA.crt </span><span class="token parameter variable" style="color:#36acaa">-CAkey</span><span class="token plain"> RootCA.key </span><span class="token parameter variable" style="color:#36acaa">-CAcreateserial</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-copy_extensions</span><span class="token plain"> copyall </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> localhost.crt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>View the generated <code>localhost.crt</code>:</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 </span><span class="token parameter variable" style="color:#36acaa">-text</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-noout</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> localhost.crt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Verify the generated<code>localhost.crt</code>:</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl verify </span><span class="token parameter variable" style="color:#36acaa">-verbose</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-CAfile</span><span class="token plain"> RootCA.crt localhost.crt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the CA and Subject are the same one, the step of creating the local CA can be skipped.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl req </span><span class="token parameter variable" style="color:#36acaa">-x509</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-nodes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-days</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">730</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-newkey</span><span class="token plain"> rsa:2048 </span><span class="token parameter variable" style="color:#36acaa">-keyout</span><span class="token plain"> localhost.key </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> localhost.crt </span><span class="token parameter variable" style="color:#36acaa">-config</span><span class="token plain"> localhost.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-use-the-signed-certificate-in-the-local-server">3. Use the signed certificate in the local server<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#3-use-the-signed-certificate-in-the-local-server" class="hash-link" aria-label="Direct link to 3. Use the signed certificate in the local server" title="Direct link to 3. Use the signed certificate in the local server">​</a></h2>
<p>Run up a node https server to use the <strong>signed certificate</strong> for the local sever.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx http-server </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8082</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--ssl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--cert</span><span class="token plain"> localhost.crt </span><span class="token parameter variable" style="color:#36acaa">--key</span><span class="token plain"> localhost.key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then visit:</p>
<ul>
<li><a href="https://127.0.0.1:8082/" target="_blank" rel="noopener noreferrer">https://127.0.0.1:8082/</a></li>
<li><a href="https://localhost:8082/" target="_blank" rel="noopener noreferrer">https://localhost:8082/</a></li>
</ul>
<p>The browser will give you security warning as the local <strong>root CA</strong> is not trusted in default.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-install-the-local-ca">4. Install the local CA<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#4-install-the-local-ca" class="hash-link" aria-label="Direct link to 4. Install the local CA" title="Direct link to 4. Install the local CA">​</a></h2>
<p>TO trust the root <strong>local CA</strong>, we must install the <strong>local CA</strong> certificate <code>RootCA.crt</code> into each system <strong>trust store</strong> or each browser.</p>
<ul>
<li>Windows system trust store</li>
<li>Ubuntu system trust store</li>
<li>macOS system trust store</li>
</ul>
<p>Then visit again, the browser will show green!</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optional-sign-the-csr-with-openssl-ca">[Optional] Sign the CSR with <code>openssl ca</code><a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#optional-sign-the-csr-with-openssl-ca" class="hash-link" aria-label="Direct link to optional-sign-the-csr-with-openssl-ca" title="Direct link to optional-sign-the-csr-with-openssl-ca">​</a></h2>
<p>For complicated configuration for CA to sign a certificate, you can use <code>openssl ca</code> and the configuration file is like:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /path/to/your/ca/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> newcerts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> index.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> serial</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34"> /path/to/your/ca/openssl.cnf</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[ ca ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">default_ca = CA_default</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[ CA_default ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">dir               = /path/to/your/ca</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">database          = </span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">/index.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">new_certs_dir     = </span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">/newcerts</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">certificate       = </span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">/RootCA.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">serial            = </span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">/serial</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">private_key       = </span><span class="token string variable" style="color:#36acaa">$dir</span><span class="token string" style="color:#e3116c">/RootCA.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">default_days      = 365</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">default_md        = sha256</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">policy            = policy_any</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">x509_extensions   = usr_cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">copy_extensions   = copy</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[ policy_any ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">countryName             = supplied</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">stateOrProvinceName     = supplied</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">organizationName        = supplied</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">organizationalUnitName  = optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">commonName              = supplied</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">emailAddress            = optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[ usr_cert ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">basicConstraints=CA:FALSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">nsCertType = client, email</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">nsComment = "OpenSSL Generated Certificate"</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">subjectKeyIdentifier=hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">authorityKeyIdentifier=keyid,issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl ca </span><span class="token parameter variable" style="color:#36acaa">-config</span><span class="token plain"> /path/to/your/ca/openssl.cnf </span><span class="token parameter variable" style="color:#36acaa">-in</span><span class="token plain"> localhost.csr </span><span class="token parameter variable" style="color:#36acaa">-out</span><span class="token plain"> localhost.crt </span><span class="token parameter variable" style="color:#36acaa">-batch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="troubleshooting">Troubleshooting<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="chrome-red-security-warning">Chrome <strong>red</strong> security warning<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#chrome-red-security-warning" class="hash-link" aria-label="Direct link to chrome-red-security-warning" title="Direct link to chrome-red-security-warning">​</a></h3>
<ol>
<li>Go to <code>Developer Tools</code>.</li>
<li>Click <code>Security</code> tab.</li>
<li>Check <code>Security overview</code> issues.</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="resources">Resources<a href="https://liviaerxin.github.io/blog/how-to-create-self-signed-certificate#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<p><a href="https://gist.github.com/cecilemuller/9492b848eb8fe46d462abeb26656c4f8" target="_blank" rel="noopener noreferrer">How to create an HTTPS certificate for localhost domains · GitHub</a></p>
<p><a href="https://www.golinuxcloud.com/add-x509-extensions-to-certificate-openssl/" target="_blank" rel="noopener noreferrer">How to add X.509 extensions to certificate OpenSSL | GoLinuxCloud</a></p>
<p><a href="https://github.com/FiloSottile/mkcert" target="_blank" rel="noopener noreferrer">GitHub - FiloSottile/mkcert: A simple zero-config tool to make locally trusted development certificates with any names you'd like.</a></p>]]></content:encoded>
            <category>ssl</category>
            <category>certificate</category>
        </item>
        <item>
            <title><![CDATA[Mounting ISO image file on macOS and Linux]]></title>
            <link>https://liviaerxin.github.io/blog/how-to-mount-iso-file</link>
            <guid>https://liviaerxin.github.io/blog/how-to-mount-iso-file</guid>
            <pubDate>Sat, 21 Dec 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[How to mount ISO file]]></description>
            <content:encoded><![CDATA[<p>For viewing the content of the <strong>ISO</strong> image file like <code>*.iso</code>, we can mount it to filesystem and loop up its contained files.</p>
<p>Mounting the <strong>ISO</strong> image file in linux is much easier than doing in macOS. Because <strong>ISO</strong> use <code>ISO9660</code> file system while the <code>hdiutil</code> in macOS does not support it originally. That will require more steps to implement in comparison with one command like <code>mount </code> in Linux.</p>
<p><a href="https://www.cyberciti.biz/tips/how-to-mount-iso-image-under-linux.html" target="_blank" rel="noopener noreferrer">How to mount iso image in Linux</a></p>
<p><a href="https://unix.stackexchange.com/questions/298685/can-a-mac-mount-a-debian-install-cd" target="_blank" rel="noopener noreferrer">osx - Can a Mac mount a Debian install CD? - Unix &amp; Linux Stack Exchange</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mount-iso-file-on-linux">Mount ISO file on Linux<a href="https://liviaerxin.github.io/blog/how-to-mount-iso-file#mount-iso-file-on-linux" class="hash-link" aria-label="Direct link to Mount ISO file on Linux" title="Direct link to Mount ISO file on Linux">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mount-iso-file-on-macos">Mount ISO file on macOS<a href="https://liviaerxin.github.io/blog/how-to-mount-iso-file#mount-iso-file-on-macos" class="hash-link" aria-label="Direct link to Mount ISO file on macOS" title="Direct link to Mount ISO file on macOS">​</a></h2>
<ol>
<li>Attaching as a block device</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># the '-nomount' option avoids the 'mount failed' error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❯ hdiutil attach </span><span class="token parameter variable" style="color:#36acaa">-nomount</span><span class="token plain"> mantic-mini-iso-amd64.iso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/disk6          	GUID_partition_scheme          	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/disk6s1        	Microsoft Basic Data           	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/disk6s2        	EFI                            	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/disk6s3        	Microsoft Basic Data  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ diskutil info /dev/disk6s2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Device Identifier:         disk6s2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Device Node:               /dev/disk6s2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Whole:                     No</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Part of Whole:             disk6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Volume Name:               ESP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Mounted:                   No</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Partition Type:            EFI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   File System Personality:   MS-DOS FAT12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Type </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Bundle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:             msdos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Name </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">User Visible</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:       MS-DOS </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FAT12</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>[Optional] Load CD9660</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Load the kext module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> kmutil load </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /System/Library/Extensions/cd9660.kext</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Mount the disk with cd9660 (aka ISO9660) file system</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># create mount point</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /tmp/ubuntu-mantic-iso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># mount the disk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> cd9660 /dev/disk6 /tmp/ubuntu-mantic-iso</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>View the <code>iso</code> files,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ tree </span><span class="token parameter variable" style="color:#36acaa">-h</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-L</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> /tmp/ubuntu-mantic-iso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.0K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  /tmp/ubuntu-mantic-iso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.0K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  EFI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; └── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.0K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     ├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">938K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  bootx64.efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     ├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.2M</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  grubx64.efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     └── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">841K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  mmx64.efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.0K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; └── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.0K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     ├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.0K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  fonts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     ├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">169</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  grub.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     ├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> 38K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  i386-pc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp;     └── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> 36K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  x86_64-efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.0K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  boot.catalog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.0K</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  casper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> 56M</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  initrd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> 13M</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  vmlinuz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> directories, </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>Umount the disk</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">umount</span><span class="token plain"> /dev/disk6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>Detach the disk</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ hdiutil detach /dev/disk6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>how-to</category>
            <category>osx</category>
            <category>linux</category>
        </item>
        <item>
            <title><![CDATA[Inspect Shared Library]]></title>
            <link>https://liviaerxin.github.io/blog/inspect-shared-library</link>
            <guid>https://liviaerxin.github.io/blog/inspect-shared-library</guid>
            <pubDate>Mon, 02 Dec 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[Test Dynamic Library]]></description>
            <content:encoded><![CDATA[<p>Concepts:</p>
<ul>
<li>Show shared libraries dependencies(detect what shared libraries an executable or a another shared libraries depend on)</li>
<li>Check/Test dependent shared libraries loaded successfully</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-ldd-command">Using <code>ldd</code> Command<a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-ldd-command" class="hash-link" aria-label="Direct link to using-ldd-command" title="Direct link to using-ldd-command">​</a></h2>
<p>Available in Linux:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ldd /usr/bin/vim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	linux-vdso.so.1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x00007ffc75fb1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	libgtk-3.so.0 </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/libgtk-3.so.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x00007fa4dcb5e000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	libgdk-3.so.0 </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/libgdk-3.so.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x00007fa4dca64000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	libXau.so.6 </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/libXau.so.6 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x00007fa4db7a9000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	liblzma.so.5 </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/liblzma.so.5 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x00007fa4db63f000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	liblz4.so.1 </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/liblz4.so.1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x00007fa4db61d000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	libgcrypt.so.20 </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/libgcrypt.so.20 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x00007fa4db4ff000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	libgpg-error.so.0 </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/libgpg-error.so.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x00007fa4db4d8000</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-objdump-command">Using <code>objdump</code> Command<a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-objdump-command" class="hash-link" aria-label="Direct link to using-objdump-command" title="Direct link to using-objdump-command">​</a></h2>
<p>Available in Linux:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objdump </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /usr/bin/vim </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'NEEDED'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libpython3.7m.so.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libcrypt.so.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libpthread.so.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libdl.so.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libutil.so.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libm.so.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libselinux.so.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libtinfo.so.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libacl.so.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libgpm.so.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NEEDED               libc.so.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-readelf-command">Using <code>readelf</code> Command<a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-readelf-command" class="hash-link" aria-label="Direct link to using-readelf-command" title="Direct link to using-readelf-command">​</a></h2>
<p>Available in Linux:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">readelf </span><span class="token parameter variable" style="color:#36acaa">--dynamic</span><span class="token plain"> /usr/bin/vim </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> NEEDED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libpython3.7m.so.1.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libcrypt.so.2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libpthread.so.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libdl.so.2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libutil.so.1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libm.so.6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libselinux.so.1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libtinfo.so.6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libacl.so.1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libgpm.so.2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0000000000000001 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NEEDED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">             Shared library: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">libc.so.6</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-otool-command">Using <code>otool</code> Command<a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-otool-command" class="hash-link" aria-label="Direct link to using-otool-command" title="Direct link to using-otool-command">​</a></h2>
<p>Available in OSX:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">otool </span><span class="token parameter variable" style="color:#36acaa">-L</span><span class="token plain"> libOpenCvSharpExtern.dylib</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="reading-the-procpidmaps-file">Reading the <code>/proc/&lt;pid&gt;/maps</code> File<a href="https://liviaerxin.github.io/blog/inspect-shared-library#reading-the-procpidmaps-file" class="hash-link" aria-label="Direct link to reading-the-procpidmaps-file" title="Direct link to reading-the-procpidmaps-file">​</a></h2>
<p>Available in Linux:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/179015/maps </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7f2cb67c3000-7f2cb67c6000 r--p 00000000 08:13 </span><span class="token number" style="color:#36acaa">3810274</span><span class="token plain">                    /usr/lib/libnss_files-2.31.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7f2cb67c6000-7f2cb67cd000 r-xp 00003000 08:13 </span><span class="token number" style="color:#36acaa">3810274</span><span class="token plain">                    /usr/lib/libnss_files-2.31.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7f2cb6a89000-7f2cb6a8a000 r--p 00002000 08:13 </span><span class="token number" style="color:#36acaa">3810903</span><span class="token plain">                    /usr/lib/libutil-2.31.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7f2cb6a8a000-7f2cb6a8b000 r--p 00002000 08:13 </span><span class="token number" style="color:#36acaa">3810903</span><span class="token plain">                    /usr/lib/libutil-2.31.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7f2cb9802000-7f2cb9803000 rw-p 00000000 00:00 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7ffe77658000-7ffe7767a000 rw-p 00000000 00:00 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7ffe776c8000-7ffe776cc000 r--p 00000000 00:00 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">vvar</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7ffe776cc000-7ffe776ce000 r-xp 00000000 00:00 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">vdso</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffffffffff600000-ffffffffff601000 </span><span class="token parameter variable" style="color:#36acaa">--xp</span><span class="token plain"> 00000000 00:00 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">vsyscall</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'$NF!~/\.so/{next} {$0=$NF} !a[$0]++'</span><span class="token plain"> /proc/179015/maps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libpython3.8.so.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libgpg-error.so.0.29.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libgcrypt.so.20.2.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/liblz4.so.1.9.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/liblzma.so.5.2.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libsystemd.so.0.28.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libogg.so.0.8.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libvorbis.so.0.4.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libblkid.so.1.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libXdmcp.so.6.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libXau.so.6.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/libdatrie.so.1.3.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-vmmap-command">Using <code>vmmap</code> Command<a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-vmmap-command" class="hash-link" aria-label="Direct link to using-vmmap-command" title="Direct link to using-vmmap-command">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-ctypes-in-python">Using <code>ctypes</code> in Python<a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-ctypes-in-python" class="hash-link" aria-label="Direct link to using-ctypes-in-python" title="Direct link to using-ctypes-in-python">​</a></h2>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ctypes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctypes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cdll</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LoadLibrary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"libOpenCvSharpExtern.so"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctypes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CDLL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"libOpenCvSharpExtern.so"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">dlopen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DYLD_PRINT_LIBRARIES</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> dlopen_test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">opt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">vcpkg</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">installed</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">arm64</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">osx</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dynamic</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lib</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">libpng16</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dylib</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objdump </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /usr/local/lib/libOpenCvSharpExtern.so</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-nm">Using <code>nm</code><a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-nm" class="hash-link" aria-label="Direct link to using-nm" title="Direct link to using-nm">​</a></h3>
<p>Show list of symbols:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ nm </span><span class="token parameter variable" style="color:#36acaa">-g</span><span class="token plain"> /opt/vcpkg/installed/arm64-osx-dynamic/lib/libintl.8.dylib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U _CFArrayGetCount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U _CFArrayGetValueAtIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U _CFGetTypeID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U _CFLocaleCopyPreferredLanguages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U _CFPreferencesCopyAppValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U _CFRelease</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U _CFStringGetCString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U _CFStringGetTypeID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U __DefaultRuneLocale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 U ___CFConstantStringClassReference</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-dumpbin">Using <code>dumpbin</code><a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-dumpbin" class="hash-link" aria-label="Direct link to using-dumpbin" title="Direct link to using-dumpbin">​</a></h3>
<p>Available in Windows</p>
<p>Show dependent dynamic libraries(<code>DLL</code>):</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dumpbin </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dependents your_dll_file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dll</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-microsoftpowershell">Using <code>Microsoft.PowerShell</code><a href="https://liviaerxin.github.io/blog/inspect-shared-library#using-microsoftpowershell" class="hash-link" aria-label="Direct link to using-microsoftpowershell" title="Direct link to using-microsoftpowershell">​</a></h3>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">Get-Command</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"C:\Path\To\Thing.dll"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FileVersionInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">Get-Item</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"C:\Windows\System32\nvcuda.dll"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VersionInfo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="useful-environment-variables">Useful Environment Variables<a href="https://liviaerxin.github.io/blog/inspect-shared-library#useful-environment-variables" class="hash-link" aria-label="Direct link to Useful Environment Variables" title="Direct link to Useful Environment Variables">​</a></h2>
<p>OSX:</p>
<ul>
<li><code>DYLD_LIBRARY_PATH</code></li>
<li><code>DYLD_PRINT_LIBRARIES</code></li>
<li><code>DYLD_PRINT_STATISTICS</code></li>
</ul>
<p>Linux:</p>
<ul>
<li><code>LD_LIBRARY_PATH</code></li>
<li><code>LD_DEBUG=libs</code></li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a href="https://liviaerxin.github.io/blog/inspect-shared-library#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p><a href="https://learn.microsoft.com/en-us/cpp/build/reference/c-cpp-build-tools" target="_blank" rel="noopener noreferrer">Additional MSVC Build Tools</a></p>
<p><a href="https://www.baeldung.com/linux/show-shared-libraries-executables" target="_blank" rel="noopener noreferrer">How to Show All Shared Libraries Used by Executables in Linux</a></p>]]></content:encoded>
            <category>debug</category>
            <category>shared library</category>
            <category>osx</category>
            <category>windows</category>
            <category>linux</category>
        </item>
        <item>
            <title><![CDATA[QEMU Direct Linux Kernel Boot]]></title>
            <link>https://liviaerxin.github.io/blog/qemu-linux-kernel-boot</link>
            <guid>https://liviaerxin.github.io/blog/qemu-linux-kernel-boot</guid>
            <pubDate>Thu, 26 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[QEMU Linux Kernel Boot]]></description>
            <content:encoded><![CDATA[<p>Here, I will employ QEMU to emulate a minimal <strong>Linux x86_64</strong> platform with a minimal root filesystem from scratch, as well as debugging with <code>GDB</code>:</p>
<ul>
<li>Build <strong>Linux x86_64</strong> kernel</li>
<li>Build <strong>Linux x86_64</strong> rootfs(root filesystem)</li>
<li>Run QEMU</li>
<li>Debug with <code>GDB</code></li>
</ul>
<p>Why do I use QEMU to boot Linux kernel directly with skipping BIOS/UEFI boot procedures?</p>
<p>Use QEMU to launch a Linux kernel directly without having to make a fully bootable disk image. This is very useful for:</p>
<ul>
<li>Linux kernel testing</li>
<li>root filesystem testing</li>
<li>arm system emulation</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="prerequisites">Prerequisites<a href="https://liviaerxin.github.io/blog/qemu-linux-kernel-boot#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<p>On Ubuntu,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> fakeroot build-essential ncurses-dev xz-utils libssl-dev </span><span class="token function" style="color:#d73a49">bc</span><span class="token plain"> flex libelf-dev bison</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>On macOS, you need create a <strong>Case Sensitive</strong> filesystem and use <strong>GNU GCC</strong> instead of <code>Clang</code> the following ways:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdiutil create </span><span class="token parameter variable" style="color:#36acaa">-size</span><span class="token plain"> 20g </span><span class="token parameter variable" style="color:#36acaa">-type</span><span class="token plain"> SPARSE </span><span class="token parameter variable" style="color:#36acaa">-fs</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Case-sensitive HFS+"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-volname</span><span class="token plain"> brosx brosx.sparseimage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdiutil attach brosx.sparseimage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdiutil detach /Volumes/brosx </span><span class="token parameter variable" style="color:#36acaa">-force</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gpatch gcc flock attr libtool libart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> /opt/homebrew/bin/gcc-13 /opt/homebrew/bin/gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> /opt/homebrew/bin/gcc-13 /opt/homebrew/bin/cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> /opt/homebrew/bin/g++-13 /opt/homebrew/bin/g++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> /opt/homebrew/bin/g++-13 /opt/homebrew/bin/c++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> /opt/homebrew/bin/gcc /opt/homebrew/bin/cc /opt/homebrew/bin/g++ /opt/homebrew/bin/c++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="build-linux-kernel">Build Linux kernel<a href="https://liviaerxin.github.io/blog/qemu-linux-kernel-boot#build-linux-kernel" class="hash-link" aria-label="Direct link to Build Linux kernel" title="Direct link to Build Linux kernel">​</a></h2>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-6.1.55.tar.xz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xvf linux-6.1.55.tar.xz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> linux-6.1.55</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Use the default `x86_64` configuration file form `/x86/configs/x86_64_defconfig`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ARCH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">x86_64 x86_64_defconfig </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Tweak some options for GDB and initramfs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> menuconfig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-j8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Generate kernel file <code>./arch/x86/boot/bzImage</code>.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>To extract <code>vmlinux</code> from <code>bzImage</code>,</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./scripts/extract-vmlinux ./arch/x86_64/boot/bzImage </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">./arch/x86_64/boot/vmlinux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="build-root-filesystem">Build root filesystem<a href="https://liviaerxin.github.io/blog/qemu-linux-kernel-boot#build-root-filesystem" class="hash-link" aria-label="Direct link to Build root filesystem" title="Direct link to Build root filesystem">​</a></h2>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/buildroot/buildroot.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> buildroot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> menuconfig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Choose <code>x86_64</code> as Target Architecture and <code>ext4</code> root file system.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-j8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Generate root filesystem disk <code>./output/images/rootfs.ext4</code>.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="run-qemu">Run QEMU<a href="https://liviaerxin.github.io/blog/qemu-linux-kernel-boot#run-qemu" class="hash-link" aria-label="Direct link to Run QEMU" title="Direct link to Run QEMU">​</a></h2>
<p>Copy <code>bzImage</code> and <code>rootfs.ext4</code> to any host machine with QEMU available.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> ./linux-6.1.55/arch/x86/boot/bzImage destination_directory/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> ./buildroot/output/images/rootfs.ext4 destination_directory/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/linux_qemu/x86_64/bzImage"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">vmlinuz</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/linux_qemu/x86_64/vmlinux"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">initrd</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/linux_qemu/x86_64/rootfs.ext4"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">img</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/linux_qemu/x86_64/rootfs.ext4"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earlyprintk loglevel=8 root=/dev/zero console=ttyS0"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-hda</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earlyprintk loglevel=8 root=/dev/sda rootfstype=ext4 console=ttyS0"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-netdev</span><span class="token plain"> user,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet,hostfwd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp::2222-:22 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-net-pci,netdev</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Default password: <code>root</code></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debug-linux-kernel">Debug Linux kernel<a href="https://liviaerxin.github.io/blog/qemu-linux-kernel-boot#debug-linux-kernel" class="hash-link" aria-label="Direct link to Debug Linux kernel" title="Direct link to Debug Linux kernel">​</a></h2>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earlyprintk loglevel=8 root=/dev/zero console=ttyS0 nokaslr"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Options in details,</p>
<ul>
<li><code>-s</code>: allows port <code>tcp::1234</code> for remote debug</li>
<li><code>-S</code>: stop CPU until continue from GDB what is connected to tcp <code>1234</code> port</li>
<li><code>-append</code>
<ul>
<li><code>nokaslr</code>: turn off <strong>KASLR</strong></li>
</ul>
</li>
</ul>
<p>Or with root filesystem,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-hda</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earlyprintk loglevel=8 root=/dev/sda rootfstype=ext4 console=ttyS0 nokaslr"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-netdev</span><span class="token plain"> user,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet,hostfwd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp::2222-:22 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-net-pci,netdev</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Enter <code>gdb</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ gdb ./vmlinux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In <code>gdb</code> shell,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gdb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> target remote </span><span class="token number" style="color:#36acaa">10.6</span><span class="token plain">.64.243:1234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remote debugging using </span><span class="token number" style="color:#36acaa">10.6</span><span class="token plain">.64.243:1234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">warning: No executable has been specified and target does not support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">determining executable automatically.  Try using the </span><span class="token string" style="color:#e3116c">"file"</span><span class="token plain"> command.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000000fff0 </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> ?? </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gdb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin class-name">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Continuing.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="resources">Resources<a href="https://liviaerxin.github.io/blog/qemu-linux-kernel-boot#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<p><a href="https://www.berrange.com/posts/2023/03/09/make-tiny-image-py-creating-tiny-initrds-for-testing-qemu-or-linux-kernel-userspace-behaviour/" target="_blank" rel="noopener noreferrer">Daniel P. Berrangé  » Blog Archive   » make-tiny-image.py: creating tiny initrds for testing QEMU or Linux kernel/userspace behaviour</a></p>
<p><a href="https://github.com/dhruvvyas90/qemu-rpi-kernel" target="_blank" rel="noopener noreferrer">GitHub - dhruvvyas90/qemu-rpi-kernel: Qemu kernel for emulating Rpi on QEMU</a>
<a href="https://medicineyeh.wordpress.com/2016/03/29/buildup-your-arm-image-for-qemu/" target="_blank" rel="noopener noreferrer">https://medicineyeh.wordpress.com/2016/03/29/buildup-your-arm-image-for-qemu/</a></p>
<p><a href="https://medium.com/@daeseok.youn/prepare-the-environment-for-developing-linux-kernel-with-qemu-c55e37ba8ade" target="_blank" rel="noopener noreferrer">Prepare the environment for developing Linux kernel with qemu. | by DaeSeok Youn | Medium</a></p>
<p><a href="https://bootlin.com/pub/conferences/2013/kernel-recipes/rootfs-kernel-developer/rootfs-kernel-developer.pdf" target="_blank" rel="noopener noreferrer"></a></p>]]></content:encoded>
            <category>qemu</category>
            <category>kernel</category>
            <category>initramfs</category>
        </item>
        <item>
            <title><![CDATA[QEMU Emulate Raspberry Pi 3 and 4]]></title>
            <link>https://liviaerxin.github.io/blog/qemu-raspberry-pi</link>
            <guid>https://liviaerxin.github.io/blog/qemu-raspberry-pi</guid>
            <pubDate>Mon, 23 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[QEMU emulate Raspberry Pi 3/4]]></description>
            <content:encoded><![CDATA[<p>In this blog, <strong>QEMU</strong> is employed to emulate <strong>Raspberry Pi 3/4</strong> in <strong>mac M1</strong> host(it's also supposed to work in <strong>Windows/Linux</strong> with a little tweak). I will demonstrate <strong>two</strong> different ways to emulate <strong>Raspberry Pi 3</strong> and <strong>Raspberry Pi 4</strong> in respect. These two ways are different by using different <strong>QEMU machines</strong> as you would like to use:</p>
<ol>
<li><code>-machine raspi3b</code>: raspberry pi 3b machine to emulate <strong>Raspberry Pi 3</strong>.</li>
<li><code>-machine virt</code>: general arm machine to emulate <strong>Raspberry Pi 4</strong>.</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>In mac M1 with setting <code>-machine virt</code>, I use the hardware acceleration by <code>-accel hvf</code>. In Windows(x86_64), the hardware acceleration for <code>aarch64</code> is not available, so removing the hardware acceleration will work as well in Windows.</p></div></div>
<p>For both of these two, we still need prepare some common steps before running <strong>QEMU</strong>:</p>
<ul>
<li>Extract the appropriate kernel, device tree or root filesystem</li>
</ul>
<p>This blog will emulate Raspberry Pi using QEMU in mac M1 host using the new image <code>2024-05-03-raspios-bullseye-arm64-lite.img</code>.</p>
<p>The default <code>user:pi</code> and <code>password:raspberry</code> have been removed from this image. In order to log in, we have to write <code>user</code> and <code>password</code> to the image before booting. These steps can be skipped when booting previous images.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="prerequisites">Prerequisites<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<ul>
<li><strong>Docker</strong>
<ul>
<li>be required in macOS</li>
<li>can be skipped in Linux</li>
<li>can use <code>wsl</code> as an alternative in Windows</li>
</ul>
</li>
<li><strong>QEMU</strong>
<ul>
<li><code>homebrew</code> install in macOS</li>
</ul>
</li>
<li><strong>Raspberry Pi image</strong>: <code>2024-05-03-raspios-bullseye-arm64-lite.img</code></li>
</ul>
<p>Since I am in mac M1, and the <code>raspberry pi</code> image which contains a <code>fat</code> filesystem as boot and a <code>ext4</code> filesystem as OS, we need write some configuration into it. So I will use a <strong>Docker Ubuntu</strong> container to do the operation on the the filesystem. There some other tools to do the like of these operations:</p>
<ul>
<li><code>ext4fuse</code> is free and easy to install via <code>homebrew</code>, but it has limit as read-only access.</li>
<li><code>ExtFS</code> from <code>Paragon</code> supports read-write access while you need pay for it.</li>
<li><code>virtual machine</code>
<ul>
<li><code>Docker</code> in OSX make use of <code>virtual machine</code> while it is quick and flexible to use.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="raspberry-pi-image">Raspberry Pi image<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#raspberry-pi-image" class="hash-link" aria-label="Direct link to Raspberry Pi image" title="Direct link to Raspberry Pi image">​</a></h2>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://downloads.raspberrypi.org/raspios_arm64/images/raspios_arm64-2024-05-03/2024-05-03-raspios-bullseye-arm64-lite.img.xz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xz </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-05-03-raspios-bullseye-arm64-lite.img.xz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="docker-ubuntu-container">Docker Ubuntu container<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#docker-ubuntu-container" class="hash-link" aria-label="Direct link to Docker Ubuntu container" title="Direct link to Docker Ubuntu container">​</a></h2>
<p>Mount the <strong>folder</strong> including <code>2024-05-03-raspios-bullseye-arm64-lite.img</code></p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--privileged</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">:/qemu </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> ubuntu ubuntu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docekr </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> ubuntu </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="extracting-kernel-and-device-tree">Extracting Kernel and device tree<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#extracting-kernel-and-device-tree" class="hash-link" aria-label="Direct link to Extracting Kernel and device tree" title="Direct link to Extracting Kernel and device tree">​</a></h2>
<p>Operations all in Ubuntu container.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># fdisk -l 2024-05-03-raspios-bullseye-arm64-lite.img </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-05-03-raspios-bullseye-arm64-lite.img: </span><span class="token number" style="color:#36acaa">1.96</span><span class="token plain"> GiB, </span><span class="token number" style="color:#36acaa">2101346304</span><span class="token plain"> bytes, </span><span class="token number" style="color:#36acaa">4104192</span><span class="token plain"> sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Units: sectors of </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> * </span><span class="token number" style="color:#36acaa">512</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sector size </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logical/physical</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">512</span><span class="token plain"> bytes / </span><span class="token number" style="color:#36acaa">512</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I/O size </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">minimum/optimal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: </span><span class="token number" style="color:#36acaa">512</span><span class="token plain"> bytes / </span><span class="token number" style="color:#36acaa">512</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disklabel type: dos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk identifier: 0x544c6228</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device                                      Boot  Start     End Sectors  Size Id Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-05-03-raspios-bullseye-arm64-lite.img1        </span><span class="token number" style="color:#36acaa">8192</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">532479</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">524288</span><span class="token plain">  256M  c W95 FAT32 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LBA</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-05-03-raspios-bullseye-arm64-lite.img2      </span><span class="token number" style="color:#36acaa">532480</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4104191</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3571712</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.7G </span><span class="token number" style="color:#36acaa">83</span><span class="token plain"> Linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>The first partition is boot filesystem.</li>
<li>The second partition is real root filesystem.</li>
</ul>
<p>All the data we need is in the first partition, to do the operation is mounting it.</p>
<p>The offset of the first partition: 8192 * 512 = 4194304,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># mount -o loop,offset=4194304 2024-05-03-raspios-bullseye-arm64-lite.img /mnt/rpi-boot/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># ls -ls /mnt/rpi-boot/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total </span><span class="token number" style="color:#36acaa">30244</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">18693</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 COPYING.linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root    </span><span class="token number" style="color:#36acaa">1594</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 LICENCE.broadcom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">30390</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2710-rpi-2-b.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">32753</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2710-rpi-3-b-plus.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">32142</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2710-rpi-3-b.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">30285</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2710-rpi-cm3.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">31318</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2710-rpi-zero-2-w.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">31318</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2710-rpi-zero-2.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">52</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">52593</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2711-rpi-4-b.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">52</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">52682</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2711-rpi-400.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">38</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">38182</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2711-rpi-cm4-io.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">52</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">53202</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2711-rpi-cm4.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">50504</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bcm2711-rpi-cm4s.dtb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">52</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root   </span><span class="token number" style="color:#36acaa">52476</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 bootcode.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root     </span><span class="token number" style="color:#36acaa">154</span><span class="token plain"> May  </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> 03:11 cmdline.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root    </span><span class="token number" style="color:#36acaa">2109</span><span class="token plain"> May  </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> 02:53 config.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root     </span><span class="token number" style="color:#36acaa">145</span><span class="token plain"> May  </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> 03:11 issue.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8028</span><span class="token plain"> -rwxr-xr-x </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">8219600</span><span class="token plain"> Apr  </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:32 kernel8.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To run QEMU we will need the <strong>kernel</strong> and <strong>device tree</strong>, so let’s copy them out:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># cp /mnt/rpi-boot/kernel8.img .</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># cp /mnt/rpi-boot/bcm2710-rpi-3-b.dtb .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="setting-up-default-user">Setting up default user<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#setting-up-default-user" class="hash-link" aria-label="Direct link to Setting up default user" title="Direct link to Setting up default user">​</a></h2>
<p>Operations all in docker container.</p>
<p>Now in order to set up user and enable ssh in default, we need write files into <code>/userconf</code> and <code>/ssh</code> under the boot filesystem mounted as <code>/mnt/rpi-boot/</code>.</p>
<p>Set up a default <code>user:pi</code> and <code>password:raspberry</code>.</p>
<p>Hash password <code>raspberry</code> using <code>openssl</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># openssl passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Verifying - Password: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$1</span><span class="token variable" style="color:#36acaa">$d</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.AvcL</span><span class="token variable" style="color:#36acaa">$wqfUqTIauUP1TVJ</span><span class="token plain">/uU1td0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># echo 'pi:$1$d...AvcL$wqfUqTIauUP1TVJ/uU1td0' | tee /mnt/rpi-boot/userconf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Enable <code>ssh</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># touch /mnt/rpi-boot/ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@f36a3251391d:/qemu</span><span class="token comment" style="color:#999988;font-style:italic"># umount /mnt/rpi-boot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="running-qemu">Running QEMU<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#running-qemu" class="hash-link" aria-label="Direct link to Running QEMU" title="Direct link to Running QEMU">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="emulate-raspberry-pi-3">Emulate Raspberry Pi 3<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#emulate-raspberry-pi-3" class="hash-link" aria-label="Direct link to Emulate Raspberry Pi 3" title="Direct link to Emulate Raspberry Pi 3">​</a></h3>
<p>Now switch back to the host macOS to run <code>QEMU</code>,</p>
<p>Resize the image to the next power of 2 size,</p>
<p>The original size,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">stat</span><span class="token plain"> -f%z </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-05-03-raspios-bullseye-arm64-lite.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2101346304</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To resize to <code>4GB</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-img resize ./2024-05-03-raspios-bullseye-arm64-lite.img 4G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-machine</span><span class="token plain"> raspi3b </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> cortex-a72 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 1G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-dtb</span><span class="token plain"> bcm2710-rpi-3-b.dtb </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> kernel8.img </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rw earlyprintk loglevel=8 console=ttyAMA0,115200 dwc_otg.lpm_enable=0 root=/dev/mmcblk0p2 rootdelay=1"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-netdev</span><span class="token plain"> user,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">net0,hostfwd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp::2222-:22 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> usb-net,netdev</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">net0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-sd</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-05-03-raspios-bullseye-arm64-lite.img</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Options in detail:</p>
<ul>
<li><code>-machine raspi3b</code>: use raspberry pi 3 machine.</li>
<li><code>-append</code>:<!-- -->
<ul>
<li><code>console=ttyAMA0</code>: output the <strong>VM</strong> std to <strong>QEMU</strong> console.</li>
<li><code>root=/dev/mmcblk0p2</code>: mount <strong>real root filesystem</strong> to <code>/dev/mmcblk0p2</code>(the second partition of <code>mmcblk0</code>) as we <code>-sd xx</code> will be mounted to <code>/dev/mmcblk0</code>.</li>
</ul>
</li>
<li><code>-netdev user,id=net0,hostfwd=tcp::2222-:22</code>: network mapping host port <code>2222</code> to the <strong>VM</strong> <code>22</code></li>
<li><code>-device usb-net,netdev=net0</code>: expose <code>netdev=net0</code> as <code>usb-net</code> in the raspberry pi 3 machine.</li>
<li><code>-sd 2024-05-03-raspios-bullseye-arm64-lite.img</code>: <code>sd</code> drive is available in the raspberry pi 3 machine.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="emulate-raspberry-pi-4-with-virt">Emulate Raspberry Pi 4 with <code>virt</code><a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#emulate-raspberry-pi-4-with-virt" class="hash-link" aria-label="Direct link to emulate-raspberry-pi-4-with-virt" title="Direct link to emulate-raspberry-pi-4-with-virt">​</a></h3>
<p>We will use generic virtual machine <code>virt</code> to act as <code>raspi4</code>, since there is no <code>raspi4</code> machine defined in QEMU official machines. However you can still use <code>raspi3</code> to act as <code>raspi4</code> as they are same!</p>
<p><strong>Hardware Acceleration</strong> can be enable in <code>virt</code> machine by using <code>-accel hvf</code> option in my <strong>mac M1</strong> host as it's <strong>arm-based</strong>.</p>
<p>So <code>virt</code> will bring high performance and increase efficiency!</p>
<p>After tuning options and searching from many resources, the operational setting for QEMU to emulate is,</p>
<ol>
<li>Use <code>ubuntu-22.04.3-preinstalled-server-arm64+raspi.img</code>, of which the default user is <code>ubuntu</code> and password is <code>ubuntu</code>.</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/ubuntu-22.04.3-preinstalled-server-arm64+raspi-boot/vmlinuz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">initrd</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/ubuntu-22.04.3-preinstalled-server-arm64+raspi-boot/initrd.img"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">img</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/ubuntu-22.04.3-preinstalled-server-arm64+raspi.img"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="for-scsi-hard-disk">For <code>SCSI hard disk</code><a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#for-scsi-hard-disk" class="hash-link" aria-label="Direct link to for-scsi-hard-disk" title="Direct link to for-scsi-hard-disk">​</a></h4>
<p>This storage device file will be named <code>/dev/sdX</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-machine</span><span class="token plain"> virt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-accel</span><span class="token plain"> hvf </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-initrd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$initrd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earlyprintk loglevel=8 root=/dev/sda2 rootfstype=ext4 rw console=ttyAMA0"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-drive</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain">,format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">raw,if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">none,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">drive0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-scsi-pci,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">scsi </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> scsi-hd,drive</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">drive0,bus</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">scsi.0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-netdev</span><span class="token plain"> user,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet,hostfwd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp::2222-:22 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-net-pci,netdev</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Options in detail:</p>
<ul>
<li><code>-accel hvf</code>: <strong>hardware acceleration</strong> in mac M1. Don't use in <strong>x86_64</strong> host.</li>
<li><code>-cpu host</code>: change to <code>-cpu cortex-a72</code> when no <strong>hardware acceleration</strong> available such as in <strong>x86_64</strong> host.</li>
<li><code>-append</code>
<ul>
<li><code>root=/dev/sda2</code>: the second partition of the <code>ubuntu-22.04.3-preinstalled-server-arm64+raspi.img</code> disk image hold the real root filesystem.</li>
</ul>
</li>
<li><code>-initrd $initrd</code>
<ul>
<li>the boot loader works using configuration like <code>vmlinuz initrd=initrd.img root=/dev/sda2</code>.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="for-virtual-disk-storage-device">For <code>virtual disk</code> storage device<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#for-virtual-disk-storage-device" class="hash-link" aria-label="Direct link to for-virtual-disk-storage-device" title="Direct link to for-virtual-disk-storage-device">​</a></h4>
<p>This storage device file will be named <code>/dev/vdX</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-machine</span><span class="token plain"> virt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-accel</span><span class="token plain"> hvf </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-initrd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$initrd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earlyprintk loglevel=8 root=/dev/vda2 rootfstype=ext4 rw console=ttyAMA0"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-drive</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain">,format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">raw,if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">none,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">drive0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-blk-pci,drive</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">drive0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-netdev</span><span class="token plain"> user,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet,hostfwd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp::2222-:22 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-net-pci,netdev</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="for-nvme-storage-device">For <code>NVMe</code> storage device<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#for-nvme-storage-device" class="hash-link" aria-label="Direct link to for-nvme-storage-device" title="Direct link to for-nvme-storage-device">​</a></h4>
<p>This storage device file will be named <code>/dev/nvmeX</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-machine</span><span class="token plain"> virt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-accel</span><span class="token plain"> hvf </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earlyprintk loglevel=8 root=/dev/nvme0n1p2 rootfstype=ext4 rw console=ttyAMA0"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-drive</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain">,format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">raw,if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">none,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">drive0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> nvme,drive</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">drive0,serial</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">deadbeaf1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-netdev</span><span class="token plain"> user,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet,hostfwd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp::2222-:22 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-net-pci,netdev</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Options in detail:</p>
<ul>
<li>no <code>-initrd $initrd</code>
<ul>
<li>the boot loader works using configuration like <code>vmlinuz root=/dev/nvme0n1p2</code>.</li>
<li>we directly mount the real filesystem <code>/dev/nvme0n1p2</code>, skipping to mount the <strong>initial RAM disk</strong>.</li>
<li>I test other type storage device must binding <code>-initrd $initrd</code> while there is no need for <code>NVME</code>. In my assumption, those <code>storage devices</code> need to be configured in the <code>initramfs</code>.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="for-usb-storage">For <code>usb storage</code><a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#for-usb-storage" class="hash-link" aria-label="Direct link to for-usb-storage" title="Direct link to for-usb-storage">​</a></h4>
<p>This storage device file will be named <code>/dev/sdX</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-machine</span><span class="token plain"> virt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> cortex-a57 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -no-reboot </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-initrd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$initrd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earlyprintk loglevel=8 root=/dev/sda2 rootfstype=ext4 console=ttyAMA0 raid=noautodetect"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> usb-ehci </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> usb-storage,drive</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">disk0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-drive</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain">,format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">raw,if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">none,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">disk0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-net-pci,netdev</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-netdev</span><span class="token plain"> user,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet,hostfwd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp::2222-:22</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Options in detail:</p>
<ul>
<li><code>-device usb-ehci</code>: usb bus -&gt; PCI bus</li>
<li><code>-device usb-storage</code>: usb storage device -&gt; usb bus</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="test-raspberry-pi-vm">Test Raspberry Pi VM<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#test-raspberry-pi-vm" class="hash-link" aria-label="Direct link to Test Raspberry Pi VM" title="Direct link to Test Raspberry Pi VM">​</a></h2>
<p>Log into the <strong>Raspberry Pi</strong> via <code>ssh</code> from the macOS host,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2222</span><span class="token plain"> pi@localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The authenticity of </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'[localhost]:2222 ([127.0.0.1]:2222)'</span><span class="token plain"> can</span><span class="token string" style="color:#e3116c">'t be established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ED25519 key fingerprint is SHA256:6igL6iaigBCszv8m6nyNl+tsB2siV/tL+TRQANC6nBw.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">This key is not known by any other names</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Warning: Permanently added '</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:2222</span><span class="token string" style="color:#e3116c">' (ED25519) to the list of known hosts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">pi@localhost'</span><span class="token plain">s password: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Linux raspberrypi </span><span class="token number" style="color:#36acaa">6.1</span><span class="token plain">.21-v8+ </span><span class="token comment" style="color:#999988;font-style:italic">#1642 SMP PREEMPT Mon Apr  3 17:24:16 BST 2023 aarch64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The programs included with the Debian GNU/Linux system are </span><span class="token function" style="color:#d73a49">free</span><span class="token plain"> software</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the exact distribution terms </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> each program are described </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">individual files </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> /usr/share/doc/*/copyright.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">permitted by applicable law.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Fri Sep </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:30:58 </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSH is enabled and the default password </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the </span><span class="token string" style="color:#e3116c">'pi'</span><span class="token plain"> user has not been changed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is a security risk - please login as the </span><span class="token string" style="color:#e3116c">'pi'</span><span class="token plain"> user and </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'passwd'</span><span class="token plain"> to </span><span class="token builtin class-name">set</span><span class="token plain"> a new password.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi@raspberrypi:~ $ </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="resources">Resources<a href="https://liviaerxin.github.io/blog/qemu-raspberry-pi#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<p><a href="https://interrupt.memfault.com/blog/emulating-raspberry-pi-in-qemu" target="_blank" rel="noopener noreferrer">Emulating a Raspberry Pi in QEMU | InterruptEmulating a Raspberry Pi in QEMU</a></p>
<p><a href="https://blogs.oracle.com/linux/post/how-to-emulate-block-devices-with-qemu" target="_blank" rel="noopener noreferrer">How to emulate block devices with QEMU</a></p>
<p><a href="https://u-boot.readthedocs.io/en/latest/board/emulation/blkdev.html" target="_blank" rel="noopener noreferrer">Emulation of block devices — Das U-Boot unknown version documentation</a></p>]]></content:encoded>
            <category>qemu</category>
            <category>raspberry-pi</category>
            <category>osx</category>
        </item>
        <item>
            <title><![CDATA[Exploring cross compilation: ARM on x86_64]]></title>
            <link>https://liviaerxin.github.io/blog/how-to-cross-compilation</link>
            <guid>https://liviaerxin.github.io/blog/how-to-cross-compilation</guid>
            <pubDate>Wed, 18 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[How to perform cross compilation]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cross-compilation-anatomy">Cross Compilation Anatomy<a href="https://liviaerxin.github.io/blog/how-to-cross-compilation#cross-compilation-anatomy" class="hash-link" aria-label="Direct link to Cross Compilation Anatomy" title="Direct link to Cross Compilation Anatomy">​</a></h2>
<p>Cross-Compilation ecosystem involves the following components:</p>
<ul>
<li>host system<!-- -->
<ul>
<li>cross-Compilation toolchain<!-- -->
<ul>
<li>cross compiler</li>
<li>cross linker</li>
<li>cross debugger</li>
<li>sysroot<!-- -->
<ul>
<li>target system library files</li>
<li>target system header files</li>
<li>target system other files</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>target system</li>
</ul>
<p>Cross-Compilation toolchain:</p>
<ul>
<li>GCC</li>
<li>Buildroot</li>
<li>Yocto Project</li>
<li>Crosstool-NG</li>
<li>Linaro</li>
<li>Clang/LLVM</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gcc">GCC<a href="https://liviaerxin.github.io/blog/how-to-cross-compilation#gcc" class="hash-link" aria-label="Direct link to GCC" title="Direct link to GCC">​</a></h2>
<p>Let's explore what a toolchain is like and what are needed to build something for a <code>aarch64</code> platform on <code>x86_64</code> debian-like host.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="obtaining-a-cross-compilation-toolchain-for-aarch64">Obtaining a cross-compilation toolchain for <code>aarch64</code><a href="https://liviaerxin.github.io/blog/how-to-cross-compilation#obtaining-a-cross-compilation-toolchain-for-aarch64" class="hash-link" aria-label="Direct link to obtaining-a-cross-compilation-toolchain-for-aarch64" title="Direct link to obtaining-a-cross-compilation-toolchain-for-aarch64">​</a></h3>
<p>For simplicity and in a super fast way, we will use a prebuilt and ready-on toolchain in <code>x86_64</code> Ubuntu.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gcc </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> gcc-aarch64-linux-gnu binutils-aarch64-linux-gnu</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="where-is-cross-compiler">Where is <code>cross compiler</code><a href="https://liviaerxin.github.io/blog/how-to-cross-compilation#where-is-cross-compiler" class="hash-link" aria-label="Direct link to where-is-cross-compiler" title="Direct link to where-is-cross-compiler">​</a></h3>
<p>We see <code>cross compiler</code> binary type in host is <code>x86-64</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> /usr/bin/aarch64-linux-gnu-gcc-11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/aarch64-linux-gnu-gcc-11: ELF </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-bit LSB executable, x86-64, version </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GNU/Linux</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sha1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">b1112487d0dcb759db32e15b8f40f28a05484272, </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> GNU/Linux </span><span class="token number" style="color:#36acaa">3.2</span><span class="token plain">.0, stripped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="where-is-sysroot">Where is <code>sysroot</code><a href="https://liviaerxin.github.io/blog/how-to-cross-compilation#where-is-sysroot" class="hash-link" aria-label="Direct link to where-is-sysroot" title="Direct link to where-is-sysroot">​</a></h3>
<p>The <code>sysroot</code> locates in <code>/usr/aarch64-linux-gnu</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree </span><span class="token parameter variable" style="color:#36acaa">--filelimit</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> /usr/aarch64-linux-gnu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/aarch64-linux-gnu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── ar -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-ar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── as -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-as</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── ld -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-ld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── ld.bfd -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-ld.bfd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── ld.gold -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-ld.gold</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── nm -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-nm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── objcopy -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-objcopy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── objdump -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-objdump</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── ranlib -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-ranlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; ├── readelf -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-readelf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│&nbsp;&nbsp; └── strip -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/bin/aarch64-linux-gnu-strip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── include  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">139</span><span class="token plain"> entries exceeds filelimit, not opening dir</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── Mcrt1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── Scrt1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── crt1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── crti.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── crtn.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── gcrt1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── grcrt1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── ld-linux-aarch64.so.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you see, the <code>binutils-aarch64-linux-gnu</code> will install <code>binutils</code> tools in <code>/usr/aarch64-linux-gnu/bin</code>,</p>
<p>These <code>binutils</code> are also <code>x86_64</code> binaries,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">readlink </span><span class="token variable parameter variable" style="color:#36acaa">-f</span><span class="token variable" style="color:#36acaa"> /usr/aarch64-linux-gnu/bin/ar</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/aarch64-linux-gnu-ar: ELF </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-bit LSB pie executable, x86-64, version </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SYSV</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sha1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">4f75b6dc6fe5ae92c78a51e6479ca2c65bbf5335, </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> GNU/Linux </span><span class="token number" style="color:#36acaa">3.2</span><span class="token plain">.0, stripped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While target libraries are <code>aarch64</code> type,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">file</span><span class="token plain"> /usr/aarch64-linux-gnu/lib/crt1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/aarch64-linux-gnu/lib/crt1.o: ELF </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-bit LSB relocatable, ARM aarch64, version </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SYSV</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> GNU/Linux </span><span class="token number" style="color:#36acaa">3.7</span><span class="token plain">.0, not stripped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="compile-helloc">Compile <code>hello.c</code><a href="https://liviaerxin.github.io/blog/how-to-cross-compilation#compile-helloc" class="hash-link" aria-label="Direct link to compile-helloc" title="Direct link to compile-helloc">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ aarch64-linux-gnu-gcc-11 hello.c </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> a.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> a.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.out: ELF </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-bit LSB pie executable, ARM aarch64, version </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SYSV</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, BuildID</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sha1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">367c436db0697f16039d9249e4a4e809ef9e68b3, </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> GNU/Linux </span><span class="token number" style="color:#36acaa">3.7</span><span class="token plain">.0, not stripped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="clangllvm">Clang/LLVM<a href="https://liviaerxin.github.io/blog/how-to-cross-compilation#clangllvm" class="hash-link" aria-label="Direct link to Clang/LLVM" title="Direct link to Clang/LLVM">​</a></h2>
<p><a href="https://static.linaro.org/connect/bkk19/presentations/bkk19-210.pdf" target="_blank" rel="noopener noreferrer">Cross compilation with Clang and LLVM tools</a></p>
<p><a href="https://mcilloni.ovh/2021/02/09/cxx-cross-clang/" target="_blank" rel="noopener noreferrer">Cross compiling made easy, using Clang and LLVM · mcilloni's blog</a></p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> lld clang llvm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://releases.linaro.org/components/toolchain/binaries/7.5-2019.12/aarch64-linux-gnu/sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu.tar.xz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-xvf</span><span class="token plain"> sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu.tar.xz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> sysroot-glibc-linaro-2.25-2019.12-aarch64-linux-gnu aarch64-linux-gnu</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ll aarch64-linux-gnu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 20K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11827</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9000</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">.0K Dec  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11827</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9000</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">.0K Dec  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11827</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9000</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">.0K Dec  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> sbin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11827</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9000</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">.0K Dec  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> usr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11827</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9000</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">.0K Dec  </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> var</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> hello.c </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOL</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">int main(int argc, char *argv[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  printf("Hello cross-compilation world!</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">");</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">sysroot</span><span class="token operator" style="color:#393A34">=~</span><span class="token plain">/Documents/sysroot/aarch64-linux-gnu/usr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clang </span><span class="token parameter variable" style="color:#36acaa">--target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">aarch64-linux-gnu hello.c </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> hello_aarch64 </span><span class="token parameter variable" style="color:#36acaa">-v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clang </span><span class="token parameter variable" style="color:#36acaa">--target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">aarch64-linux-gnu hello.c </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> hello_aarch64 </span><span class="token parameter variable" style="color:#36acaa">--sysroot</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$sysroot</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clang </span><span class="token parameter variable" style="color:#36acaa">--target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">aarch64-linux-gnu  </span><span class="token parameter variable" style="color:#36acaa">-fsanitize</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">undefined </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -fuse-ld</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">lld </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--rtlib</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">compiler-rt </span><span class="token parameter variable" style="color:#36acaa">-stdlib</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">libc++ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -nostdinc++ </span><span class="token parameter variable" style="color:#36acaa">-nostdlib</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -I</span><span class="token variable" style="color:#36acaa">${sysroot}</span><span class="token plain">/usr/include/ </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -Wl,-L</span><span class="token variable" style="color:#36acaa">${sysroot}</span><span class="token plain">/usr/lib </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--sysroot</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$sysroot</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--verbose</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hello.c </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> hello</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="resources">Resources<a href="https://liviaerxin.github.io/blog/how-to-cross-compilation#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<p><a href="https://wiki.osdev.org/GCC_Cross-Compiler" target="_blank" rel="noopener noreferrer">GCC Cross-Compiler - OSDev Wiki</a></p>
<p><a href="https://github.com/generia/buildroot-osx" target="_blank" rel="noopener noreferrer">GitHub - generia/buildroot-osx: Buidroot OSX - Use Buildroot on OSX natively without a Linux container.</a></p>
<p><a href="https://crosstool-ng.github.io/docs/" target="_blank" rel="noopener noreferrer">crosstool-ng Documentation</a></p>
<p><a href="https://github.com/messense/homebrew-macos-cross-toolchains/blob/main/.github/workflows/aarch64.yml" target="_blank" rel="noopener noreferrer">aarch64 workflows example</a></p>]]></content:encoded>
            <category>how-to</category>
            <category>toolchain</category>
        </item>
        <item>
            <title><![CDATA[Installing FFmpeg on Nvidia CUDA container]]></title>
            <link>https://liviaerxin.github.io/blog/ffmpeg-on-cuda-container</link>
            <guid>https://liviaerxin.github.io/blog/ffmpeg-on-cuda-container</guid>
            <pubDate>Fri, 06 Sep 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[FFmpeg on CUDA Container]]></description>
            <content:encoded><![CDATA[<p>This documentation describes to install <code>FFmpeg</code> on <code>nvidia/cuda</code> <strong>container</strong> to use the <strong>Nvidia GPU</strong> to accelerate encoding.</p>
<p>If you want to know <a href="https://www.cyberciti.biz/faq/how-to-install-ffmpeg-with-nvidia-gpu-acceleration-on-linux/" target="_blank" rel="noopener noreferrer">how to install FFmpeg with NVIDIA GPU on Linux</a>, go to see that.</p>
<p><strong>FFmpeg</strong> can support hardware-based decoding and encoding for Nvidia GPU card. With the help of Nvidia GPU, <code>h264_nvenc</code> can lead encoding speed with <strong>5x</strong> faster than <code>libx264</code> in <strong>GTX1080</strong> card.</p>
<p>Let's see how to install everything one by one on the <strong>Nvidia CUDA Docker</strong> container <code>nvidia/cuda:12.2.0-devel-ubuntu20.04</code>, in which CUDA toolkit and GPU driver are already included.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><blockquote>
<p>It must use <code>nvidia/cuda:xxx-devel-xxx</code> image to build <code>FFmpeg</code>, because the <code>dev</code> image contain all the necessary libraries.</p>
</blockquote></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="prerequisites">Prerequisites<a href="https://liviaerxin.github.io/blog/ffmpeg-on-cuda-container#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<p>Make sure <strong>Nvidia GPU Driver</strong> is installed in your host machine! As it will be mounted into the <strong>container</strong>.</p>
<p>Use <code>ldconfig</code> to check if the required Nvidia GPU driver libraries are available inside the container. Such as,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> libcuda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><blockquote>
<p>When running in the <code>nvidia/cuda</code> Docker container, what Nvidia libraries(from the host machine) should be mounted inside the container are specified by the <code>NVIDIA_DRIVER_CAPABILITIES</code> env variable, see <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/docker-specialized.html#driver-capabilities" target="_blank" rel="noopener noreferrer">driver-capabilities</a>. Here for <code>FFmpeg</code> to employ GPU, it should be included at least as <code>NVIDIA_DRIVER_CAPABILITIES=video,utility</code>.</p>
</blockquote></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-by-step">Step by Step<a href="https://liviaerxin.github.io/blog/ffmpeg-on-cuda-container#step-by-step" class="hash-link" aria-label="Direct link to Step by Step" title="Direct link to Step by Step">​</a></h2>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--runtime</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nvidia </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NVIDIA_VISIBLE_DEVICES</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">all </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NVIDIA_DRIVER_CAPABILITIES</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">compute,utility </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nvidia/cuda nvidia-smi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--runtime</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nvidia </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NVIDIA_VISIBLE_DEVICES</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">all </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NVIDIA_DRIVER_CAPABILITIES</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">compute,utility </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nvidia/cuda </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="complete-dockerfile">Complete Dockerfile<a href="https://liviaerxin.github.io/blog/ffmpeg-on-cuda-container#complete-dockerfile" class="hash-link" aria-label="Direct link to Complete Dockerfile" title="Direct link to Complete Dockerfile">​</a></h2>
<div class="docusaurus-theme-github-codeblock"><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">nvidia-cuda-ffmpeg/Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loading</span><span class="token spread operator" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="font-size:.9em;font-weight:600;color:#0E75DD;text-align:right;padding-bottom:13px;text-decoration:underline"><a href="https://github.com/liviaerxin/hello-dockerfile/blob/main/nvidia-cuda-ffmpeg/Dockerfile" class="githubLink" style="margin:0 10px" target="_blank">View on GitHub</a></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="known-issues">Known issues<a href="https://liviaerxin.github.io/blog/ffmpeg-on-cuda-container#known-issues" class="hash-link" aria-label="Direct link to Known issues" title="Direct link to Known issues">​</a></h2>
<p>Nvidia Docker encoding stops after long running time with such error message: <code>CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected</code>.</p>
<p><a href="https://github.com/jellyfin/jellyfin/issues/9287" target="_blank" rel="noopener noreferrer">[Issue]: NVidia Docker transcoding randomly stops working after 5 minutes to 4 hours later. · Issue #9287 · jellyfin/jellyfin · GitHub</a></p>
<p>Possible solution:</p>
<p>Edit <code>/etc/defautls/grub</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"quiet splash systemd.unified_cgroup_hierarchy=0"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then run <code>update-grub</code> and reboot.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a href="https://liviaerxin.github.io/blog/ffmpeg-on-cuda-container#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p><a href="https://docs.nvidia.com/video-technologies/video-codec-sdk/12.0/ffmpeg-with-nvidia-gpu/index.html" target="_blank" rel="noopener noreferrer">Using FFmpeg with NVIDIA GPU Hardware Acceleration - NVIDIA Docs</a></p>
<p><a href="https://developer.nvidia.com/blog/nvidia-ffmpeg-transcoding-guide/" target="_blank" rel="noopener noreferrer">NVIDIA FFmpeg Transcoding Guide | NVIDIA Technical Blog</a></p>
<p><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/user-guide.html" target="_blank" rel="noopener noreferrer">User Guide — container-toolkit 1.13.5 documentation</a></p>
<p><a href="https://liviaerxin.github.io/wiki/wiki-cuda.mdx">wiki cuda</a></p>]]></content:encoded>
            <category>ffmpeg</category>
            <category>docker</category>
            <category>cuda</category>
        </item>
        <item>
            <title><![CDATA[Making your own Dotfiles for your sake]]></title>
            <link>https://liviaerxin.github.io/blog/how-to-dotfiles</link>
            <guid>https://liviaerxin.github.io/blog/how-to-dotfiles</guid>
            <pubDate>Wed, 26 Jun 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[How to Create Dotfiles for Your Setup]]></description>
            <content:encoded><![CDATA[<p><a href="http://dotfiles.github.io/tutorials/" target="_blank" rel="noopener noreferrer">Tutorials - dotfiles.github.io</a></p>
<p><a href="https://www.webpro.nl/articles/getting-started-with-dotfiles" target="_blank" rel="noopener noreferrer">Getting started with dotfilesFrontend Ramblings RSS feedThe content of this website on GitHubMy Mastodon profileMy Twitter profileShare this article on TwitterShare this article on Hacker News</a></p>]]></content:encoded>
            <category>dotfiles</category>
            <category>how-to</category>
        </item>
        <item>
            <title><![CDATA[Playing with unicode in deep]]></title>
            <link>https://liviaerxin.github.io/blog/how-to-unicode</link>
            <guid>https://liviaerxin.github.io/blog/how-to-unicode</guid>
            <pubDate>Fri, 08 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Playing with Unicode in deep]]></description>
            <content:encoded><![CDATA[<p>The smallest unit of all texts we see on the screen is one character. But you may wonder about:</p>
<ol>
<li>How one character is displayed on the screen?</li>
<li>How one character is kept in memory or disk in binary format(0 or 1)?</li>
</ol>
<p>Let's dive into the <strong>Unicode</strong> to solve these questions.</p>
<p>In Unicode, a character maps to something called code point which is a magic number written as hex like: <code>U+20AC</code> and is still just a abstract layer.</p>
<table><thead><tr><th>Layer</th><th>Representation</th></tr></thead><tbody><tr><td>screen</td><td>glyph</td></tr><tr><td>abstraction</td><td>unicode character</td></tr><tr><td>abstraction</td><td>unicode code point</td></tr><tr><td>disk</td><td>variable-length bytes(1 to 4 bytes)</td></tr></tbody></table>
<p>How that code point is represented in memory or on disk?</p>
<p><code>UTF-8</code>, <code>UTF-16</code>, and <code>UTF-32</code> help translate unicode code point into binary data in 8-bit bytes which can be saved in disk or be transported in network.</p>
<p><code>UTF-8</code> is character-to-bytes(1 to 4 bytes) encoding standard across almost all system and application.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="faq">FAQ<a href="https://liviaerxin.github.io/blog/how-to-unicode#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-a-character-is-displayed-on-the-screen">How a character is displayed on the screen?<a href="https://liviaerxin.github.io/blog/how-to-unicode#how-a-character-is-displayed-on-the-screen" class="hash-link" aria-label="Direct link to How a character is displayed on the screen?" title="Direct link to How a character is displayed on the screen?">​</a></h3>
<p>software maps each character to its glyph(a grid of pixels), draw these pixels onto the screen.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-to-find-out-whether-the-file-uses-utf-8-or-ascii-or-other-encoding-schemas">How to find out whether the file uses UTF-8 or ASCII or other encoding schemas?<a href="https://liviaerxin.github.io/blog/how-to-unicode#how-to-find-out-whether-the-file-uses-utf-8-or-ascii-or-other-encoding-schemas" class="hash-link" aria-label="Direct link to How to find out whether the file uses UTF-8 or ASCII or other encoding schemas?" title="Direct link to How to find out whether the file uses UTF-8 or ASCII or other encoding schemas?">​</a></h3>
<p>It's not always foolproof because there is no universal mandate or requirement that all files must specify their encoding. But it's a good practice to add BOM(Byte Order Mark) at the beginning of a UTF-8 encoded file.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="can-i-set-utf-16-as-locale-in-linux">Can I set UTF-16 as locale in Linux?<a href="https://liviaerxin.github.io/blog/how-to-unicode#can-i-set-utf-16-as-locale-in-linux" class="hash-link" aria-label="Direct link to Can I set UTF-16 as locale in Linux?" title="Direct link to Can I set UTF-16 as locale in Linux?">​</a></h3>
<p>No, you cannot. Linux use <code>UTF-8</code> encoding which is compatible with <code>ASCII</code>.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-happens-when-printing-a-utf-16-file-in-linux">What happens when printing a UTF-16 file in Linux?<a href="https://liviaerxin.github.io/blog/how-to-unicode#what-happens-when-printing-a-utf-16-file-in-linux" class="hash-link" aria-label="Direct link to What happens when printing a UTF-16 file in Linux?" title="Direct link to What happens when printing a UTF-16 file in Linux?">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># &gt;&gt;&gt; '€'.encode("utf16") -&gt; b'\xff\xfe\xac '</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">xff</span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">xfe</span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">xac</span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">x20 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ hexdump </span><span class="token parameter variable" style="color:#36acaa">-C</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000  ff fe ac </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">                                       </span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000004</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.txt: Unicode text, UTF-16, little-endian text, with no line terminators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">iconv</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> UTF-16LE </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> UTF-8 a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">€</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-can-i-check-a-utf-8-file-has-a-bom">How can I check a UTF-8 file has a <code>BOM</code>?<a href="https://liviaerxin.github.io/blog/how-to-unicode#how-can-i-check-a-utf-8-file-has-a-bom" class="hash-link" aria-label="Direct link to how-can-i-check-a-utf-8-file-has-a-bom" title="Direct link to how-can-i-check-a-utf-8-file-has-a-bom">​</a></h3>
<p>Create a file without <code>BOM</code>,</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b'\xe2\x82\xac'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'€'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'€'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">b'\xe2\x82\xac'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> bom</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">b"\xef\xbb\xbf"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a.txt"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"wb+"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b'\xe2\x82\xac'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.txt: Unicode text, UTF-8 text, with no line terminators</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create a <code>BOM</code> adhere file,</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">truncate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b'\xef\xbb\xbf\xe2\x82\xac'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.txt: Unicode text, UTF-8 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">with BOM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> text, with no line terminators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ hexdump </span><span class="token parameter variable" style="color:#36acaa">-C</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000  ef bb bf e2 </span><span class="token number" style="color:#36acaa">82</span><span class="token plain"> ac                                 </span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000006</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="why-we-can-copy-and-paste-the-unicode-characters-into-a-shell">Why we can copy and paste the unicode characters into a shell?<a href="https://liviaerxin.github.io/blog/how-to-unicode#why-we-can-copy-and-paste-the-unicode-characters-into-a-shell" class="hash-link" aria-label="Direct link to Why we can copy and paste the unicode characters into a shell?" title="Direct link to Why we can copy and paste the unicode characters into a shell?">​</a></h3>
<p>When we do copying on the screen, we're copying the character's UTF8 encoded <strong>bytes</strong> which is in the memory, not the <strong>code point</strong>.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># b'\xe2\x82\xac'.decode() -&gt; '€'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">xe2</span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">x82</span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">xac </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> xclip </span><span class="token parameter variable" style="color:#36acaa">-selection</span><span class="token plain"> clipboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then you can use your mouse right click to copy to the shell and you will see <code>€</code>.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-a-string-is-stored-in-memory-when-python-running">How a string is stored in memory when Python running?<a href="https://liviaerxin.github.io/blog/how-to-unicode#how-a-string-is-stored-in-memory-when-python-running" class="hash-link" aria-label="Direct link to How a string is stored in memory when Python running?" title="Direct link to How a string is stored in memory when Python running?">​</a></h3>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="unicode-in-json">Unicode in JSON<a href="https://liviaerxin.github.io/blog/how-to-unicode#unicode-in-json" class="hash-link" aria-label="Direct link to Unicode in JSON" title="Direct link to Unicode in JSON">​</a></h2>
<p>JSON(natively a text format) support the unicode character to be escaped or not. When <strong>being escaped</strong>, the character will be replaced with the unicode code point, then which will be represented in 6 or 8 ascii characters occupying 6 or 8 bytes. When <strong>not being escaped</strong>, the character will be represented as just one unicode character as itself occupying 1 to 4 bytes if using UTF-8.</p>
<p>Escaping will cost more storage but will be compatible in ASCII-only environments, as escaping force all characters to be ASCII characters.</p>
<p>Case 1: Characters escaped,</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> b</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">b'{"text": "\u4f60\u597d"}'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'text'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'你好'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">jsn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'{"text": "\\u4f60\\u597d"}'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ensure_ascii</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'{"text": "你好"}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"a.txt"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"w+"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"text"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string entity" style="color:#36acaa">\u4f60</span><span class="token string entity" style="color:#36acaa">\u597d</span><span class="token string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$  hexdump </span><span class="token parameter variable" style="color:#36acaa">-C</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000  7b </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">74</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">78</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">74</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> 3a  </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> 5c </span><span class="token number" style="color:#36acaa">75</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">34</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">36</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"text"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string entity" style="color:#36acaa">\u4f60</span><span class="token string" style="color:#e3116c">|</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">00000010  5c 75 35 39 37 64 22 7d                           |</span><span class="token string entity" style="color:#36acaa">\u597d</span><span class="token string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000018</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Case 2: Characters not escaped,</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">truncate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ensure_ascii</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"text"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"你好"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ hexdump </span><span class="token parameter variable" style="color:#36acaa">-C</span><span class="token plain"> a.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000  7b </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">74</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">78</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">74</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> 3a  </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> e4 bd a0 e5 a5 bd  </span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"text"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"......|</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">00000010  22 7d                                             |"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000012</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="base64">Base64<a href="https://liviaerxin.github.io/blog/how-to-unicode#base64" class="hash-link" aria-label="Direct link to Base64" title="Direct link to Base64">​</a></h2>
<p>Base64 is binary-to-text encoding schema which make bytes data to be represented in ASCII characters to be human readable.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="python">Python<a href="https://liviaerxin.github.io/blog/how-to-unicode#python" class="hash-link" aria-label="Direct link to Python" title="Direct link to Python">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c-application">C application<a href="https://liviaerxin.github.io/blog/how-to-unicode#c-application" class="hash-link" aria-label="Direct link to C application" title="Direct link to C application">​</a></h2>
<p>Let's have a look at how the <strong>Unicode</strong> is represented in a <code>C</code> executable file.</p>
<ol>
<li><code>char</code></li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> unicode.c </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOL</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">int main(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    printf("Hello, World 你好🤨!</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">");</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc unicode.c </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> unicode.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@112b172acfff:/workspaces/liviaerxin.github.io/</span><span class="token comment" style="color:#999988;font-style:italic"># hexdump -C unicode.out | grep -A3 "Hello, World"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002000  01 00 02 00 </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65</span><span class="token plain"> 6c 6c  6f 2c </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">57</span><span class="token plain"> 6f </span><span class="token number" style="color:#36acaa">72</span><span class="token plain"> 6c </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">Hello, World</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002010  </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> e4 bd a0 e5 a5 bd f0  9f a4 a8 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain"> 00 00 00 00  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002020  01 1b 03 3b </span><span class="token number" style="color:#36acaa">34</span><span class="token plain"> 00 00 00  05 00 00 00 00 f0 ff ff  </span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">;</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002030  </span><span class="token number" style="color:#36acaa">68</span><span class="token plain"> 00 00 00 </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> f0 ff ff  </span><span class="token number" style="color:#36acaa">90</span><span class="token plain"> 00 00 00 </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> f0 ff ff  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.0</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>View each character's <strong>UTF8</strong> encoding respectively,</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># utf-8 encoding bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"你"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">b'\xe4\xbd\xa0'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"好"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">b'\xe5\xa5\xbd'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"🤨"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">b'\xf0\x9f\xa4\xa8'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So  <code>char</code> in the C output file stores the UTF8 encoding <strong>bytes</strong>, not the code points.</p>
<ol start="2">
<li><code>wide char</code>,</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> unicode.c </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOL</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#include &lt;wchar.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#include &lt;locale.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">int main(int argc, char *argv[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    setlocale(LC_ALL, "C.UTF-8");</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    wchar_t* msg = L"Hello, World 你好🤨!";</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    printf("%ls</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">", msg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@112b172acfff:/workspaces/liviaerxin.github.io/</span><span class="token comment" style="color:#999988;font-style:italic"># hexdump -C unicode.out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002000  01 00 02 00 00 00 00 00  </span><span class="token number" style="color:#36acaa">43</span><span class="token plain"> 2e </span><span class="token number" style="color:#36acaa">55</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">54</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">46</span><span class="token plain"> 2d </span><span class="token number" style="color:#36acaa">38</span><span class="token plain"> 00  </span><span class="token operator" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">C.UTF-8.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002010  </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> 00 00 00 </span><span class="token number" style="color:#36acaa">65</span><span class="token plain"> 00 00 00  6c 00 00 00 6c 00 00 00  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">H</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.e</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.l</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.l</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002020  6f 00 00 00 2c 00 00 00  </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> 00 00 00 </span><span class="token number" style="color:#36acaa">57</span><span class="token plain"> 00 00 00  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">o</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.,</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.W</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002030  6f 00 00 00 </span><span class="token number" style="color:#36acaa">72</span><span class="token plain"> 00 00 00  6c 00 00 00 </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> 00 00 00  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">o</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.r</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.l</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.d</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00002040  </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> 00 00 00 </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> 4f 00 00  7d </span><span class="token number" style="color:#36acaa">59</span><span class="token plain"> 00 00 </span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> f9 01 00  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.`O</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">Y</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># unicode code point</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">hex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">ord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"H"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'0x48'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">hex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">ord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"你"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'0x4f60'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">hex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">ord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"好"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'0x597d'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">hex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">ord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"🤨"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'0x1f928'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>wchar</code> in the C output file stores the <strong>code point</strong>(also in <strong>little endian</strong>), not the UTF8 encoding <strong>bytes</strong>.</p>
<p>In conclusion, <code>char</code> and <code>wchar</code> lead different encoding in <strong>C</strong>.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a href="https://liviaerxin.github.io/blog/how-to-unicode#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p><a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/" target="_blank" rel="noopener noreferrer">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!) – Joel on Software</a></p>
<p><a href="https://nedbatchelder.com/text/unipain.html" target="_blank" rel="noopener noreferrer">Pragmatic Unicode | Ned Batchelder</a></p>]]></content:encoded>
            <category>how-to</category>
            <category>unicode</category>
        </item>
        <item>
            <title><![CDATA[Discovering QEMU]]></title>
            <link>https://liviaerxin.github.io/blog/how-to-qemu</link>
            <guid>https://liviaerxin.github.io/blog/how-to-qemu</guid>
            <pubDate>Tue, 19 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Get started with qemu]]></description>
            <content:encoded><![CDATA[<p>Learning and using the <strong>QEMU</strong> help me understand how the linux operating system works including fields:</p>
<ol>
<li>Linux boot process.</li>
<li>Cross compile for target system(such as arm64) on host system(such as x86_64), and test the binary.</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="os-image-resources">OS image Resources<a href="https://liviaerxin.github.io/blog/how-to-qemu#os-image-resources" class="hash-link" aria-label="Direct link to OS image Resources" title="Direct link to OS image Resources">​</a></h2>
<ul>
<li><a href="https://cdimage.ubuntu.com/" target="_blank" rel="noopener noreferrer">Ubuntu OS Images</a></li>
<li><a href="https://cdimage.debian.org/" target="_blank" rel="noopener noreferrer">Debian OS Images</a></li>
<li><a href="https://downloads.raspberrypi.org/" target="_blank" rel="noopener noreferrer">Raspberry PI OS Images</a></li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="qemu-keyboard-shortcuts">QEMU Keyboard shortcuts<a href="https://liviaerxin.github.io/blog/how-to-qemu#qemu-keyboard-shortcuts" class="hash-link" aria-label="Direct link to QEMU Keyboard shortcuts" title="Direct link to QEMU Keyboard shortcuts">​</a></h3>
<ul>
<li>Switch between QEMU monitor console and the guest non-graphic OS<!-- -->
<ul>
<li><code>CTRL+a c</code></li>
</ul>
</li>
<li>Exit the guest non-graphic OS<!-- -->
<ul>
<li><code>CTRL+a x</code></li>
</ul>
</li>
<li>Switch between QEMU monitor console and the guest graphic OS<!-- -->
<ul>
<li><code>CTRL+ALT+1</code>, <code>CTRL+ALT+2</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="discover-the-vm-device-tree">Discover the VM device tree<a href="https://liviaerxin.github.io/blog/how-to-qemu#discover-the-vm-device-tree" class="hash-link" aria-label="Direct link to Discover the VM device tree" title="Direct link to Discover the VM device tree">​</a></h3>
<p>Enter the QEMU monitor console, using <code>info qtree</code> command,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ info qtree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> dev: gpex-pcihost, </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bus: pcie.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">type</span><span class="token plain"> PCIE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dev: virtio-scsi-pci, </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bus: virtio-bus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token builtin class-name">type</span><span class="token plain"> virtio-pci-bus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          dev: virtio-scsi-device, </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bus: scsi.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin class-name">type</span><span class="token plain"> SCSI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              dev: scsi-hd, </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                drive </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dev: nvme, </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        drive </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"drive0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bus: nvme-bus.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token builtin class-name">type</span><span class="token plain"> nvme-bus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dev: virtio-net-pci, </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bus: virtio-bus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token builtin class-name">type</span><span class="token plain"> virtio-pci-bus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          dev: virtio-net-device, </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="list-supported-devices">List supported devices<a href="https://liviaerxin.github.io/blog/how-to-qemu#list-supported-devices" class="hash-link" aria-label="Direct link to List supported devices" title="Direct link to List supported devices">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ qemu-system-aarch64 </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> </span><span class="token builtin class-name">help</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ qemu-system-aarch64 </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> scsi-hd,help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-disk-image">Create disk image<a href="https://liviaerxin.github.io/blog/how-to-qemu#create-disk-image" class="hash-link" aria-label="Direct link to Create disk image" title="Direct link to Create disk image">​</a></h2>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-img create </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> raw ubuntu.raw 20G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qemu-img create </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> qcow2 ubuntu.qcow2 20G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>QEMU can boot from 3 ways:</p>
<ul>
<li>BIOS in default</li>
<li>Linux kernel and initrad</li>
<li>UEFI</li>
</ul>
<p>For <strong>UEFI</strong> boot, the <code>-bios</code> option should be used alongside <code>UEFI</code> firmware(<code>OVMF.fd</code> file) being provided to help QEMU do <code>UEFI</code> boot. For instance it is like: <code>-bios OVMF.fd</code>.</p>
<p>Get a prebuilt <code>OVMF</code> file from the <a href="https://www.kraxel.org/repos/jenkins/edk2/" target="_blank" rel="noopener noreferrer">OVMF</a>.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bios-boot">BIOS boot<a href="https://liviaerxin.github.io/blog/how-to-qemu#bios-boot" class="hash-link" aria-label="Direct link to BIOS boot" title="Direct link to BIOS boot">​</a></h2>
<p>Test entering BIOS,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token parameter variable" style="color:#36acaa">-monitor</span><span class="token plain"> stdio </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 1G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then QEMU will show like this,</p>
<p><img decoding="async" loading="lazy" alt="BIOS" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAtAAAAGQCAIAAAAIhcA6AAAACXBIWXMAAAAAAAAAAQCEeRdzAAAQAElEQVR4nO3cUZrjphIGUO9/JVrm/fLS12OgKEpYVrfPebKFoH6QLJRkJo8HAAAAwF9w/GvvaO2Ao6ag18mEW+Z10h0yBC5e21GvQozyvbHxnj8puOFHJ9dm3e0SDxgUqjWNYlzpZPXppRn1qpX7ez546fmw7vNl45jBEycZ42TCm9zcN4kRKCSsPbjjfagwVGGE6S16mdXV2D7l2k+v/IO9ycqfKR30TV41LMiXKj+/kmMmH6bl51c+CbHVtTqenO+1/cZbOu1T90mwhuW5JE8rbI3JpvxvOZ9/uzfVLazq17ImX2r6HAl2iOmzMvkwDR5SccJYofpoyj9fp6sxqhgcX6o1nWwhYXdZloqe7FW+xIURytWfV697yaYrn08+7dXtG2eYFg2O55u6kVZjdM9ppxY0PUoXJU47KhRM52jEk+0W6s56tBrd/NN5TWPUVj4otxSDP2X622u/BsenP7BCrWC0QLdLUD2OMfoVZRZqdcrB+NP57kqYr3i+19F4X4x2iTLd8+s5Gm3peCZbvik55eDgUtPoatZW/pFY/Ha05DUKTlu6XuUu03GSE3n0lj2zMskYo6/x+IW14luM7qeXe7fbOhqne1fFXUa9guPJGU2rZ6a8FDhTdPo1P+tRr3heccLVXqs5u0eWhg2CdcP/fB59iHuN0o4WKl7AOH/yhGmtYMrxgMkTkk21lY9XY9RUG3C67LV1mK5tcH43eXde0+VdDRMsWjBmstbqmvAHFe6V9rTpIHGXfOml6WSqx4NnWvOxaz/m2OjMzAi13/+uXvkb4HyAafVpr9rtunR14o6rXbYs+NLtfWYiS4PU7vnRgOXrdSZMPl6yevBhKUxcOjPZ2j3DnxXcQ1seIt1B4i7xCEu36epPIh48UzpTsXukdiHK1WvnvK9X7Sq/qfq0Vz5t5jpOfyPJwEsJCwuenOb5iSwNUrvnRwOWr9eZMPl4yerBh6UwcenMZGv3DH9WcA8lm+KHSPeuirvkYxQm+HJ86ReV+YGNTlua8mPTA+JkwjMVV5vesYbJ2Mle+XtydGby6mQ6nuxSGDAeIT+1wspvKV24RkvXK9kls85L8+2eGXxYmle+dDL8tC9/3/Gv1aZH7w4b9Xo54XyM/ASTx0e14gBvmnKcP1nlTMJkuWDMfK94tO6A7Wi1/IUucZJuUzuF8mrES9StFU95OmBtytMx29auzCptD/8oreE0zKjpfPg29vMJ8bxWYyQnmy8EQIcn5sW+ecF/9dx/dXiAz2j/YfGzeb7KNy/4r5u7XwrAWfG/RuZNvnnZf+ncf2lsAAAAAAAA+LyjsXHkuOiuQnGGz/53xJfqG8MsTS1ziZeyfXxhAfh93vGHiuNxrtmrfqp8cGt83wvH6mjT1VjN5oUDgDXXv3Bc42VeH8/Qft07eP7kLTHucIkB+E2CrSj4V/GjpqPRLdcdLW6N/wE9nleh1mhe8eBxhmCt8gmDjskk8QqPCo1CdgcEgFfxFtv9Gp/ZPTJtHY1f29jiLfm5KTmvYyAfY5onk/DRvI4kFqM/l2SG6delGAB8r9FWNN19u02jI9PWTIzyFluoNWpa2mgze/aP1YTl1Ziuf3ywDZ/MAMBXO7P7dr92j0xb37rFJpsyU24/5DPk55VJWF6NpXeL0VvF8SSZAYCvltwFk02jI9PWTIzyFptsyky5/ZDPkJ9XJmF5NabrP53IY3EdAOC9Lxz5vS0To7zFJpsyU17aaJNrGCxgMGBtNZJzj8NnkhTWP24C4Bc7GkFrsunlhKBie7z9nKkVzyvfFNT6+dp+mMaIv7aj5Rc2uSDTBRy1xqtxeOEA4E+yGwEAbzH9J2kAgA3i/xwAAAAAAAAAAPDrHY2NI5fD1DpuH/C2f2Qkjndl+JssUW3Ko7/Ku/dX8KZrURszyLOU8+Y/EOCm3vHXQGpP/6P6f66c7r5Lo53seI043jXhb7VEq2G27LtnCn1qzF0Tv9XVB36Hu71wPLb+c/P2F46bPGe9cLzwwnFxnltdfeB3CF44jn+1vdqmo1GI0W2Kd4i4bzBg3LqUcxp+aQ3jctPVSIb8ObOQ8Jpa00nVYsS1Hr0VLkw5jpec8rHj95VMspqw/QwwFD/aul/jM7tH8hmmp+WPZ7KNvm55htbWMPMoD7aH1fDJ0uev8uPfjW2p1jRD7ZbbnjAoFI9wzcoHfadVRl8LYYAvNXrSfeqBOGp63glW+wajJadfkw+2GiNe86XwhRugUCVTa3Sh4+O1MJmFzScsTzkzl/Mrn1mo7vGg0Oo6ANzigRh0KT8rC9kytZbkgyWvQjByOXzhBihUibvULsqZ67V6v5Xvh8Lybl/52h31fLxtOp7kkwBf7Q4PxKDLmWflaraTtc4ES16FYORMr2mSO1zlZLy4aUuSM+OvDvjWla/dUXHrz5HyygBf560PxPzDaHUDyPSNs8Xj157L8cmF5c3HyPSahrzDVa5FWppyEL68GtNC5bmcX/nzd9RSYICOoxG0JpteTliNEQ8VJ0kOm5lXt1bByeVdmnIt/POZL72ChG3FZKHpUEvzqk15FP7lyOpqxFWCeS01jcLnJxuXy8SIFwoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4G2OxsaR46K7CsUZLqsVBxit8McTAsBFnje8XZtfPM41W+xPlTu8c7SfuycAwJ91/QvHNV7mdYcY3SR3WCsAeLvghSPz3wLiLqP9tTta3Lr6rytGZyZrjeYVDx6Xy+eMY3TDZ5pWwwPANtO9rf063cDiLS3YYvOf85MKWvPzOgZOJulOasuFWLpeAPB2hV1quoHFW1q3NRNjaadM7vGrU24/JGN44QDgq335C0dwfO8LR/4ELxwA/EFeOEbHvXAAwDZvfeGYvlssxfDCMUoVN2VeOArLlZkdAPznaAStyaaXE4KK7fH2c6ZWPK98U1Dr52v7oRYjPiGY8pam0bIEIVebAOC3sr09dmz/lhEAXj3vjnbKx+kXDmsIAH3T/zDxPab/TWTaZA0BAAAAAAAA4I6mf1vyzMjlMLWO2we87R93iONdGf4mS1SbcvCHXT4bLDny3jxLOW/+AwFu6vnBseshUnv6Hyv/Q61kufKMbv48jeNdE/5WS7QaZsu+e6bQp8bcNfFbXX3gd7jbC8dj6z83b3/huMlz1gvHCy8cF+e51dUHfofgheP4V9urbToahRjdpniHiPsGA8atSzmn4ZfWMC43XY1kyJ8zCwmvqTWdVC1GXOvRW+HClON4ySkfO35fySSrCdvPAEPxo637NT6zeySfYXpa/ngm2+jrlmdobQ0zj/Jge1gNnyx9/io//t3YlmpNM9Ruue0Jg0LxCNesfNB3WmX0tRAG+FKjJ92nHoijpuedYLVvMFpy+jX5YKsx4jVfCl+4AQpVMrVGFzo+XguTWdh8wvKUM3M5v/KZheoeDwqtrgPALR6IQZfys7KQLVNrST5Y8ioEI5fDF26AQpW4S+2inLleq/db+X4oLO/2la/dUc/H26bjST4J8NXu8EAMupx5Vq5mO1nrTLDkVQhGzvSaJrnDVU7Gi5u2JDkz/uqAb1352h0Vt/4cKa8M8HXe+kDMP4xWN4BM3zhbPH7tuRyfXFjefIxMr2nIO1zlWqSlKQfhy6sxLVSey/mVP39HLQUG6DgaQWuy6eWE1RjxUHGS5LCZeXVrFZxc3qUp18I/n/nSK0jYVkwWmg61NK/alEfhX46srkZcJZjXUtMofH6ycblMjHihAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADe5mhsHDkuuqtQnOGyWnGANkZw5MwV6XZ80yUGgAXPm9CuDSke55pt72X/fne51RjxK0gtfHApb7IaAHyv6184rvEyr5vECJY6f+ZLr2DA6eAAcJHpPxb/aHu1TUejW26018a12oTJeRVqjeYVDx7HiEfInzntcuZMAHiLeIvtfo3P7B6Ztma229VtfnT+c1NyXsdAMklmLquznl6FzOAAcJHkPpdsGh2ZtmZiLO2Uwclnptx+yMfY+MJxZs29cADwAV/+whEcv+0LR/IVJDM4AFzEC8fo+FtfOLY0xZNKDggAV3jrC8f03WIpxq9+4QhmnV/AuGjmGiXnfr4JAP7vaAStyaaXE4KK7fH2c6ZWPK98U1Dr52v7IRljdPLqsucrnoxxsgkAfivbGwDwFs8vGV44AIB3mf7nAAAAAAAAAACA3+1obBy5HKbWcfuAu1Zj+/Jm/oLrNX/e5SZ/qqYw5Zv8qaDuvRH8JOMf7KhpdOZqzrW5zUa74PdVaAqW9+HPrcNJzz+hXT+nwjg/Xc703ZLkZMdgnO0P2VrrLrd6+C6FOXOzbRTcG0HCUa/RCI9mgx/tppmcu1zw+yo0BadtTw7f6B07YmGclxjnM5STxB1PPql3TS2Occ0z8VZP3vJ1+dQU4ntj72Z5DNRybrFl2O4aHrMXtaApGfJWdz78JtNnVvfxNGqqPdTa0qNaQWt+2Dhhptx8PomT4zWMR5iuRjLkz5ndXnHCa2pNJ7Ua45FY1dpqxIMnM7St3XKF01rTkEHO5PVq+9Z6JbP9HKk1TcePjwMTo9/59Pk1OrN7JJ9helr+eCbb6OuWZ0o+2Gh5l6ZcC58sff4qP54u9GqtaYZ8mPhmKyQ8BjIxMq3d0m2VacLuh6numZla8dd8+Ey2XR+ehw0y5FcP+MfoYVF+pnSPLMXoNgWPgKVHw9HTnrzlmZIPthojXvOl8IUboFAlU2t0oePjhTDJ65JcjZ/P7YdahmTp+ALFi5Nfru6ZyQUMYsSXOBkvWPnah+Q086sH/GPpiTBtGh1ZipGJlyy3lC1Ta0k+WPIqBCOXwxdugEKVuEvtomyZci1ht3T7oZZhNH7ctLQ4+eXqnplfwPLdVcsWXIJM03T8M2kBLxzbaiWrd5uSVyEeedprGvIOVzkZL26qxcgn7JZuPyxlSE6tcL3OXLvumfkFLN9dtWzBJcg0Tcc/kxZ47wvHyedaXHfaN84Wj7/rWXNyefMxMr12JXw5svcq1yKVp7wx4eqCZKaWv9BLi3NyufK1CmmX4tVWoJZqNRvwj6MRtCabXk5YjREPFSdJDpuZV7dWzfYYe8M/n/nSK0jYVkwWmg61NK/ClIMYtYRtgJNrklyKttA0YXAkk3OUvNCUD5/M1u1VaIpjrGYDAAAAAAAAAAAAAAAAYKfpX5+rDfiOvzlW+5ty5RMKto/p7+AB8Ee87JFbdrh3bJOFMaddbpLzstEA4GNe/hc3XjhO8ooAAB1Hz6i1MGZcLtMUxMvXCnLmE9ZmHc8ryLNxDQHgw352pnajmm6QyTFHIyzVmlYPuoz6Jrf8oOi0Vn7KtSNbrhcAvF27Y2184Qg+55vi6se/MjGmVYIxl+YbD5iZY34dyuEB4ApnXgIyYyYHnNbq4oCoyQAAAm1JREFUVs/v39Puq3NMFpq+H5w/cjI8AFzBC8e0ylR50fYm9MIBwH39uheO5ODT1mmX/JTzExlVHBVaSpgJ76UEgM/IbJDBjhiM2e1Va3o5YXRwKXw5Rjzl1Rjt+WcSlmsBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/AHH2KejAQB/hRcOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOBr/Q+/+gHC6a5D6gAAAABJRU5ErkJggg==" width="720" height="400" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="kernel-boot">Kernel boot<a href="https://liviaerxin.github.io/blog/how-to-qemu#kernel-boot" class="hash-link" aria-label="Direct link to Kernel boot" title="Direct link to Kernel boot">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="uefi-boot">UEFI boot<a href="https://liviaerxin.github.io/blog/how-to-qemu#uefi-boot" class="hash-link" aria-label="Direct link to UEFI boot" title="Direct link to UEFI boot">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="test-uefi-boot">Test UEFI boot<a href="https://liviaerxin.github.io/blog/how-to-qemu#test-uefi-boot" class="hash-link" aria-label="Direct link to Test UEFI boot" title="Direct link to Test UEFI boot">​</a></h3>
<p>aarch64,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">efi</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/UEFI/aarch64/QEMU_EFI.fd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token parameter variable" style="color:#36acaa">-monitor</span><span class="token plain"> stdio </span><span class="token parameter variable" style="color:#36acaa">-M</span><span class="token plain"> virt </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> cortex-a57 </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 1G </span><span class="token parameter variable" style="color:#36acaa">-net</span><span class="token plain"> none </span><span class="token parameter variable" style="color:#36acaa">-bios</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$efi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-M</span><span class="token plain"> virt </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> cortex-a57 </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 1G </span><span class="token parameter variable" style="color:#36acaa">-net</span><span class="token plain"> none </span><span class="token parameter variable" style="color:#36acaa">-bios</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$efi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>x86_64,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">efi</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/UEFI/ovmf-x64/OVMF-pure-efi.fd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token parameter variable" style="color:#36acaa">-monitor</span><span class="token plain"> stdio </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 1G </span><span class="token parameter variable" style="color:#36acaa">-net</span><span class="token plain"> none </span><span class="token parameter variable" style="color:#36acaa">-bios</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$efi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then QEMU will drop into the <strong>UEFI</strong> shell, like this following image show,</p>
<p><img decoding="async" loading="lazy" alt="efi" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABQAAAAMgCAIAAADz+lisAAAACXBIWXMAAAAAAAAAAQCEeRdzAAAQAElEQVR4nO3d6ZajOBIGUL//E/htc5aaqSZBCkUIecG+9/QPW4jQAlmHr53L7QYAAAAAAAAAAAAAAAAAALyV+38d395bSu2ZcfP9tydOLvWc54/b3J/qdsVnzVXLzHNhfwAAgDV2IeSYtfKvj2+roy/vv0ow7oOmlLwu0wWH7efnuaQ/AADAMvmgNWw/HqqOvrz/KgLwyVFW9QcAAJg3EbQWpsGr5KXnjysAAwAALJYJWruIsusTVKuOvhv0OJmt3SnN/sc6u/7HofPjBsWbqwvqJDcnrhPXj6uVJhOckqw23R8AAGDeML8Fqa93aHr03hyC/sP5LxkoH/mSEyjFzt7+b+tUN2puJktKTfcHAAA4JZPfgiiVTFnJ0YM59Pon8+dw9LhzcDQ5geFCkvPslX15AJZ+AQCAdzcRIPNpsDr6cA69XLeTmX+y8/BocgODeWbEZTP1492YnkCpyHR/AACABZL5LTgleSjfP5hDKXqVisczz48yV39oWHZY/3EBWPoFAACuIR+AM1lOAF4VgKtlXxWAq+NKvwAAwMtM5Ld3CMC94DecZ3JRw3GDJdw3hgV7qtdlWL83Yv6SZdZ12/yPkuFCmv0BAAAe6P5bs3EXtOLUl8lUQf9e2NudmJ9/b+jmWJmzmkMf2+Mlx/szXFdvrybmmZxPc133lvyi8kMDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALxI7++y9v5Sa/B3aJP143YAAAB4lF6g3YXhYf/kEJl2AAAAWO+Yb4/tmWCcH2LYDgAAAOtl0qkADAAAwOVtA22zvfm6lF0FYAAAAF6vF2iHAbg6RL4dAAAA1vMJMAAAAF/BzwADAADwFQRgAAAAvsIuhcahN3idH2LYDgAAAOtVP+kVgAEAALiee8ux/dh/+7ZUP24HAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIB30vwzv7f03wcO2k9OKVmnN5/d0bk5BPWTIw5H701+4X4eZzXdv9p+6+zAqvq9/Q8XBwAAfKsgP1RfH9+unc/0/Kuzqu5Jsn9+xGF7SXUfhutKtt9aAXVh/cz+AwAA/CMf3obtx0PLp5fvfyYUxec296H5Oj9or+f5/azuw8Lwed9YXn84brgrAADAV5oIEkHAWJ49qgUzAak6YmYfmq/PDFqddrLysODCIJqZwHT9ZFkAAIB/BMlhGzZ6pySzYjxucFY1yeSDWWZix5qZJdw3qtNOtuc9OnAO9znu8KBxz+8bAADwgYLk0Aty99+CaslxV8W/Zs1mXkoW2bbEi23u29zMM+0TlY/70AyTvf7V9t4SVtWPxz2/bwAAwAcKksMuY/T6BNWS4zbPqmaYZNCq1jmWGi7hvjE3+WF7XiYoZvat2t5bwqr6mXWd2TcAAOADBclhIpXlg0c80ESAiSPQ3MTic3tLOIa0iUGr005Wbr7N7Fu1vTSB5eOe3zcAAOADBclhIpXNRb4l6WVVIhpGuGZ78/WZQYfTThbPXN/MtZgLosMO0/VXXW4AAOCLZALS37fN9qBactxg0PwQCxPRsFR+Cclxk4tKHkqupRkmq4FzuM/J67Jw3NK1BgAAvkgySCQDRil73DeCCnGgik9shqXkxJpvm6/Ph7H8ojKHej2DiZXWlWzvzXNV/cz+AwAA/HL/rdm4Cxu9VNM7Gg8d15kuta2WqdCsltmH+yF93Ts5szfQsVS8CdVF9eYZv83vZzDJzC4tbK/uDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAyM/Pf/7rvb2Q5LT/LLDXOT4KAADAhW0j30Pj30ODZal43FkABgAA+EwC8JlSAAAAXMbf0Lv973IEYAAAAAaCANyMxL2Pi+OPkfN1bq0PpUvzbx4KTmkWzPcHAADgGrZR89YJnMEvysq8zrQ0E28+cJY+1C3NM34LAADAZWQCngCcHAgAAID3NQyHwXcvJ19nWh4RgKvzb7bsigjAAAAAV9ULh0FKvEQAnpj/sDMAAAAXJgALwAAAAF/hwwLwmfkPO5emBAAAwHsZhsNentwejdt3h4KxhnWGC2nOJ1+/ui4AAAA+WS8HLs+HAicAAACv9NAAPPct0AAAALBY6ZuH1w4BAAAAAAAAAAAAAAAAAAAAAAAA5+z+uG7zj/Q2+2/f9o6em1ijys//LRhgNHo8ynOmAQAAwEq9QJv5M0vN1+czcBB0q+3To6/qBgAAwLuYDsDDj4Jn5/O/YNlMmAIwAAAAk94qAO9S5TFkPjp2lurLwAAAAFcyF4DjxNv74eHEZGYCcPNbpn82eu2ZT5iD/kEAlo0BAADeTvOXYN0SAfjY+OdF89yHBuCgfXeoWr/0NjkfAAAAXmPtJ8Anfw/WT8uxQ+/EoOawW7ND3F/KBQAAuJLP+BngXs9jig7SdalOMBkAAADe0UcG4OSnvtVMW/p8GAAAgPeSDMBxn9f+Eqz4xFIAzvcvRWUAAABeLxOAS6+bWfdNAnDmI9xkfwEYAADgSra/0eqYZo+Hmt2O1U7MJwqoPxvHs3qdb63g2qzTHLfZX74FAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOCR7gevrbMtOBzuOHq+eLNC8sTbA9bbnMZE8ZP7MDfDiVn1zprbyVfdDwAAwMVsn/Xzz/3NSDNRJ1k8OLoLpfniE5mnt8Yz+9Y7VF3XrRj8VtWv7lswz7nb5oX3AwAAcDGrgtxcnWTx5EDDcYP+Dz03M8Mz67ptUmUp9Z2vP71vE6WG9Z95PwAAANez6qF/YXhIpsTh27WnPzQsnVxXtefa+vl9W7XMZIWH3g8AAMD19PLJ/bfjKc3GfJ1m+/0gmG3wttrefBuMu3Dflqwrs4TMcHP18/sWj9vct95mTtSvrje5mQAAwGVsn/LPBKFmgFkePIKCmbUE/UvjZsYanrVwXZklNLstqT9xvTJvJ4Z+2v0AAABc0v23bePwrF6dXrdeuMoHj3zg2U6p1D+z2Nu6fVuyrmH9Xrcl9fOd7y3JyWeGrq4r0783HwAA4HpKkSbosM0S904gbPYZvg3Gzbyt9s8sttSY6XByXfkJPKJ+vvPE/t9/m1hIsK65+wEAALiqVUHub8v2UC9RTAeP/Iml+QTj9iazat+WrOu19acbh/sfXLsl65q4HwAAgAtbFeQyIWrYnhk9GWCqgac3aKl9Yt+WrKs624X1z+zP8LpXL9AT7gcAAODCJoLKsKUXoobtcbd852oQSo41PDSxb6vWFdcPep6sX9q36nUP5pYvEo/b7B8MBwAAXNV9IzjUzDzHFNHMG706Qf1jwebRoHPmbSbtxO3n923huu4H+VVM15/bt6Bbb0ql4UrryvQHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADaCP6b6Ej8tzUO9s5484XfYtIxV1/dBi3357bfqxnn6Ddj272n8+e/bDP/M8vLhnnPfvts/Mu82HwCAgu0D3DvEuWPo3TX2+hy7BValwXfYsaTzU31ClnjJ0Kuy4ltlzreazHM0b5JHf4U+4V+Ad/tHJpjPu00VAKDhnQPwn7fNxmb73/5Dq9LgO+xYkgDcIwB/BgH4OQRgAODa3jwANxuDAPxk77BjSRcKwE/eVQH4M7w8AD9orHf7R+bd5gMAUNN8gNu92D7u3H+bbu/Zhttm+7AxueTjJJuHMqVKgz5iP+P5n78u94O5OsN13VpbOuycGffvj8Vuk+GucXsrBY3bo3Gd4evkD+sG/TPzz3yJTNxXwzq7xmOdXre5eQZDJ9un19tby8n1TqwrWWpuH4L5HDsP6wR7kl8XAEBZ5rlk9xxzPLfaHgh+o9WxffoT4N7TW36epZ6r9i3Yz9K1m7guzW7VOsP59yqcvF69HNt8mz93WCfZuZSBb4c8HPRpdjuauK+GMjUX3j+907c3VWbc6nqb923vbXW9vW6r9m1uH4Lh4qk2x50bCABg3v23XXuz8/Ft70ll4gmm9wnwscPtsgG4117dz+FzZPJBMynetEzZoMPxDswPPRy3FHHjo0Hnlwfg5NBHyfuqJFPz5P2TOb06bnW9zfu2V7+63l63VV93yX3IDxdPtbkPcwMBAMxLPhttG3eah3qnDOeTybTnfwY4+aA2USfuGW9a8wExGG74HBksqnpdmrMK5lPah117dejMuMG3BDfzYfytxcEQvZZHBODkPJ8ZgOPru3tdvX/i/s3Tg3GbUz2z3t4mTK+31+3kvmXqBHsSDBdPtbkPx9fN6wIAsEzy2SjufKbmzqcG4OZZ1Y2qPrAmFzV9WfNPxsOC8Z6sul5/rPrW5bhsvs6ZAJzp87QAHJyYudbDseL+wztn+HWXmUOvf2bT5r5ezn/dTcwneSlLUx3uVXXzAQBmJJ+N4s5nau686s8gzT2HzT2xDR/EVz2wJhc1fVnzT8bDgvGerLpef7x/AC6VGvYRgONxgyGGSl9rc18v57/uJuaTvJSlqQ73anohAAAFyWejZmPvgXLYHmj+iG/wu6/mfiQ4+aA2USfTbXrfqg+syQfN6iqmr291/kHl0vWKQ+zft8cXw3Obo1TrTAfgZM1vC8Clr4sz663Wr663d/qqfUvuQ/L0YUv+AmWqAQDMuG9k2neHjg8r+famn5bmod5Z06sOnsOGRSb6P6i99/p4Smnyx9GH8yntQ/Nt85Tpcbc/KHu8TY7t25bdi2EGHtYZzqdXufd6V6f5Nja8ScZT/H3KLZdz7gcT82yO3nu7cL3V+hPrbQ403IegQrJOb129+dzCr9Pe63vnPiltDgAAfL6rPx8nc+9Xufo1rfq29QIAAJOuHh4E4J2rX9Cqb1svAAAw6erfJFn65ucP9m3f7/pt6wUAAAAAAAAAAAAAAAAAAAAAGMn8HdFqqWQ7AAAAPMkulx4z8MmCmYEAAADg4V4VgKfrAwAAwIwXBuDpIQAAAGBGHFmPP77ba89Uy7cDAADAes00u208vtj2OZ7VGyIYHQAAAJ4k8+3QjwjAw6MAAACwWO9ngHcBOPguaJ8AAwAAcAHJAJyscKYdAAAAVkr+FugHBWDpFwAAgCc5GYDPfAu09AsAAMBTNX+gt/k26H88FLdLvwAAAAAAAADf6t7x6nkBAADAUgIwAAAAX0EABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWQDxDAAACHdJREFUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgDfwLoHXaw4O8OOYAAAAASUVORK5CYII=" width="1280" height="800" class="img_ev3q"></p>
<p>Options in detail:</p>
<ul>
<li><code>-nographic</code>: Don't create a video for the VM, just use the terminal.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>quit QEMU: <code>Ctrl+A X</code>.<br>
<!-- -->enter QEMU monitor console: <code>Ctrl+A C</code>.<br>
<!-- -->see at <a href="https://superuser.com/questions/1087859/how-to-quit-the-qemu-monitor-when-not-using-a-gui" target="_blank" rel="noopener noreferrer">How to quit the QEMU monitor when not using a GUI?</a></p></div></div>
<ul>
<li><code>-monitor stdio</code>: Put QEMU monitor console in the terminal, while guest OS kept in created video device.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>switch between monitor console and guest OS: <code>Ctrl+Alt+1</code> or <code>Ctrl+Alt+2</code>.</p></div></div>
<ul>
<li><code>-net none</code>: Disable iPXE.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="boot-x86_64-iso-image">Boot x86_64 ISO image<a href="https://liviaerxin.github.io/blog/how-to-qemu#boot-x86_64-iso-image" class="hash-link" aria-label="Direct link to Boot x86_64 ISO image" title="Direct link to Boot x86_64 ISO image">​</a></h3>
<p>Boot x86_64 image in Windows,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">efi</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/UEFI/ovmf-x64/OVMF-pure-efi.fd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">iso</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ubuntu-22.04-live-server-amd64.iso</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>ubuntu-**-amd64.iso</code> support both <strong>UEFI</strong> and Legacy <strong>BIOS</strong> boot, QEMU use <strong>BIOS</strong> when the option <code>-bios</code> is not specified!</p></div></div>
<ol>
<li>Create a disk image to install the ubuntu OS,</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-img create </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> qcow2 ubuntu-image.qcow2 20G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Boot to run the Ubuntu OS</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-monitor</span><span class="token plain"> stdio </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-accel</span><span class="token plain"> whpx </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 8G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-drive</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ubuntu-image.qcow2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-bios</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$efi</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cdrom</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$iso</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Options in details,</p>
<ul>
<li><code>-accel whpx</code>: use hardware acceleration</li>
</ul>
<ol start="3">
<li>[?]Boot the installed Ubuntu OS</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Install OS into a disk image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-accel</span><span class="token plain"> whpx </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 8G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-bios</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$efi</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-drive</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ubuntu.qcow2,format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">qcow2,if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">virtio </span><span class="token punctuation" style="color:#393A34">\</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="boot-aarch64-iso-image">Boot aarch64 ISO image<a href="https://liviaerxin.github.io/blog/how-to-qemu#boot-aarch64-iso-image" class="hash-link" aria-label="Direct link to Boot aarch64 ISO image" title="Direct link to Boot aarch64 ISO image">​</a></h3>
<p>Emulate aarch64 ISO image in Windows,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">efi</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/UEFI/aarch64/QEMU_EFI.fd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">iso</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"ubuntu-22.04-live-server-arm64.iso"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-monitor</span><span class="token plain"> stdio </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-machine</span><span class="token plain"> virt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> cortex-a57 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-drive</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ubuntu.qcow2,format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">raw,if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">virtio </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-bios</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$efi</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cdrom</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$iso</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Emulate aarch64 ISO image in mac M1,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-aarch64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-monitor</span><span class="token plain"> stdio </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-machine</span><span class="token plain"> virt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-accel</span><span class="token plain"> hvf </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cpu</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-smp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-drive</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ubuntu.qcow2,format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">raw,if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">virtio </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-bios</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$efi</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-cdrom</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$iso</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Options in details,</p>
<ul>
<li><code>-accel hvf</code>: use hardware acceleration in mac M1.</li>
<li><code>-cpu host</code>: use mac M1 arm CPU.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="boot-a-preinstalled-image">Boot a preinstalled image<a href="https://liviaerxin.github.io/blog/how-to-qemu#boot-a-preinstalled-image" class="hash-link" aria-label="Direct link to Boot a preinstalled image" title="Direct link to Boot a preinstalled image">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># linux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">fdisk</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> ubuntu-core-22-arm64+raspi.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># osx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdiutil imageinfo ubuntu-core-22-arm64+raspi.img</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/TinyCore/boot/vmlinuz64"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">initrd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/TinyCore/boot/corepure64.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">img</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/TinyCorePure64-14.0.iso"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">efi</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/UEFI/ovmf-x64/OVMF-pure-efi.fd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/linux_qemu/x86_64/bzImage"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">vmlinuz</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/linux_qemu/x86_64/vmlinux"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">initrd</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/linux_qemu/x86_64/rootfs.ext2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">img</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/linux_qemu/x86_64/rootfs.ext2"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qemu-system-x86_64 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-nographic</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 4G </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-kernel</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$kernel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-initrd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$img</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-append</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"console=ttyS0"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-netdev</span><span class="token plain"> user,id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet,hostfwd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp::2222-:22 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-device</span><span class="token plain"> virtio-net-pci,netdev</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mynet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="boot-linux-kernel">Boot linux kernel<a href="https://liviaerxin.github.io/blog/how-to-qemu#boot-linux-kernel" class="hash-link" aria-label="Direct link to Boot linux kernel" title="Direct link to Boot linux kernel">​</a></h3>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="troubleshooting">Troubleshooting<a href="https://liviaerxin.github.io/blog/how-to-qemu#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a href="https://liviaerxin.github.io/blog/how-to-qemu#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p><a href="https://joonas.fi/2021/02/uefi-pc-boot-process-and-uefi-with-qemu/" target="_blank" rel="noopener noreferrer">UEFI, PC boot process and UEFI with QEMU | joonas.fi</a></p>
<p><a href="https://medium.com/@ThyCrow/compiling-the-linux-kernel-and-creating-a-bootable-iso-from-it-6afb8d23ba22" target="_blank" rel="noopener noreferrer">https://medium.com/@ThyCrow/compiling-the-linux-kernel-and-creating-a-bootable-iso-from-it-6afb8d23ba22</a></p>
<p><a href="https://levelup.gitconnected.com/probably-the-simplest-way-to-install-debian-ubuntu-in-qemu-2db6afde27ef" target="_blank" rel="noopener noreferrer">https://levelup.gitconnected.com/probably-the-simplest-way-to-install-debian-ubuntu-in-qemu-2db6afde27ef</a></p>
<p><a href="https://krinkinmu.github.io/2020/11/21/EFI-aarch64.html" target="_blank" rel="noopener noreferrer">UEFI on AARCH64 | Welcome to the Mike’s homepage!</a></p>
<p><a href="https://github.com/tianocore/tianocore.github.io/wiki/OVMF" target="_blank" rel="noopener noreferrer">OVMF · tianocore/tianocore.github.io Wiki · GitHub</a></p>
<p><a href="https://wiki.debian.org/Arm64Qemu" target="_blank" rel="noopener noreferrer">Arm64Qemu - Debian Wiki</a></p>
<p><a href="http://cdn.kernel.org/pub/linux/kernel/people/will/docs/qemu/qemu-arm64-howto.html" target="_blank" rel="noopener noreferrer">http://cdn.kernel.org/pub/linux/kernel/people/will/docs/qemu/qemu-arm64-howto.html</a></p>
<p><a href="https://futurewei-cloud.github.io/ARM-Datacenter/qemu/how-to-launch-aarch64-vm/" target="_blank" rel="noopener noreferrer">https://futurewei-cloud.github.io/ARM-Datacenter/qemu/how-to-launch-aarch64-vm/</a></p>
<p><a href="https://xryan.net/p/212" target="_blank" rel="noopener noreferrer">Build an aarch64 UEFI image for QEMU - lyan</a></p>]]></content:encoded>
            <category>vm</category>
            <category>how-to</category>
        </item>
        <item>
            <title><![CDATA[Managing intel VROC RAID on ubuntu]]></title>
            <link>https://liviaerxin.github.io/blog/raid-intel-vroc</link>
            <guid>https://liviaerxin.github.io/blog/raid-intel-vroc</guid>
            <pubDate>Tue, 29 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Setup Intel VROC RAID on Ubuntu]]></description>
            <content:encoded><![CDATA[<p>This document will present how to create and manage <strong>Intel VROC RAID</strong> on Ubuntu with <code>mdadm</code> utility(It should also work in other Linux).</p>
<p>For setting up <strong>Intel VROC RAID</strong> on Ubuntu in <code>BIOS</code>, go to see <a href="https://www.intel.com/content/dam/support/us/en/documents/memory-and-storage/ssd-software/VROC-Ubuntu-Setup-UserGuide-342787-US.pdf" target="_blank" rel="noopener noreferrer">VROC Ubuntu Setup</a>.</p>
<p>For creating <strong>software RAID</strong> on Ubuntu, go to see:</p>
<p><a href="https://liviaerxin.github.io/blog/raid-on-ubuntu">Ubuntu RAID</a>.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="background">Background<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p>On the premise machine, there are 2 NVMe SSDs and 8 SATA hard drives(HDDs), and also it ships with a in-box hardware-assisted RAID controller(<strong>Intel VROC</strong>) on the Intel CPU, which is supposed to keep overall advantages over <strong>software RAID</strong>.</p>
<p>For me, I would like to use these 8 HDDs(<code>sda</code>, <code>sdb</code>, ..., <code>sdh</code>) to store data for long time, while retaining the balance between redundancy and performance. So here <strong>RAID 5</strong>(Stripping with Parity) comes into my mind.</p>
<p>To leverage the power of <strong>Intel VROC</strong> in Ubuntu(Linux), you also need the <code>mdadm</code> command line tool to manage intel VROC which support RAID 0, RAID 1, RAID 5 and RAID 10</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>In my understanding, the intel VROC register in system with the common interface with <code>mdadm</code>, so the <code>mdadm</code> software can operate it. And running command will show the <code>mdadm</code> is using intel VROC,</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> --detail-platform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Platform </span><span class="token builtin class-name">:</span><span class="token plain"> Intel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Virtual RAID on CPU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8.0</span><span class="token plain">.3.1002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RAID Levels </span><span class="token builtin class-name">:</span><span class="token plain"> raid0 raid1 raid10 raid5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Chunk Sizes </span><span class="token builtin class-name">:</span><span class="token plain"> 4k 8k 16k 32k 64k 128k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2TB volumes </span><span class="token builtin class-name">:</span><span class="token plain"> supported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      2TB disks </span><span class="token builtin class-name">:</span><span class="token plain"> supported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Max Disks </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Max Volumes </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> per array, </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> per controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> I/O Controller </span><span class="token builtin class-name">:</span><span class="token plain"> /sys/devices/pci0000:00/0000:00:17.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SATA</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Port7 </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/sdh </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZR909K07</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Port6 </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/sdg </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZV70BN24</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Port3 </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/sdd </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZV70BD3T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Port4 </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/sde </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZR909Q89</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Port1 </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/sdb </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZRT0S2FM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Port5 </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/sdf </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZR9099MM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Port2 </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/sdc </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZR909AGN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Port0 </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/sda </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ZV70BMH9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Platform </span><span class="token builtin class-name">:</span><span class="token plain"> Intel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Virtual RAID on CPU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Version </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8.0</span><span class="token plain">.3.1002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RAID Levels </span><span class="token builtin class-name">:</span><span class="token plain"> raid0 raid1 raid10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Chunk Sizes </span><span class="token builtin class-name">:</span><span class="token plain"> 4k 8k 16k 32k 64k 128k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2TB volumes </span><span class="token builtin class-name">:</span><span class="token plain"> supported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      2TB disks </span><span class="token builtin class-name">:</span><span class="token plain"> supported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Max Disks </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">96</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Max Volumes </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> per array, </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"> per controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 3rd party NVMe </span><span class="token builtin class-name">:</span><span class="token plain"> supported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> I/O Controller </span><span class="token builtin class-name">:</span><span class="token plain"> /sys/devices/pci0000:8d/0000:8d:00.5 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">VMD</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NVMe under VMD </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/nvme0n1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">633FC084FCVK</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NVMe under VMD </span><span class="token builtin class-name">:</span><span class="token plain"> /dev/nvme1n1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">633FC0DEFCVK</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> I/O Controller </span><span class="token builtin class-name">:</span><span class="token plain"> /sys/devices/pci0000:6f/0000:6f:00.5 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">VMD</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> I/O Controller </span><span class="token builtin class-name">:</span><span class="token plain"> /sys/devices/pci0000:51/0000:51:00.5 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">VMD</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Install Ubuntu Server on RAID:
Ubuntu Server Image has inbox <code>mdadm</code> utilities and <code>VMD</code> drivers(which enable intel VROC functionalities), so it is quite convenient to create the RAID 1 on 2 SSDs either in BIOS stage(for intel VROC only) or in storage layer step during OS installation stage(software RAID), then install Ubuntu Server OS on the RAID 1.</p><p>After creating the RAID 1 via intel VROC in BIOS, Ubuntu Server installation can detect the RAID created by VROC in step when set up the storage layer.</p><p>If you skip BIOS to create RAID during OS installation, remember to add <code>-e isms</code> when using <code>mdadm</code> to create RAID(you can enter the terminal, do ``) otherwise the RAID is software based and does not apply VROC.</p><p>Install Ubuntu Desktop on RAID:
Ubuntu Desk Image does not ship the <code>mdadm</code> tool, so it is nearly impossible to create RAID and install Ubuntu Desktop OS on the RAID(however this one <a href="https://askubuntu.com/questions/1299978/install-ubuntu-20-04-desktop-with-raid-1-and-lvm-on-machine-with-uefi-bios" target="_blank" rel="noopener noreferrer">Install Ubuntu 20.04 desktop with RAID 1 and LVM on machine with UEFI BIOS</a> from stackoverflow seems to be successful)</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="set-up-raid-5-array">Set up RAID 5 array<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#set-up-raid-5-array" class="hash-link" aria-label="Direct link to Set up RAID 5 array" title="Direct link to Set up RAID 5 array">​</a></h2>
<p>Here, I use 8 disks: <code>/dev/sda</code>, <code>/dev/sdb</code>, ..., <code>/dev/sdh</code> to create <strong>RAID 5</strong> array and mount it for use in practice.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-raid-array">Create RAID array<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#create-raid-array" class="hash-link" aria-label="Direct link to Create RAID array" title="Direct link to Create RAID array">​</a></h3>
<p>When creating RAID array, <strong>Intel VROC</strong> is different with <strong>software RAID</strong> array creation as an additional container is needed to create firstly. Inside the container, some information is labelled into the drives for Intel VROC controller to recognize them.</p>
<ol>
<li>Create RAID Container with Intel IMSM Metadata</li>
</ol>
<p>the total number of drives is 8 and <code>-e imsm</code>.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--create</span><span class="token plain"> /dev/md/imsm0 /dev/sd</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a-h</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> imsm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Then, Create a RAID array in the <code>/dev/md/imsm0</code> container using total 8 drives with <strong>RAID 5</strong>.</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--create</span><span class="token plain"> /dev/md/md0 /dev/md/imsm0 </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mount-the-raid-array-for-use">Mount the RAID array for use<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#mount-the-raid-array-for-use" class="hash-link" aria-label="Direct link to Mount the RAID array for use" title="Direct link to Mount the RAID array for use">​</a></h3>
<p>After you create the RAID array in above step, all partitions and data will be erased from all individual disks.</p>
<p>The RAID array is treated as a <strong>logical drive</strong> now.</p>
<ol>
<li>Create a <code>ext4</code> filesystem on the RAID array</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> mkfs.ext4 </span><span class="token parameter variable" style="color:#36acaa">-F</span><span class="token plain"> /dev/md/md0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Mount the RAID array</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /mnt/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> /dev/md/md0 /mnt/md0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="save-raid-array-configuration">Save RAID array configuration<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#save-raid-array-configuration" class="hash-link" aria-label="Direct link to Save RAID array configuration" title="Direct link to Save RAID array configuration">​</a></h3>
<p>To make sure that the RAID array is reassembled and mounted automatically after reboot, we will have to add some necessary information into <code>/etc/mdadm/mdadm.conf</code> and <code>/etc/fstab</code>.</p>
<ol>
<li>Scan active array and append into <code>/etc/mdadm/mdadm.conf</code> file with following:</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--detail</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--scan</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> /etc/mdadm/mdadm.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Update <code>initramfs</code>, so the array will be available at early boot:</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> update-initramfs </span><span class="token parameter variable" style="color:#36acaa">-u</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Add mount options to <code>/etc/fstab</code>, you can use <code>UUID=xxxx</code> instead of the <code>/dev/md0</code>.</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/dev/md0 /mnt/md0 ext4 defaults,nofail,discard 0 0'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> /etc/fstab</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="remove-raid-array">Remove RAID Array<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#remove-raid-array" class="hash-link" aria-label="Direct link to Remove RAID Array" title="Direct link to Remove RAID Array">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optional-umount-the-array-from-filesystem">[Optional] Umount the array from filesystem<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#optional-umount-the-array-from-filesystem" class="hash-link" aria-label="Direct link to [Optional] Umount the array from filesystem" title="Direct link to [Optional] Umount the array from filesystem">​</a></h3>
<p>Umount the array from filesystem if mounted,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">umount</span><span class="token plain"> /dev/md/md0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stop-raid-container-and-array">Stop RAID container and array<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#stop-raid-container-and-array" class="hash-link" aria-label="Direct link to Stop RAID container and array" title="Direct link to Stop RAID container and array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Stop RAID container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> /dev/md/imsm0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Stop RAID array</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> /dev/md/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Stop all arrays and containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--scan</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="removes-the-raid-metadata">Removes the RAID metadata<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#removes-the-raid-metadata" class="hash-link" aria-label="Direct link to Removes the RAID metadata" title="Direct link to Removes the RAID metadata">​</a></h3>
<p>Removes the RAID metadata on each <strong>drive</strong> and resets the <strong>drive</strong> to normal</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> --zero-superblock /dev/sda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> --zero-superblock /dev/sd</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a-h</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optional-remove-raid-configuration">[Optional] Remove RAID configuration<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#optional-remove-raid-configuration" class="hash-link" aria-label="Direct link to [Optional] Remove RAID configuration" title="Direct link to [Optional] Remove RAID configuration">​</a></h3>
<p>Remove mount information to the array if exist. Edit the <code>/etc/fstab</code>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/fstab</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> /etc/fstab</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Also, remove the array definition if exist, from the <code>/etc/mdadm/mdadm.conf</code> file:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/mdadm/mdadm.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> /etc/mdadm/mdadm.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="manage-raid-array-with-mdadm">Manage RAID Array with mdadm<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#manage-raid-array-with-mdadm" class="hash-link" aria-label="Direct link to Manage RAID Array with mdadm" title="Direct link to Manage RAID Array with mdadm">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="find-all-raid-arrays">Find all RAID arrays<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#find-all-raid-arrays" class="hash-link" aria-label="Direct link to Find all RAID arrays" title="Direct link to Find all RAID arrays">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/mdstat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Personalities </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">linear</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">multipath</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid10</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">md126 </span><span class="token builtin class-name">:</span><span class="token plain"> active raid1 nvme0n1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> nvme1n1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">3800741888</span><span class="token plain"> blocks super external:/md127/0 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">UU</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">md127 </span><span class="token builtin class-name">:</span><span class="token plain"> inactive nvme0n1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> nvme1n1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">10402</span><span class="token plain"> blocks super external:imsm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unused devices: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="query-information-on-a-raid-array">Query information on a RAID array<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#query-information-on-a-raid-array" class="hash-link" aria-label="Direct link to Query information on a RAID array" title="Direct link to Query information on a RAID array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--detail</span><span class="token plain"> /dev/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--query</span><span class="token plain"> /dev/md0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="query-information-on-a-physical-disk-drive">Query information on a physical disk drive<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#query-information-on-a-physical-disk-drive" class="hash-link" aria-label="Direct link to Query information on a physical disk drive" title="Direct link to Query information on a physical disk drive">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--query</span><span class="token plain"> /dev/sda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--examine</span><span class="token plain"> /dev/sda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stop-a-raid-array">Stop a RAID array<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#stop-a-raid-array" class="hash-link" aria-label="Direct link to Stop a RAID array" title="Direct link to Stop a RAID array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> /dev/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Stop all arrays</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--scan</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="starting-a-raid-array">Starting a RAID Array<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#starting-a-raid-array" class="hash-link" aria-label="Direct link to Starting a RAID Array" title="Direct link to Starting a RAID Array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># This works if the array is defined in the configuration `/etc/mdadm/mdadm.conf` file.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--assemble</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--scan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--assemble</span><span class="token plain"> /dev/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If the array is not persisted in `/etc/mdadm/mdadm.conf` file but keeping RAID metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--assemble</span><span class="token plain"> /dev/md0 /dev/sda /dev/sdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="adding-spare-devices-to-a-raid-array">Adding spare devices to a RAID Array<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#adding-spare-devices-to-a-raid-array" class="hash-link" aria-label="Direct link to Adding spare devices to a RAID Array" title="Direct link to Adding spare devices to a RAID Array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> /dev/md0 </span><span class="token parameter variable" style="color:#36acaa">--add</span><span class="token plain"> /dev/sde</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ lsblk </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        FSTYPE          FSVER  LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop0       squashfs        </span><span class="token number" style="color:#36acaa">4.0</span><span class="token plain">                                                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">% /snap/core20/1974</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop1       squashfs        </span><span class="token number" style="color:#36acaa">4.0</span><span class="token plain">                                                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">% /snap/lxd/24322</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop2       squashfs        </span><span class="token number" style="color:#36acaa">4.0</span><span class="token plain">                                                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">% /snap/snapd/19457</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sda         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdb         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdc         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdd         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sde         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdf         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdg         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdh         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvme0n1     isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─md126                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├─md126p1 vfat            FAT32        292B-DB66                                 1G     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /boot/efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └─md126p2 ext4            </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">          0f58386c-334d-4877-8051-b855bae37fb0    </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.3T     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─md127                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvme1n1     isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─md126                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├─md126p1 vfat            FAT32        292B-DB66                                 1G     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /boot/efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └─md126p2 ext4            </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">          0f58386c-334d-4877-8051-b855bae37fb0    </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.3T     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─md127                         </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fdisk</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> /dev/sda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="delete-partition-and-data-in-disk">Delete partition and data in disk<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#delete-partition-and-data-in-disk" class="hash-link" aria-label="Direct link to Delete partition and data in disk" title="Direct link to Delete partition and data in disk">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/dev/zero </span><span class="token assign-left variable" style="color:#36acaa">of</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/dev/sda  </span><span class="token assign-left variable" style="color:#36acaa">bs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">512</span><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">count</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a href="https://liviaerxin.github.io/blog/raid-intel-vroc#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li><a href="https://www.intel.com/content/dam/support/us/en/documents/memory-and-storage/ssd-software/Linux_VROC_6-0_User_Guide.pdf" target="_blank" rel="noopener noreferrer">Linux VROC User Guide</a></li>
<li><a href="https://www.intel.com/content/dam/support/us/en/documents/memory-and-storage/ssd-software/VROC-Ubuntu-Setup-UserGuide-342787-US.pdf" target="_blank" rel="noopener noreferrer">VROC Ubuntu Setup</a></li>
</ul>]]></content:encoded>
            <category>raid</category>
            <category>ubuntu</category>
        </item>
        <item>
            <title><![CDATA[Managing RAID on ubuntu]]></title>
            <link>https://liviaerxin.github.io/blog/raid-on-ubuntu</link>
            <guid>https://liviaerxin.github.io/blog/raid-on-ubuntu</guid>
            <pubDate>Tue, 29 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Setup Intel VROC RAID on Ubuntu]]></description>
            <content:encoded><![CDATA[<p>What is RAID?</p>
<p>The Redundant Array of Independent Disks, commonly known as RAID, is a technology used to combine multiple physical disk drives into a single logical unit for the purpose of data storage and performance improvement.</p>
<p>This blog will demonstrate to set up <strong>software RAID</strong> on Ubuntu(It should also work on other Linux).</p>
<p>To setup <strong>Intel VROC RAID</strong> on Ubuntu, go to see: <a href="https://liviaerxin.github.io/blog/raid-intel-vroc">Intel VROC RAID on Ubuntu</a>.</p>
<p>The hierarchy of storage abstraction layers in Linux.</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |   Application          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |open("/mnt/media/1.png")|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |    Mount Point         |   Higher layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |        ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |/dev/sda1 -&gt; /mnt/media |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |/dev/sda2 -&gt; /mnt/file  |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |    Logical Volume      |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | /dev/mapper/vg1-lg1,   |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | /dev/mapper/vg1-lg2,   |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |     File System        |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |   ext4, Btrfs, etc     |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |      Partition         |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  /dev/sda1, /dev/sda2  |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  Physical Disk Drive   |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |                        |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |    HDD /dev/hda        |  Lower layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |    SSD /dev/sda        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    +------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <strong>RAID</strong> is treated as <strong>Logical Disk Drive</strong> above the <strong>Physical Disk Drive</strong> layer. So you should do partitioning on it after being created.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="background">Background<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p>Recently, there is a chance for me to install Ubuntu(server) OS on a Dell Precision xxx workstation which is includes 2 NVMe SSDs and 8 SATA hard drives(HDDs) and has in-box hardware-assisted RAID controller(<strong>Intel VROC</strong>). In the past, I just play cloud virtual machines or personal host with single disk.</p>
<p>Configuring storage is a critical part of setting up a reliable workstation. So firstly, how to organize these following disks to their roles?</p>
<ul>
<li>2 SSDs hold the system to load quickly</li>
<li>8 HDDs store data persistently</li>
</ul>
<p>In order to access these physical disks easily and reduce damages from data loss, I need to combine multiple disks to act as one, while keep data redundant and backup. After step-by-step research, there are some enterprise solutions present for me. These drive layer or file system layer approaches designed for specific purposes have their own advantages over others while they maybe achieve some same features.</p>
<p>Here are some benefits and shortcomings of them alongside common use cases:</p>
<ul>
<li>
<p><strong>RAID</strong>(Redundant Array of Independent Disks)
Abstraction level: drive layer
Concept: RAID uses multiple drives to act as one(logical drive).
Benefits: improve data redundancy and data read/write performance</p>
</li>
<li>
<p><strong>LVM</strong>(Logical Volume Management)
Abstraction level: file system layer
Concept: Manage a logical volume over multiple drives, each drive is a Physical Volume(PV).
Benefits: combine multiple disks into one logical volume, extend the volume with new disk added, increase/decrease mounted folder in file system</p>
</li>
<li>
<p><strong>ZFS</strong>(Z File System)</p>
</li>
</ul>
<p>There are three types of raid, as Wiki saying:</p>
<ol>
<li>hardware RAID</li>
<li>software RAID<!-- -->
<ul>
<li><strong>mdadm</strong> in Linux</li>
</ul>
</li>
<li>hardware-assisted software RAID, firmware RAID, fake RAID<!-- -->
<ul>
<li><strong>Intel VROC</strong> (Virtual RAID on CPU)</li>
</ul>
</li>
</ol>
<p>This document will introduce how to set up software RAID(RAID0, RAID1, RAID5, RAID 10) on <strong>already-installed</strong> Ubuntu.</p>
<p>To create a RAID to hold the Ubuntu OS when installing Ubuntu, see <a href="https://help.ubuntu.com/community/Installation/SoftwareRAID" target="_blank" rel="noopener noreferrer">SoftwareRAID</a> or <a href="https://www.servers.com/support/knowledge/linux-administration/how-to-install-ubuntu-with-software-raid-1" target="_blank" rel="noopener noreferrer">How to install Ubuntu with software RAID-1</a></p>
<p>In addition, there are different challenges you will face when installing Ubuntu Server and Ubuntu Desktop.</p>
<blockquote>
<p>Install Ubuntu Server on RAID:
Ubuntu Server Image has inbox <code>mdadm</code> utilities, so it is quite convenient to create the software RAID on multiple disks then install Ubuntu Server OS on the RAID in storage layer step during OS installation stage.</p>
</blockquote>
<hr>
<blockquote>
<p>Install Ubuntu Desktop on RAID:
Ubuntu Desk Image does not ship the <code>mdadm</code> tool, so it is nearly impossible to create RAID and install Ubuntu Desktop OS on the RAID(however this one <a href="https://askubuntu.com/questions/1299978/install-ubuntu-20-04-desktop-with-raid-1-and-lvm-on-machine-with-uefi-bios" target="_blank" rel="noopener noreferrer">Install Ubuntu 20.04 desktop with RAID 1 and LVM on machine with UEFI BIOS</a> from stackoverflow seems to be successful)</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="set-up-raid-array">Set up RAID array<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#set-up-raid-array" class="hash-link" aria-label="Direct link to Set up RAID array" title="Direct link to Set up RAID array">​</a></h2>
<p>To create a RAID array ready to use in practice, there are always common steps:</p>
<ol>
<li>Create a RAID array(RAID 0, RAID 1, RAID 5 or RAID 10)</li>
<li>Mount the RAID array</li>
<li>Save the RAID array configuration for system boot</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-raid-array-with-mdadm">Create RAID array with mdadm<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#create-raid-array-with-mdadm" class="hash-link" aria-label="Direct link to Create RAID array with mdadm" title="Direct link to Create RAID array with mdadm">​</a></h3>
<p>Create <strong>RAID 0</strong> array using devices: <code>/dev/sda</code> and <code>/dev/sdb</code></p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--create</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--verbose</span><span class="token plain"> /dev/md0 </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> /dev/sda /dev/sdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mount-raid-array-for-use">Mount RAID array for use<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#mount-raid-array-for-use" class="hash-link" aria-label="Direct link to Mount RAID array for use" title="Direct link to Mount RAID array for use">​</a></h3>
<ol>
<li>Create a <code>ext4</code> filesystem on the array</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> mkfs.ext4 </span><span class="token parameter variable" style="color:#36acaa">-F</span><span class="token plain"> /dev/md0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Mount the array</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /mnt/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> /dev/md0 /mnt/md0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="save-raid-array-configuration">Save RAID array configuration<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#save-raid-array-configuration" class="hash-link" aria-label="Direct link to Save RAID array configuration" title="Direct link to Save RAID array configuration">​</a></h3>
<p>Persist the RAID array configuration to make the system reassemble and mount the RAID array automatically after reboot.</p>
<p>Append the line to <code>/etc/mdadm/mdadm.conf</code>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--detail</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--scan</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> /etc/mdadm/mdadm.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Make RAID array available in early boot stage:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> update-initramfs </span><span class="token parameter variable" style="color:#36acaa">-u</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Persist the mount point, edit <code>/etc/fstab</code>:</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/fstab</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/dev/md0  /mnt/md0  ext4  defaults,nofail,discard 0 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>or persist the mount point by using <code>UUID</code>, get <code>UUID</code> of the disk drive,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ blkid /dev/md124</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/md124: </span><span class="token assign-left variable" style="color:#36acaa">UUID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"b7fa44f2-0f05-47a1-b4ef-e9ad306898de"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">BLOCK_SIZE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"4096"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"ext4"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>then edit in <code>/etc/fstab</code>,</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/fstab</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">UUID=b7fa44f2-0f05-47a1-b4ef-e9ad306898de  /volume  ext4  defaults,nofail,discard 0 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>finally apply the new mount,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="delete-raid-array-with-mdadm">Delete RAID Array with mdadm<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#delete-raid-array-with-mdadm" class="hash-link" aria-label="Direct link to Delete RAID Array with mdadm" title="Direct link to Delete RAID Array with mdadm">​</a></h2>
<p>Make sure to remove what are using the RAID array,</p>
<p>[Optional] Umount the array from filesystem if mounted,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">umount</span><span class="token plain"> /dev/md0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Stop RAID array,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> /dev/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Stop all arrays</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--scan</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Removes the RAID metadata and resets them to normal on the <strong>Drives</strong>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> --zero-superblock /dev/sda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> --zero-superblock /dev/sd</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a-h</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>[Optional] Remove any persistent references to the array if exist. Edit the <code>/etc/fstab</code>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/fstab</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> /etc/fstab</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>[Optional] Also, remove the array definition if exist, from the <code>/etc/mdadm/mdadm.conf</code> file:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/mdadm/mdadm.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> /etc/mdadm/mdadm.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="manage-raid-array-with-mdadm">Manage RAID Array with mdadm<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#manage-raid-array-with-mdadm" class="hash-link" aria-label="Direct link to Manage RAID Array with mdadm" title="Direct link to Manage RAID Array with mdadm">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="find-the-raid-arrays">Find the RAID arrays<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#find-the-raid-arrays" class="hash-link" aria-label="Direct link to Find the RAID arrays" title="Direct link to Find the RAID arrays">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/mdstat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Personalities </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">linear</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">multipath</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">raid10</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">md126 </span><span class="token builtin class-name">:</span><span class="token plain"> active raid1 nvme0n1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> nvme1n1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">3800741888</span><span class="token plain"> blocks super external:/md127/0 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">UU</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">md127 </span><span class="token builtin class-name">:</span><span class="token plain"> inactive nvme0n1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> nvme1n1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">10402</span><span class="token plain"> blocks super external:imsm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unused devices: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="query-information-on-raid-array">Query information on RAID array<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#query-information-on-raid-array" class="hash-link" aria-label="Direct link to Query information on RAID array" title="Direct link to Query information on RAID array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--detail</span><span class="token plain"> /dev/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--query</span><span class="token plain"> /dev/md0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="query-information-on-individual-physical-devices">Query information on individual physical devices<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#query-information-on-individual-physical-devices" class="hash-link" aria-label="Direct link to Query information on individual physical devices" title="Direct link to Query information on individual physical devices">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--query</span><span class="token plain"> /dev/sda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--examine</span><span class="token plain"> /dev/sda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stop-raid-array">Stop RAID array<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#stop-raid-array" class="hash-link" aria-label="Direct link to Stop RAID array" title="Direct link to Stop RAID array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> /dev/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Stop all arrays</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--stop</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--scan</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="start-an-raid-array">Start an RAID array<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#start-an-raid-array" class="hash-link" aria-label="Direct link to Start an RAID array" title="Direct link to Start an RAID array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># This works if the array is defined in the configuration `/etc/mdadm/mdadm.conf` file.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--assemble</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--scan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--assemble</span><span class="token plain"> /dev/md0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If the array is not persisted in `/etc/mdadm/mdadm.conf` file but keeping RAID metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--assemble</span><span class="token plain"> /dev/md0 /dev/sda /dev/sdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="add-a-spare-device-to-an-raid-array">Add a spare device to an RAID array<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#add-a-spare-device-to-an-raid-array" class="hash-link" aria-label="Direct link to Add a spare device to an RAID array" title="Direct link to Add a spare device to an RAID array">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mdadm</span><span class="token plain"> /dev/md0 </span><span class="token parameter variable" style="color:#36acaa">--add</span><span class="token plain"> /dev/sde</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="check-block-devices">Check block devices<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#check-block-devices" class="hash-link" aria-label="Direct link to Check block devices" title="Direct link to Check block devices">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ lsblk </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        FSTYPE          FSVER  LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop0       squashfs        </span><span class="token number" style="color:#36acaa">4.0</span><span class="token plain">                                                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">% /snap/core20/1974</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop1       squashfs        </span><span class="token number" style="color:#36acaa">4.0</span><span class="token plain">                                                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">% /snap/lxd/24322</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop2       squashfs        </span><span class="token number" style="color:#36acaa">4.0</span><span class="token plain">                                                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">% /snap/snapd/19457</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sda         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdb         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdc         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdd         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sde         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdf         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdg         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdh         isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvme0n1     isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─md126                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├─md126p1 vfat            FAT32        292B-DB66                                 1G     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /boot/efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └─md126p2 ext4            </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">          0f58386c-334d-4877-8051-b855bae37fb0    </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.3T     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─md127                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvme1n1     isw_raid_member </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.00                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─md126                                                                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├─md126p1 vfat            FAT32        292B-DB66                                 1G     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /boot/efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └─md126p2 ext4            </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">          0f58386c-334d-4877-8051-b855bae37fb0    </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.3T     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">% /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─md127                         </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="list-uuid-of-devices">List UUID of devices<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#list-uuid-of-devices" class="hash-link" aria-label="Direct link to List UUID of devices" title="Direct link to List UUID of devices">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> blkid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sdf: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/nvme0n1: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sdd: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sdb: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sdg: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sde: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sdc: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/md126p2: </span><span class="token assign-left variable" style="color:#36acaa">UUID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"ff1f3640-e590-486b-8570-c34dfd7bd1de"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">BLOCK_SIZE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"4096"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"ext4"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PARTUUID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"07473e4a-9324-435d-9238-cf358cd9a6a9"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/md126p1: </span><span class="token assign-left variable" style="color:#36acaa">UUID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"A636-3441"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">BLOCK_SIZE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"512"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"vfat"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PARTUUID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"7eb27871-d9ad-4132-af06-7110948faf06"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/nvme1n1: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sda: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/md124: </span><span class="token assign-left variable" style="color:#36acaa">UUID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"b7fa44f2-0f05-47a1-b4ef-e9ad306898de"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">BLOCK_SIZE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"4096"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"ext4"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sdh: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"isw_raid_member"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/loop1: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"squashfs"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/loop4: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"squashfs"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/loop2: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"squashfs"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/loop0: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"squashfs"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/loop3: </span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"squashfs"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="partition-a-disk">Partition a disk<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#partition-a-disk" class="hash-link" aria-label="Direct link to Partition a disk" title="Direct link to Partition a disk">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fdisk</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> /dev/sda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="create-filesystem-on-disk">Create filesystem on disk<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#create-filesystem-on-disk" class="hash-link" aria-label="Direct link to Create filesystem on disk" title="Direct link to Create filesystem on disk">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> mkfs.ext4 </span><span class="token parameter variable" style="color:#36acaa">-F</span><span class="token plain"> /dev/sda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="delete-partition-and-data-in-disk">Delete partition and data in disk<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#delete-partition-and-data-in-disk" class="hash-link" aria-label="Direct link to Delete partition and data in disk" title="Direct link to Delete partition and data in disk">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">if</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/dev/zero </span><span class="token assign-left variable" style="color:#36acaa">of</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/dev/sda  </span><span class="token assign-left variable" style="color:#36acaa">bs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">512</span><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">count</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a href="https://liviaerxin.github.io/blog/raid-on-ubuntu#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-create-raid-arrays-with-mdadm-on-ubuntu-22-04" target="_blank" rel="noopener noreferrer">How To Create RAID Arrays with mdadm on Ubuntu 22.04  | DigitalOcean</a></p>
<p><a href="https://help.ubuntu.com/community/Installation/SoftwareRAID" target="_blank" rel="noopener noreferrer">SoftwareRAID</a></p>
<p><a href="https://www.servers.com/support/knowledge/linux-administration/how-to-install-ubuntu-with-software-raid-1" target="_blank" rel="noopener noreferrer">How to install Ubuntu with software RAID-1</a></p>]]></content:encoded>
            <category>raid</category>
            <category>ubuntu</category>
        </item>
        <item>
            <title><![CDATA[How to Work with CMake]]></title>
            <link>https://liviaerxin.github.io/blog/how-to-cmake</link>
            <guid>https://liviaerxin.github.io/blog/how-to-cmake</guid>
            <pubDate>Sun, 25 Jun 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[How to work with CMake]]></description>
            <content:encoded><![CDATA[<p>In brief, <strong>CMake</strong> is all about <strong>targets</strong> and <strong>properties</strong></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cmake-project-structure">CMake Project Structure<a href="https://liviaerxin.github.io/blog/how-to-cmake#cmake-project-structure" class="hash-link" aria-label="Direct link to CMake Project Structure" title="Direct link to CMake Project Structure">​</a></h2>
<p>A typical <strong>CMake</strong> project can be regarded to has three <code>Tree</code>:</p>
<p><strong>Source Tree</strong>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">project_root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── simple_example.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── simple_lib.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── simple_lib.hpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Build Tree</strong>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">project_root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── simple_example.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── simple_lib.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── simple_lib.hpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── CMakeCache.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Install Tree</strong>:</p>
<p>This tree is located in the <code>CMAKE_INSTALL_PREFIX</code>, of which default value is platform-dependent. By default, it is set to <code>/usr/local</code> on Unix-like systems (Linux, macOS) and <code>C:/Program Files/&lt;Project Name&gt;</code> on Windows..</p>
<p>To change it, you can pass <code>-DCMAKE_INSTALL_PREFIX</code> argument during CMake <code>configuration</code> step, like this:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake </span><span class="token parameter variable" style="color:#36acaa">-B</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-DCMAKE_INSTALL_PREFIX</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/my/custom/installation/path</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Alternatively, you can change it by passing <code>--prefix</code>(it can be relative path) argument during CMake <code>install</code> step, like this:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#36acaa">--prefix</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/my/custom/installation/path"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It's recommended to use a default install layout as <code>GNUInstallDirs</code>.</p>
<p>A <strong>install tree</strong> will look like as below if you'd like all things to be installed inside the project via <code>cmake --install build --prefix "./install</code>.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">project_root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── simple_example.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── simple_lib.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── simple_lib.hpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── CMakeCache.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── executables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── sbin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── sysadmin executables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── compiled libraries </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*.so </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unix</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> or *.dll </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">windows</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── library archive files </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*.lib </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">windows</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── libexec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── executables not directly invoked by user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── header files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── doc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       └── documentation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-cmake-works">How CMake Works<a href="https://liviaerxin.github.io/blog/how-to-cmake#how-cmake-works" class="hash-link" aria-label="Direct link to How CMake Works" title="Direct link to How CMake Works">​</a></h2>
<p>A typical workflow of CMake includes <code>Configure</code>, <code>Build</code> and <code>Install</code> steps, combined with the above mentioned <code>Trees</code> concepts.</p>
<ol>
<li><code>Configure</code> step will generate a sort of configuration files, the most important ones among them are <code>CMakeCache.txt</code>, <code>cmake_install.cmake</code> and <code>Makefile</code> if using <code>Make</code> as building system. With these generated configuration files, the later steps <code>Build</code> and <code>Install</code> will run according to them.</li>
<li><code>Build</code> step will generate the build binary directory.</li>
<li><code>Install</code> step will generate the install binary directory.</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-to-make-your-package-be-found-by-others-by-find_package">How to make your package be found by others by <code>find_package()</code><a href="https://liviaerxin.github.io/blog/how-to-cmake#how-to-make-your-package-be-found-by-others-by-find_package" class="hash-link" aria-label="Direct link to how-to-make-your-package-be-found-by-others-by-find_package" title="Direct link to how-to-make-your-package-be-found-by-others-by-find_package">​</a></h2>
<p>package configuration files: <code>find_package</code></p>
<p><a href="https://cmake.org/cmake/help/latest/guide/importing-exporting/index.html#importing-targets" target="_blank" rel="noopener noreferrer">Title</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rpath-in-cmake">RPATH in CMake<a href="https://liviaerxin.github.io/blog/how-to-cmake#rpath-in-cmake" class="hash-link" aria-label="Direct link to RPATH in CMake" title="Direct link to RPATH in CMake">​</a></h2>
<p><sup><a href="https://liviaerxin.github.io/blog/how-to-cmake#user-content-fn-rpath-01c630" id="user-content-fnref-rpath-01c630" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cmake-variables">CMake Variables<a href="https://liviaerxin.github.io/blog/how-to-cmake#cmake-variables" class="hash-link" aria-label="Direct link to CMake Variables" title="Direct link to CMake Variables">​</a></h2>
<p>There are some useful and important CMake variables that will be introduced here:</p>
<p><code>CMAKE_PREFIX_PATH</code></p>
<p><code>CMAKE_IGNORE_PATH</code></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="clang-faq"><code>clang</code> FAQ<a href="https://liviaerxin.github.io/blog/how-to-cmake#clang-faq" class="hash-link" aria-label="Direct link to clang-faq" title="Direct link to clang-faq">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="find-out-clang-include-search-path">Find out <code>clang</code> include search path<a href="https://liviaerxin.github.io/blog/how-to-cmake#find-out-clang-include-search-path" class="hash-link" aria-label="Direct link to find-out-clang-include-search-path" title="Direct link to find-out-clang-include-search-path">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ clang </span><span class="token parameter variable" style="color:#36acaa">-x</span><span class="token plain"> c </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#include "..." search starts here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#include &lt;...&gt; search starts here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /opt/homebrew/Cellar/llvm/17.0.1/lib/clang/17/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk/usr/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk/System/Library/Frameworks </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">framework directory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of search list.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1 "/dev/null"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1 "&lt;built-in&gt;" 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1 "&lt;built-in&gt;" 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 420 "&lt;built-in&gt;" 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1 "&lt;command line&gt;" 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1 "&lt;built-in&gt;" 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1 "/dev/null" 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="add-include-search-path-to-clang">Add include search path to <code>clang</code><a href="https://liviaerxin.github.io/blog/how-to-cmake#add-include-search-path-to-clang" class="hash-link" aria-label="Direct link to add-include-search-path-to-clang" title="Direct link to add-include-search-path-to-clang">​</a></h3>
<p>Use environment variables <code>C_INCLUDE_PATH</code> for <code>c</code> and <code>CPLUS_INCLUDE_PATH</code> for <code>c++</code>.</p>
<p><code>clang</code>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token assign-left variable" style="color:#36acaa">C_INCLUDE_PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/opt/homebrew/include clang </span><span class="token parameter variable" style="color:#36acaa">-x</span><span class="token plain"> c </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#include "..." search starts here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#include &lt;...&gt; search starts here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /usr/local/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /opt/homebrew/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/usr/lib/clang/15.0.0/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/usr/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">framework directory</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>clang++</code>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token assign-left variable" style="color:#36acaa">CPLUS_INCLUDE_PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/opt/homebrew/include clang </span><span class="token parameter variable" style="color:#36acaa">-x</span><span class="token plain"> c++ </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#include "..." search starts here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#include &lt;...&gt; search starts here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /usr/local/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /opt/homebrew/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/usr/lib/clang/15.0.0/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/usr/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">framework directory</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use <code>-I</code> flag,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ clang </span><span class="token parameter variable" style="color:#36acaa">-x</span><span class="token plain"> c -I/opt/homebrew/include </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#include "..." search starts here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#include &lt;...&gt; search starts here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /opt/homebrew/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /usr/local/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/usr/lib/clang/15.0.0/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/usr/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">framework directory</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="find-out-clang-library-search-paths">Find out <code>clang</code> library search paths<a href="https://liviaerxin.github.io/blog/how-to-cmake#find-out-clang-library-search-paths" class="hash-link" aria-label="Direct link to find-out-clang-library-search-paths" title="Direct link to find-out-clang-library-search-paths">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ clang </span><span class="token parameter variable" style="color:#36acaa">-Xlinker</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Library search paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/usr/local/lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Framework search paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ld: Undefined symbols:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _main, referenced from:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">initial-undefines</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clang: error: linker </span><span class="token builtin class-name">command</span><span class="token plain"> failed with </span><span class="token builtin class-name">exit</span><span class="token plain"> code </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">use </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> to see invocation</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="add-library-search-path-to-clang">Add library search path to <code>clang</code><a href="https://liviaerxin.github.io/blog/how-to-cmake#add-library-search-path-to-clang" class="hash-link" aria-label="Direct link to add-library-search-path-to-clang" title="Direct link to add-library-search-path-to-clang">​</a></h3>
<p>Use environment variables <code>LIBRARY_PATH</code>,</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ </span><span class="token assign-left variable" style="color:#36acaa">LIBRARY_PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$LIBRARY_PATH</span><span class="token plain">:/usr/lib clang </span><span class="token parameter variable" style="color:#36acaa">-Xlinker</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Library search paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/usr/lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/usr/local/lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Framework search paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ld: Undefined symbols:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _main, referenced from:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">initial-undefines</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clang: error: linker </span><span class="token builtin class-name">command</span><span class="token plain"> failed with </span><span class="token builtin class-name">exit</span><span class="token plain"> code </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">use </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> to see invocation</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use <code>-L</code> flag:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ clang -L/opt/homebrew/lib </span><span class="token parameter variable" style="color:#36acaa">-Xlinker</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://langui.sh/2015/07/24/osx-clang-include-lib-search-paths/" target="_blank" rel="noopener noreferrer">OS X clang include lib search path</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-is-the-difference-clang--clang--stdc11">What is the difference? clang++ | clang -std=c++11<a href="https://liviaerxin.github.io/blog/how-to-cmake#what-is-the-difference-clang--clang--stdc11" class="hash-link" aria-label="Direct link to What is the difference? clang++ | clang -std=c++11" title="Direct link to What is the difference? clang++ | clang -std=c++11">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cmake-faq">CMake FAQ<a href="https://liviaerxin.github.io/blog/how-to-cmake#cmake-faq" class="hash-link" aria-label="Direct link to CMake FAQ" title="Direct link to CMake FAQ">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="add-library-search-path-to-cmake-globally-in-project">Add library search path to <code>CMake</code> globally in project<a href="https://liviaerxin.github.io/blog/how-to-cmake#add-library-search-path-to-cmake-globally-in-project" class="hash-link" aria-label="Direct link to add-library-search-path-to-cmake-globally-in-project" title="Direct link to add-library-search-path-to-cmake-globally-in-project">​</a></h3>
<ol>
<li><code>set(CMAKE_LIBRARY_PATH ${CMAKE_LIBRARY_PATH} /opt/local/lib)</code></li>
<li><code>LINK_DIRECTORIES(/opt/local/lib)</code></li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a href="https://liviaerxin.github.io/blog/how-to-cmake#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p><a href="https://enccs.github.io/cmake-workshop/" target="_blank" rel="noopener noreferrer">CMake hands-on workshop — CMake Workshop</a></p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5 sr-only" id="footnote-label">Footnotes<a href="https://liviaerxin.github.io/blog/how-to-cmake#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-rpath-01c630">
<p><a href="https://gitlab.kitware.com/cmake/community/-/wikis/doc/cmake/RPATH-handling" target="_blank" rel="noopener noreferrer">RPATH handling from official cmake</a> <a href="https://liviaerxin.github.io/blog/how-to-cmake#user-content-fnref-rpath-01c630" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>toolchain</category>
            <category>how-to</category>
        </item>
        <item>
            <title><![CDATA[Configuring WiFi AutoSwitch in Windows]]></title>
            <link>https://liviaerxin.github.io/blog/configuring-wifi-autoswitch-in-windows</link>
            <guid>https://liviaerxin.github.io/blog/configuring-wifi-autoswitch-in-windows</guid>
            <pubDate>Thu, 01 Jun 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Configuring WiFi AutoSwitch Windows]]></description>
            <content:encoded><![CDATA[<p>If <strong>autoSwitch</strong> is turned on, it allows Windows to continue looking for other auto-connected wireless networks while connected to the current wireless network. If a higher priority auto-connected wireless network than the currently connected wireless network comes in range, Windows will automatically connect to it instead.</p>
<p>It also needs to work along with <code>priority</code> setting.</p>
<p>For example:</p>
<p>There're 3 networks of profile name: <code>TP-Link-1</code>, <code>TP-Link-2</code> and <code>TP-Link-3</code>. PC(windows) will try to connect <code>TP-Link-3</code> if it's in range when it's already connected to <code>TP-Link-1</code> or <code>TP-Link-2</code>.</p>
<ol>
<li>Setup <code>autoswitch</code>:</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">netsh wlan </span><span class="token builtin class-name">set</span><span class="token plain"> profileparameter </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"TP-Link-1"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">autoswitch</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netsh wlan </span><span class="token builtin class-name">set</span><span class="token plain"> profileparameter </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"TP-Link-2"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">autoswitch</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netsh wlan </span><span class="token builtin class-name">set</span><span class="token plain"> profileparameter </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"TP-Link-3"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">autoswitch</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">No</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Setup <code>priority</code>:</li>
</ol>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">netsh wlan </span><span class="token builtin class-name">set</span><span class="token plain"> profileorder </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"TP-Link-1"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">interface</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"Wi-Fi"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">priority</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netsh wlan </span><span class="token builtin class-name">set</span><span class="token plain"> profileorder </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"TP-Link-2"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">interface</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"Wi-Fi"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">priority</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netsh wlan </span><span class="token builtin class-name">set</span><span class="token plain"> profileorder </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"TP-Link-3"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">interface</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"Wi-Fi"</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">priority</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>other tools:</p>
<p>List profile name:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">netsh wlan show profiles</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>List connected WiFi:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">netsh wlan show interfaces</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://winaero.com/enable-auto-switch-for-wireless-network-connection-in-windows-10/" target="_blank" rel="noopener noreferrer">Enable Auto Switch for Wireless Network Connection in Windows 10</a></p>
<p><a href="https://winaero.com/change-wifi-network-priority-in-windows-10/" target="_blank" rel="noopener noreferrer">Change WiFi network priority in Windows 10</a></p>]]></content:encoded>
            <category>how-to</category>
            <category>network</category>
            <category>windows</category>
        </item>
        <item>
            <title><![CDATA[Setting up Coral dev board]]></title>
            <link>https://liviaerxin.github.io/blog/setting-up-coral</link>
            <guid>https://liviaerxin.github.io/blog/setting-up-coral</guid>
            <pubDate>Thu, 01 Jun 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Setting up coral dev board]]></description>
            <content:encoded><![CDATA[<p>Set up Coral Dev Board for employing an Edge TPU coprocessor.</p>
<p>Prototype new projects demanding fast on-device inference for the ML models.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="background">Background<a href="https://liviaerxin.github.io/blog/setting-up-coral#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p>The official documents <a href="https://coral.ai/docs/dev-board/get-started/" target="_blank" rel="noopener noreferrer">Get started with the Dev Board</a> contains comprehensive how-to contents and rich examples. Here are just some experiences from myself. You can always go back to the official website to review and get the details.</p>
<p>The recommended method to access the Coral board is using <a href="https://coral.ai/docs/dev-board/mdt/" target="_blank" rel="noopener noreferrer">Mendel Development Tool (mdt)</a>, which is required to be installed on your host machine alongside the <code>Python</code>. Common steps to enter the shell terminal from <code>mdt</code> are in following:</p>
<ol>
<li><code>mdt</code> tool generate a pair of <code>SSH key</code>s, save the <code>private key</code> on the host and push the <code>public key</code> to the Coral using <code>http</code> via <code>41337</code> port.</li>
<li>Coral board has a running a <code>mdt-keymaster</code> server that is listening <code>41337</code> port, and put the <code>public key</code> into <code>~/.ssh/authorized_keys</code>.</li>
<li><code>mdt shell</code> now can login to the shell terminal of Coral board like <code>ssh mendel@192.168.100.2</code> when connecting over USB-C(OTG) or <code>ssh mendel@indigo-quill.local</code> over the same network where your host PC is.</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Coral board is set up by disabling password login in <code>OpenSSH</code> in default, so it must be provided with <code>SSH key</code> otherwise you change the setting to be like <code>PasswordAuthentication yes</code>.</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>You can check the <code>key master</code> by,</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mendel@indigo-quill:~$ </span><span class="token function" style="color:#d73a49">lsof</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i:41337</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMMAND    PID   </span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mdt-keyma </span><span class="token number" style="color:#36acaa">7846</span><span class="token plain"> mendel    5u  IPv4  </span><span class="token number" style="color:#36acaa">20302</span><span class="token plain">      0t0  TCP </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.100.2:41337 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mdt-keyma </span><span class="token number" style="color:#36acaa">7847</span><span class="token plain"> mendel    6u  IPv4  </span><span class="token number" style="color:#36acaa">20619</span><span class="token plain">      0t0  TCP </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.101.2:41337 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LISTEN</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<p>Although <code>mdt</code> maybe facilitate the access to the Coral board, some magics and additional steps are kept from sight.</p>
<p>To do not use <code>mdt</code>, we need access the dev board through <code>serial console</code> instead of <code>mdt keymaster</code> server, to make configuration.</p>
<p>There are general ways to access a just-setup Coral in brief steps:</p>
<ol>
<li>Connect to Coral board's <code>serial console</code> by the instructions <a href="https://coral.ai/docs/dev-board/serial-console/" target="_blank" rel="noopener noreferrer">Connect to the Dev Board's serial console</a></li>
<li>Log into the Dev board by username: <code>mendel</code> and password: <code>mendel</code> in default.</li>
<li>Enable SSH Password Authentication. Edit <code>/etc/ssh/sshd_config</code> to change <code>PasswordAuthentication no</code> to <code>PasswordAuthentication yes</code>, and <code>sudo service ssh restart</code> to restart the ssh service.</li>
<li>Log into the shell using username: <code>mendel</code> and password: <code>mendel</code>.</li>
<li>If you want to keep the secure shell, generate <code>private SSH key</code> stored in host and <code>public SSH key</code> saved into Coral.</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="references">References<a href="https://liviaerxin.github.io/blog/setting-up-coral#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li><a href="https://coral.ai/docs/dev-board/get-started/" target="_blank" rel="noopener noreferrer">Get started with the Dev Board | CoralCoralClose</a></li>
</ul>]]></content:encoded>
            <category>how-to</category>
            <category>network</category>
            <category>environment</category>
        </item>
        <item>
            <title><![CDATA[Setting up a containerized dev environment VSCode]]></title>
            <link>https://liviaerxin.github.io/blog/preparing-dev-environment-in-vscode</link>
            <guid>https://liviaerxin.github.io/blog/preparing-dev-environment-in-vscode</guid>
            <pubDate>Sun, 04 Dec 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Wiki Dev Environment]]></description>
            <content:encoded><![CDATA[<p>Here are some experiences that I have gotten to prepare a best-practice development environment for projects. I would like to update to keep up with the latest tech stacks.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vs-code">VS Code<a href="https://liviaerxin.github.io/blog/preparing-dev-environment-in-vscode#vs-code" class="hash-link" aria-label="Direct link to VS Code" title="Direct link to VS Code">​</a></h2>
<p>As of now, the <code>VS Code</code> is the most popular IDE among developers. Absolutely, for me, it's my first choice and favorite developing tool.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dev-container">Dev Container<a href="https://liviaerxin.github.io/blog/preparing-dev-environment-in-vscode#dev-container" class="hash-link" aria-label="Direct link to Dev Container" title="Direct link to Dev Container">​</a></h3>
<p><a href="https://code.visualstudio.com/docs/devcontainers/containers" target="_blank" rel="noopener noreferrer">Developing inside a Container using Visual Studio Code Remote Development</a></p>
<p>What is Dev Container?</p>
<p>A "Dev Container" typically refers to a development environment that is containerized. Containers are lightweight, portable, and consistent environments that encapsulate an application and its dependencies. They provide a standardized way to package and run software across different environments, ensuring that the application behaves consistently regardless of where it is deployed.</p>
<p>The benefits of using Dev Containers include:</p>
<ol>
<li>Consistency: Developers work in the same environment, reducing the chances of environment-related issues.</li>
<li>Isolation: Dev Containers are isolated from the host system, preventing conflicts with other software installed on the developer's machine.</li>
<li>Reproducibility: The development environment can be easily recreated by anyone using the container specifications.</li>
<li>Portability: Dev Containers can be easily shared, allowing developers to work on the same project with minimal setup.</li>
</ol>
<p>Best ways to customize the environment in Dev containers?</p>
<ul>
<li><a href="https://containers.dev/guide/dockerfile" target="_blank" rel="noopener noreferrer">Using Images, Dockerfile, and Docker Compose</a>:love_you_gesture:</li>
<li><a href="https://containers.dev/features" target="_blank" rel="noopener noreferrer">Using Features</a></li>
<li><a href="https://containers.dev/implementors/json_reference/#lifecycle-scripts" target="_blank" rel="noopener noreferrer">Using lifecycle scripts</a></li>
</ul>
<p>How to Write Dockerfile for Dev containers?</p>
<p>You can refer to this repo <a href="https://github.com/devcontainers/images" target="_blank" rel="noopener noreferrer">GitHub - devcontainers/images: Repository for pre-built dev container images published under mcr.microsoft.com/devcontainers</a></p>
<p>What magics does the <code>Dev Containers</code> extension do when starting?</p>
<ol>
<li>Hook a default startup command <code>while sleep 1000; do :; done</code> to keep the container not exit. Disable this behavior by setting <code>overrideCommand: false</code>.</li>
</ol>
<p>How to run a container inside of Dev containers?</p>
<ul>
<li><a href="https://github.com/microsoft/vscode-dev-containers/tree/main/containers/docker-in-docker" target="_blank" rel="noopener noreferrer">Docker-in-Docker</a></li>
<li><a href="https://github.com/microsoft/vscode-dev-containers/tree/main/containers/docker-from-docker" target="_blank" rel="noopener noreferrer">Docker-from-Docker</a></li>
</ul>
<p>For instance, I use the <strong>Docker-in-Docker</strong> method to always test/run Docker containers inside of Dev containers.</p>]]></content:encoded>
            <category>dev</category>
            <category>docker</category>
        </item>
    </channel>
</rss>